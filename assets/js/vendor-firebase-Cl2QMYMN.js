var e=Object.getPrototypeOf,t=Reflect.get,n=(n,r,i)=>t(e(n),i,r),r=(e,t,n)=>new Promise((r,i)=>{var s=e=>{try{a(n.next(e))}catch(t){i(t)}},o=e=>{try{a(n.throw(e))}catch(t){i(t)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);a((n=n.apply(e,t)).next())});import{o as i,_ as s,d as o}from"./vendor-others-BwC04hQF.js";var a={};const u=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,u=a?e[i+2]:0,c=t>>2,l=(3&t)<<4|o>>4;let h=(15&o)<<2|u>>6,d=63&u;a||(d=64,s||(h=64)),r.push(n[c],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(u(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw new l;const u=t<<2|s>>4;if(r.push(u),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const h=function(e){return function(e){const t=u(e);return c.encodeByteArray(t,!0)}(e).replace(/\./g,"")},d=function(e){try{return c.decodeString(e,!0)}catch(t){}return null},f=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const e=a.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&d(e[1]);return t&&JSON.parse(t)})()}catch(e){return}},p=e=>{var t,n;return null===(n=null===(t=f())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},m=e=>{const t=p(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},g=()=>{var e;return null===(e=f())||void 0===e?void 0:e.config},y=e=>{var t;return null===(t=f())||void 0===t?void 0:t[`_${e}`]};class v{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function _(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[h(JSON.stringify({alg:"none",type:"JWT"})),h(JSON.stringify(s)),""].join(".")}function w(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function b(){return!function(){var e;const t=null===(e=f())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(n){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function I(){try{return"object"==typeof indexedDB}catch(e){return!1}}function T(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}class E extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,E.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,S.prototype.create)}}class S{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(k,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new E(r,o,n)}}const k=/\{\$([^}]+)}/g;function C(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(A(n)&&A(s)){if(!C(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function A(e){return null!==e&&"object"==typeof e}function N(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function D(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function R(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class x{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=O),void 0===r.error&&(r.error=O),void 0===r.complete&&(r.complete=O);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function O(){}function P(e){return e&&e._delegate?e._delegate:e}class L{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const M="[DEFAULT]";class U{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new v;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:M})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(e=M){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return r(this,null,function*(){const e=Array.from(this.instances.values());yield Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return null!=this.component}isInitialized(e=M){return this.instances.has(e)}getOptions(e=M){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(i)&&s.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===M?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(i){}var r;return n||null}normalizeInstanceIdentifier(e=M){return this.component?this.component.multipleInstances?e:M:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class F{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new U(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var V,j;(j=V||(V={}))[j.DEBUG=0]="DEBUG",j[j.VERBOSE=1]="VERBOSE",j[j.INFO=2]="INFO",j[j.WARN=3]="WARN",j[j.ERROR=4]="ERROR",j[j.SILENT=5]="SILENT";const B={debug:V.DEBUG,verbose:V.VERBOSE,info:V.INFO,warn:V.WARN,error:V.ERROR,silent:V.SILENT},q=V.INFO,z={[V.DEBUG]:"log",[V.VERBOSE]:"log",[V.INFO]:"info",[V.WARN]:"warn",[V.ERROR]:"error"},K=(e,t,...n)=>{if(!(t<e.logLevel||((new Date).toISOString(),z[t])))throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ${constructor(e){this.name=e,this._logLevel=q,this._logHandler=K,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in V))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?B[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,V.DEBUG,...e),this._logHandler(this,V.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,V.VERBOSE,...e),this._logHandler(this,V.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,V.INFO,...e),this._logHandler(this,V.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,V.WARN,...e),this._logHandler(this,V.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,V.ERROR,...e),this._logHandler(this,V.ERROR,...e)}}class G{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const H="@firebase/app",W="0.10.13",Q=new $("@firebase/app"),J="@firebase/app-compat",X="@firebase/analytics-compat",Y="@firebase/analytics",Z="@firebase/app-check-compat",ee="@firebase/app-check",te="@firebase/auth",ne="@firebase/auth-compat",re="@firebase/database",ie="@firebase/data-connect",se="@firebase/database-compat",oe="@firebase/functions",ae="@firebase/functions-compat",ue="@firebase/installations",ce="@firebase/installations-compat",le="@firebase/messaging",he="@firebase/messaging-compat",de="@firebase/performance",fe="@firebase/performance-compat",pe="@firebase/remote-config",me="@firebase/remote-config-compat",ge="@firebase/storage",ye="@firebase/storage-compat",ve="@firebase/firestore",_e="@firebase/vertexai-preview",we="@firebase/firestore-compat",be="firebase",Ie="[DEFAULT]",Te={[H]:"fire-core",[J]:"fire-core-compat",[Y]:"fire-analytics",[X]:"fire-analytics-compat",[ee]:"fire-app-check",[Z]:"fire-app-check-compat",[te]:"fire-auth",[ne]:"fire-auth-compat",[re]:"fire-rtdb",[ie]:"fire-data-connect",[se]:"fire-rtdb-compat",[oe]:"fire-fn",[ae]:"fire-fn-compat",[ue]:"fire-iid",[ce]:"fire-iid-compat",[le]:"fire-fcm",[he]:"fire-fcm-compat",[de]:"fire-perf",[fe]:"fire-perf-compat",[pe]:"fire-rc",[me]:"fire-rc-compat",[ge]:"fire-gcs",[ye]:"fire-gcs-compat",[ve]:"fire-fst",[we]:"fire-fst-compat",[_e]:"fire-vertex","fire-js":"fire-js",[be]:"fire-js-all"},Ee=new Map,Se=new Map,ke=new Map;function Ce(e,t){try{e.container.addComponent(t)}catch(n){Q.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Ae(e){const t=e.name;if(ke.has(t))return Q.debug(`There were multiple attempts to register component ${t}.`),!1;ke.set(t,e);for(const n of Ee.values())Ce(n,e);for(const n of Se.values())Ce(n,e);return!0}function Ne(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function De(e){return void 0!==e.settings}const Re=new S("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class xe{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new L("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Re.create("app-deleted",{appName:this._name})}}const Oe="10.14.1";function Pe(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:Ie,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw Re.create("bad-app-name",{appName:String(i)});if(n||(n=g()),!n)throw Re.create("no-options");const s=Ee.get(i);if(s){if(C(n,s.options)&&C(r,s.config))return s;throw Re.create("duplicate-app",{appName:i})}const o=new F(i);for(const u of ke.values())o.addComponent(u);const a=new xe(n,r,o);return Ee.set(i,a),a}function Le(e=Ie){const t=Ee.get(e);if(!t&&e===Ie&&g())return Pe();if(!t)throw Re.create("no-app",{appName:e});return t}function Me(e,t,n){var r;let i=null!==(r=Te[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Q.warn(e.join(" "))}Ae(new L(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}const Ue="firebase-heartbeat-store";let Fe=null;function Ve(){return Fe||(Fe=i("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Ue)}catch(n){}}}).catch(e=>{throw Re.create("idb-open",{originalErrorMessage:e.message})})),Fe}function je(e,t){return r(this,null,function*(){try{const n=(yield Ve()).transaction(Ue,"readwrite"),r=n.objectStore(Ue);yield r.put(t,Be(e)),yield n.done}catch(n){if(n instanceof E)Q.warn(n.message);else{const e=Re.create("idb-set",{originalErrorMessage:null==n?void 0:n.message});Q.warn(e.message)}}})}function Be(e){return`${e.name}!${e.options.appId}`}class qe{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ke(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}triggerHeartbeat(){return r(this,null,function*(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ze();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(n){Q.warn(n)}})}getHeartbeatsHeader(){return r(this,null,function*(){var e;try{if(null===this._heartbeatsCache&&(yield this._heartbeatsCachePromise),null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=ze(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),$e(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),$e(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=h(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Q.warn(t),""}})}}function ze(){return(new Date).toISOString().substring(0,10)}class Ke{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return r(this,null,function*(){return!!I()&&T().then(()=>!0).catch(()=>!1)})}read(){return r(this,null,function*(){if(yield this._canUseIndexedDBPromise){const e=yield function(e){return r(this,null,function*(){try{const t=(yield Ve()).transaction(Ue),n=yield t.objectStore(Ue).get(Be(e));return yield t.done,n}catch(t){if(t instanceof E)Q.warn(t.message);else{const e=Re.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Q.warn(e.message)}}})}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}})}overwrite(e){return r(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const n=yield this.read();return je(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})}add(e){return r(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const n=yield this.read();return je(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}})}}function $e(e){return h(JSON.stringify({version:2,heartbeats:e})).length}Ae(new L("platform-logger",e=>new G(e),"PRIVATE")),Ae(new L("heartbeat",e=>new qe(e),"PRIVATE")),Me(H,W,""),Me(H,W,"esm2017"),Me("fire-js",""),Me("firebase","10.14.1","app");const Ge=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},He=new S("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),We=new $("@firebase/auth");function Qe(e,...t){We.logLevel<=V.ERROR&&We.error(`Auth (${Oe}): ${e}`,...t)}function Je(e,...t){throw et(e,...t)}function Xe(e,...t){return et(e,...t)}function Ye(e,t,n){const r=Object.assign(Object.assign({},Ge()),{[t]:n});return new S("auth","Firebase",r).create(t,{appName:e.name})}function Ze(e){return Ye(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function et(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return He.create(e,...t)}function tt(e,t,...n){if(!e)throw et(t,...n)}function nt(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Qe(t),new Error(t)}function rt(e,t){e||nt(t)}function it(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function st(){return"http:"===ot()||"https:"===ot()}function ot(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class at{constructor(e,t){this.shortDelay=e,this.longDelay=t,rt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(st()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function ut(e,t){rt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class ct{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void nt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void nt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void nt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const lt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ht=new at(3e4,6e4);function dt(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function ft(e,t,n,i){return r(this,arguments,function*(e,t,n,i,s={}){return pt(e,s,()=>r(this,null,function*(){let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});const o=N(Object.assign({key:e.config.apiKey},s)).slice(1),a=yield e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const u=Object.assign({method:t,headers:a},r);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(u.referrerPolicy="no-referrer"),ct.fetch()(gt(e,e.config.apiHost,n,o),u)}))})}function pt(e,t,n){return r(this,null,function*(){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},lt),t);try{const t=new vt(e),i=yield Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=yield i.json();if("needConfirmation"in s)throw _t(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw _t(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw _t(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw _t(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Ye(e,a,o);Je(e,a)}}catch(i){if(i instanceof E)throw i;Je(e,"network-request-failed",{message:String(i)})}})}function mt(e,t,n,i){return r(this,arguments,function*(e,t,n,r,i={}){const s=yield ft(e,t,n,r,i);return"mfaPendingCredential"in s&&Je(e,"multi-factor-auth-required",{_serverResponse:s}),s})}function gt(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?ut(e.config,i):`${e.config.apiScheme}://${i}`}function yt(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class vt{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Xe(this.auth,"network-request-failed")),ht.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function _t(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Xe(e,t,r);return i.customData._tokenResponse=n,i}function wt(e){return void 0!==e&&void 0!==e.getResponse}function bt(e){return void 0!==e&&void 0!==e.enterprise}class It{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return yt(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}function Tt(e,t){return r(this,null,function*(){return ft(e,"POST","/v1/accounts:lookup",t)})}function Et(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function St(e){return 1e3*Number(e)}function kt(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Qe("JWT malformed, contained fewer than 3 sections"),null;try{const e=d(n);return e?JSON.parse(e):(Qe("Failed to decode base64 JWT payload"),null)}catch(i){return Qe("Caught error parsing JWT payload as JSON",null==i?void 0:i.toString()),null}}function Ct(e){const t=kt(e);return tt(t,"internal-error"),tt(void 0!==t.exp,"internal-error"),tt(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}function At(e,t,n=!1){return r(this,null,function*(){if(n)return t;try{return yield t}catch(r){throw r instanceof E&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(r)&&e.auth.currentUser===e&&(yield e.auth.signOut()),r}})}class Nt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(()=>r(this,null,function*(){yield this.iteration()}),t)}iteration(){return r(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()})}}class Dt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Et(this.lastLoginAt),this.creationTime=Et(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Rt(e){return r(this,null,function*(){var t;const n=e.auth,r=yield e.getIdToken(),i=yield At(e,Tt(n,{idToken:r}));tt(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?xt(s.providerUserInfo):[],a=(u=e.providerData,c=o,[...u.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var u,c;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Dt(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)})}function xt(e){return e.map(e=>{var{providerId:t}=e,n=s(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class Ot{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tt(e.idToken,"internal-error"),tt(void 0!==e.idToken,"internal-error"),tt(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Ct(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){tt(0!==e.length,"internal-error");const t=Ct(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return r(this,null,function*(){return t||!this.accessToken||this.isExpired?(tt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return r(this,null,function*(){const{accessToken:n,refreshToken:i,expiresIn:s}=yield function(e,t){return r(this,null,function*(){const n=yield pt(e,{},()=>r(this,null,function*(){const n=N({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=gt(e,r,"/v1/token",`key=${i}`),o=yield e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",ct.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})}(e,t);this.updateTokensAndExpiration(n,i,Number(s))})}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Ot;return n&&(tt("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(tt("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(tt("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ot,this.toJSON())}_performRefresh(){return nt("not implemented")}}function Pt(e,t){tt("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Lt{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=s(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Nt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Dt(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return r(this,null,function*(){const t=yield At(this,this.stsTokenManager.getToken(this.auth,e));return tt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return function(e,t=!1){return r(this,null,function*(){const n=P(e),r=yield n.getIdToken(t),i=kt(r);tt(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Et(St(i.auth_time)),issuedAtTime:Et(St(i.iat)),expirationTime:Et(St(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}})}(this,e)}reload(){return function(e){return r(this,null,function*(){const t=P(e);yield Rt(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})}(this)}_assign(e){this!==e&&(tt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Lt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){tt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return r(this,null,function*(){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&(yield Rt(this)),yield this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)})}delete(){return r(this,null,function*(){if(De(this.auth.app))return Promise.reject(Ze(this.auth));const e=yield this.getIdToken();return yield At(this,function(e,t){return r(this,null,function*(){return ft(e,"POST","/v1/accounts:delete",t)})}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,u,c;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(u=t.createdAt)&&void 0!==u?u:void 0,y=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:v,emailVerified:_,isAnonymous:w,providerData:b,stsTokenManager:I}=t;tt(v&&I,e,"internal-error");const T=Ot.fromJSON(this.name,I);tt("string"==typeof v,e,"internal-error"),Pt(l,e.name),Pt(h,e.name),tt("boolean"==typeof _,e,"internal-error"),tt("boolean"==typeof w,e,"internal-error"),Pt(d,e.name),Pt(f,e.name),Pt(p,e.name),Pt(m,e.name),Pt(g,e.name),Pt(y,e.name);const E=new Lt({uid:v,auth:e,email:h,emailVerified:_,displayName:l,isAnonymous:w,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(E.providerData=b.map(e=>Object.assign({},e))),m&&(E._redirectEventId=m),E}static _fromIdTokenResponse(e,t,n=!1){return r(this,null,function*(){const r=new Ot;r.updateFromServerResponse(t);const i=new Lt({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return yield Rt(i),i})}static _fromGetAccountInfoResponse(e,t,n){return r(this,null,function*(){const r=t.users[0];tt(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?xt(r.providerUserInfo):[],s=!(r.email&&r.passwordHash||(null==i?void 0:i.length)),o=new Ot;o.updateFromIdToken(n);const a=new Lt({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Dt(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==i?void 0:i.length))};return Object.assign(a,u),a})}}const Mt=new Map;function Ut(e){rt(e instanceof Function,"Expected a class definition");let t=Mt.get(e);return t?(rt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Mt.set(e,t),t)}class Ft{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return r(this,null,function*(){return!0})}_set(e,t){return r(this,null,function*(){this.storage[e]=t})}_get(e){return r(this,null,function*(){const t=this.storage[e];return void 0===t?null:t})}_remove(e){return r(this,null,function*(){delete this.storage[e]})}_addListener(e,t){}_removeListener(e,t){}}Ft.type="NONE";const Vt=Ft;function jt(e,t,n){return`firebase:${e}:${t}:${n}`}class Bt{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=jt(this.userKey,r.apiKey,i),this.fullPersistenceKey=jt("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return r(this,null,function*(){const e=yield this.persistence._get(this.fullUserKey);return e?Lt._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return r(this,null,function*(){if(this.persistence===e)return;const t=yield this.getCurrentUser();return yield this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return r(this,null,function*(){if(!t.length)return new Bt(Ut(Vt),e,n);const i=(yield Promise.all(t.map(e=>r(this,null,function*(){if(yield e._isAvailable())return e})))).filter(e=>e);let s=i[0]||Ut(Vt);const o=jt(n,e.config.apiKey,e.name);let a=null;for(const n of t)try{const t=yield n._get(o);if(t){const r=Lt._fromJSON(e,t);n!==s&&(a=r),s=n;break}}catch(c){}const u=i.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&u.length?(s=u[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(e=>r(this,null,function*(){if(e!==s)try{yield e._remove(o)}catch(c){}}))),new Bt(s,e,n)):new Bt(s,e,n)})}}function qt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Gt(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(zt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Wt(t))return"Blackberry";if(Qt(t))return"Webos";if(Kt(t))return"Safari";if((t.includes("chrome/")||$t(t))&&!t.includes("edge/"))return"Chrome";if(Ht(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function zt(e=w()){return/firefox\//i.test(e)}function Kt(e=w()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function $t(e=w()){return/crios\//i.test(e)}function Gt(e=w()){return/iemobile/i.test(e)}function Ht(e=w()){return/android/i.test(e)}function Wt(e=w()){return/blackberry/i.test(e)}function Qt(e=w()){return/webos/i.test(e)}function Jt(e=w()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Xt(e=w()){return Jt(e)||Ht(e)||Qt(e)||Wt(e)||/windows phone/i.test(e)||Gt(e)}function Yt(e,t=[]){let n;switch(e){case"Browser":n=qt(w());break;case"Worker":n=`${qt(w())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Oe}/${r}`}class Zt{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(i){r(i)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){return r(this,null,function*(){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)yield n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==n?void 0:n.message})}})}}class en{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class tn{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new rn(this),this.idTokenSubscription=new rn(this),this.beforeStateQueue=new Zt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=He,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ut(t)),this._initializationPromise=this.queue(()=>r(this,null,function*(){var n,r;if(!this._deleted&&(this.persistenceManager=yield Bt.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch(i){}yield this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return r(this,null,function*(){if(this._deleted)return;const e=yield this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(yield this.currentUser.getIdToken())):void(yield this._updateCurrentUser(e,!0)):void 0})}initializeCurrentUserFromIdToken(e){return r(this,null,function*(){try{const t=yield Tt(this,{idToken:e}),n=yield Lt._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(n)}catch(t){yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return r(this,null,function*(){var t;if(De(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=yield this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=yield this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{yield this.beforeStateQueue.runMiddleware(r)}catch(s){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return tt(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return r(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return r(this,null,function*(){try{yield Rt(e)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){return r(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return r(this,null,function*(){if(De(this.app))return Promise.reject(Ze(this));const t=e?P(e):null;return t&&tt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return r(this,null,function*(){if(!this._deleted)return e&&tt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>r(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return r(this,null,function*(){return De(this.app)?Promise.reject(Ze(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return De(this.app)?Promise.reject(Ze(this)):this.queue(()=>r(this,null,function*(){yield this.assertedPersistence.setPersistence(Ut(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return r(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return r(this,null,function*(){const e=yield function(e){return r(this,arguments,function*(e,t={}){return ft(e,"GET","/v2/passwordPolicy",dt(e,t))})}(this),t=new en(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new S("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}revokeAccessToken(e){return r(this,null,function*(){if(this.currentUser){const t=yield this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};null!=this.tenantId&&(n.tenantId=this.tenantId),yield function(e,t){return r(this,null,function*(){return ft(e,"POST","/v2/accounts:revokeToken",dt(e,t))})}(this,n)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){return r(this,null,function*(){const n=yield this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return r(this,null,function*(){if(!this.redirectPersistenceManager){const t=e&&Ut(e)||this._popupRedirectResolver;tt(t,this,"argument-error"),this.redirectPersistenceManager=yield Bt.create(this,[Ut(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return r(this,null,function*(){var t,n;return this._isInitialized&&(yield this.queue(()=>r(this,null,function*(){}))),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return r(this,null,function*(){if(e===this.currentUser)return this.queue(()=>r(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(tt(o,this,"internal-error"),o.then(()=>{s||i(this.currentUser)}),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}directlySetCurrentUser(e){return r(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Yt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return r(this,null,function*(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=yield null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader();n&&(t["X-Firebase-Client"]=n);const r=yield this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t})}_getAppCheckToken(){return r(this,null,function*(){var e;const t=yield null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken();return(null==t?void 0:t.error)&&function(e,...t){We.logLevel<=V.WARN&&We.warn(`Auth (${Oe}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token})}}function nn(e){return P(e)}class rn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new x(e,void 0);return t.subscribe.bind(t)}(e=>this.observer=e)}get next(){return tt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let sn={loadJS(){return r(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function on(e){return sn.loadJS(e)}function an(e){return`__${e}${Math.floor(1e6*Math.random())}`}class un{constructor(e){this.type="recaptcha-enterprise",this.auth=nn(e)}verify(e="verify",t=!1){return r(this,null,function*(){function n(t,n,r){const i=window.grecaptcha;bt(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,i)=>{(function(e){return r(this,null,function*(){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((t,n)=>r(this,null,function*(){(function(e,t){return r(this,null,function*(){return ft(e,"GET","/v2/recaptchaConfig",dt(e,t))})})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new It(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})}))})})(this.auth).then(r=>{if(!t&&bt(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=sn.recaptchaEnterpriseScript;0!==t.length&&(t+=r),on(t).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})})}}function cn(e,t,n,i=!1){return r(this,null,function*(){const r=new un(e);let s;try{s=yield r.verify(n)}catch(a){s=yield r.verify(n,!0)}const o=Object.assign({},t);return i?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o})}function ln(e,t,n,i){return r(this,null,function*(){var s;if(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=yield cn(e,t,n,"getOobCode"===n);return i(e,r)}return i(e,t).catch(s=>r(this,null,function*(){if("auth/missing-recaptcha-token"===s.code){const r=yield cn(e,t,n,"getOobCode"===n);return i(e,r)}return Promise.reject(s)}))})}function hn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function dn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class fn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return nt("not implemented")}_getIdTokenResponse(e){return nt("not implemented")}_linkToIdToken(e,t){return nt("not implemented")}_getReauthenticationResolver(e){return nt("not implemented")}}function pn(e,t){return r(this,null,function*(){return ft(e,"POST","/v1/accounts:signUp",t)})}function mn(e,t){return r(this,null,function*(){return mt(e,"POST","/v1/accounts:signInWithPassword",dt(e,t))})}function gn(e,t){return r(this,null,function*(){return ft(e,"POST","/v1/accounts:sendOobCode",dt(e,t))})}function yn(e,t){return r(this,null,function*(){return gn(e,t)})}class vn extends fn{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new vn(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new vn(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return r(this,null,function*(){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ln(e,t,"signInWithPassword",mn);case"emailLink":return function(e,t){return r(this,null,function*(){return mt(e,"POST","/v1/accounts:signInWithEmailLink",dt(e,t))})}(e,{email:this._email,oobCode:this._password});default:Je(e,"internal-error")}})}_linkToIdToken(e,t){return r(this,null,function*(){switch(this.signInMethod){case"password":const n={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ln(e,n,"signUpPassword",pn);case"emailLink":return function(e,t){return r(this,null,function*(){return mt(e,"POST","/v1/accounts:signInWithEmailLink",dt(e,t))})}(e,{idToken:t,email:this._email,oobCode:this._password});default:Je(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}function _n(e,t){return r(this,null,function*(){return mt(e,"POST","/v1/accounts:signInWithIdp",dt(e,t))})}class wn extends fn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new wn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Je("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=s(t,["providerId","signInMethod"]);if(!n||!r)return null;const o=new wn(n,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){return _n(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,_n(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_n(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=N(t)}return e}}const bn={USER_NOT_FOUND:"user-not-found"};class In extends fn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new In({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new In({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return function(e,t){return r(this,null,function*(){return mt(e,"POST","/v1/accounts:signInWithPhoneNumber",dt(e,t))})}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return function(e,t){return r(this,null,function*(){const n=yield mt(e,"POST","/v1/accounts:signInWithPhoneNumber",dt(e,t));if(n.temporaryProof)throw _t(e,"account-exists-with-different-credential",n);return n})}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return function(e,t){return r(this,null,function*(){const n=Object.assign(Object.assign({},t),{operation:"REAUTH"});return mt(e,"POST","/v1/accounts:signInWithPhoneNumber",dt(e,n),bn)})}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new In({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Tn{constructor(e){var t,n,r,i,s,o;const a=D(R(e)),u=null!==(t=a.apiKey)&&void 0!==t?t:null,c=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);tt(u&&c&&l,"argument-error"),this.apiKey=u,this.operation=l,this.code=c,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=D(R(e)).link,n=t?D(R(t)).deep_link_id:null,r=D(R(e)).deep_link_id;return(r?D(R(r)).link:null)||r||n||t||e}(e);try{return new Tn(t)}catch(n){return null}}}class En{constructor(){this.providerId=En.PROVIDER_ID}static credential(e,t){return vn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Tn.parseLink(t);return tt(n,"argument-error"),vn._fromEmailAndCode(e,n.code,n.tenantId)}}En.PROVIDER_ID="password",En.EMAIL_PASSWORD_SIGN_IN_METHOD="password",En.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Sn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class kn extends Sn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Cn extends kn{constructor(){super("facebook.com")}static credential(e){return wn._fromParams({providerId:Cn.PROVIDER_ID,signInMethod:Cn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cn.credentialFromTaggedObject(e)}static credentialFromError(e){return Cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Cn.credential(e.oauthAccessToken)}catch(t){return null}}}Cn.FACEBOOK_SIGN_IN_METHOD="facebook.com",Cn.PROVIDER_ID="facebook.com";class An extends kn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return wn._fromParams({providerId:An.PROVIDER_ID,signInMethod:An.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return An.credentialFromTaggedObject(e)}static credentialFromError(e){return An.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return An.credential(t,n)}catch(r){return null}}}An.GOOGLE_SIGN_IN_METHOD="google.com",An.PROVIDER_ID="google.com";class Nn extends kn{constructor(){super("github.com")}static credential(e){return wn._fromParams({providerId:Nn.PROVIDER_ID,signInMethod:Nn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Nn.credentialFromTaggedObject(e)}static credentialFromError(e){return Nn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Nn.credential(e.oauthAccessToken)}catch(t){return null}}}Nn.GITHUB_SIGN_IN_METHOD="github.com",Nn.PROVIDER_ID="github.com";class Dn extends kn{constructor(){super("twitter.com")}static credential(e,t){return wn._fromParams({providerId:Dn.PROVIDER_ID,signInMethod:Dn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Dn.credentialFromTaggedObject(e)}static credentialFromError(e){return Dn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Dn.credential(t,n)}catch(r){return null}}}function Rn(e,t){return r(this,null,function*(){return mt(e,"POST","/v1/accounts:signUp",dt(e,t))})}Dn.TWITTER_SIGN_IN_METHOD="twitter.com",Dn.PROVIDER_ID="twitter.com";class xn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,i=!1){return r(this,null,function*(){const r=yield Lt._fromIdTokenResponse(e,n,i),s=On(n);return new xn({user:r,providerId:s,_tokenResponse:n,operationType:t})})}static _forOperation(e,t,n){return r(this,null,function*(){yield e._updateTokensIfNecessary(n,!0);const r=On(n);return new xn({user:e,providerId:r,_tokenResponse:n,operationType:t})})}}function On(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Pn extends E{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Pn.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Pn(e,t,n,r)}}function Ln(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Pn._fromErrorAndOperation(e,n,t,r);throw n})}function Mn(e,t,n=!1){return r(this,null,function*(){const r=yield At(e,t._linkToIdToken(e.auth,yield e.getIdToken()),n);return xn._forOperation(e,"link",r)})}function Un(e,t,n=!1){return r(this,null,function*(){if(De(e.app))return Promise.reject(Ze(e));const r="signIn",i=yield Ln(e,r,t),s=yield xn._fromIdTokenResponse(e,r,i);return n||(yield e._updateCurrentUser(s.user)),s})}function Fn(e,t){return r(this,null,function*(){return Un(nn(e),t)})}function Vn(e,t){return r(this,null,function*(){const n=P(e);return yield function(e,t,n){return r(this,null,function*(){var r;yield Rt(t),tt((r=t.providerData,new Set(r.map(({providerId:e})=>e).filter(e=>!!e))).has(n)===e,t.auth,"provider-already-linked")})}(!1,n,t.providerId),Mn(n,t)})}function jn(e){return r(this,null,function*(){const t=nn(e);t._getPasswordPolicyInternal()&&(yield t._updatePasswordPolicy())})}function Bn(e,t,n){return r(this,null,function*(){const n=nn(e),r={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};yield ln(n,r,"getOobCode",yn)})}function qn(e,t,n){return r(this,null,function*(){if(De(e.app))return Promise.reject(Ze(e));const r=nn(e),i=ln(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Rn),s=yield i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&jn(e),t}),o=yield xn._fromIdTokenResponse(r,"signIn",s);return yield r._updateCurrentUser(o.user),o})}function zn(e,t,n){return De(e.app)?Promise.reject(Ze(e)):Fn(P(e),En.credential(t,n)).catch(t=>r(this,null,function*(){throw"auth/password-does-not-meet-requirements"===t.code&&jn(e),t}))}function Kn(e,t){return r(this,null,function*(){const t=P(e),n={requestType:"VERIFY_EMAIL",idToken:yield e.getIdToken()},{email:i}=yield function(e,t){return r(this,null,function*(){return gn(e,t)})}(t.auth,n);i!==e.email&&(yield e.reload())})}function $n(e,t){return r(this,arguments,function*(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const i=P(e),s={idToken:yield i.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},o=yield At(i,function(e,t){return r(this,null,function*(){return ft(e,"POST","/v1/accounts:update",t)})}(i.auth,s));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const a=i.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),yield i._updateTokensIfNecessary(o)})}function Gn(e,t){return P(e).setPersistence(t)}function Hn(e,t,n,r){return P(e).onIdTokenChanged(t,n,r)}function Wn(e,t,n,r){return P(e).onAuthStateChanged(t,n,r)}function Qn(e){return P(e).signOut()}const Jn="__sak";class Xn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Jn,"1"),this.storage.removeItem(Jn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Yn extends Xn{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Xt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=w();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){return r(this,null,function*(){yield n(Yn.prototype,this,"_set").call(this,e,t),this.localCache[e]=JSON.stringify(t)})}_get(e){return r(this,null,function*(){const t=yield n(Yn.prototype,this,"_get").call(this,e);return this.localCache[e]=JSON.stringify(t),t})}_remove(e){return r(this,null,function*(){yield n(Yn.prototype,this,"_remove").call(this,e),delete this.localCache[e]})}}Yn.type="LOCAL";const Zn=Yn;class er extends Xn{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}er.type="SESSION";const tr=er;class nr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new nr(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}handleEvent(e){return r(this,null,function*(){const t=e,{eventId:n,eventType:i,data:s}=t.data,o=this.handlersMap[i];if(!(null==o?void 0:o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const a=Array.from(o).map(e=>r(this,null,function*(){return e(t.origin,s)})),u=yield function(e){return Promise.all(e.map(e=>r(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:u})})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function rr(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}nr.receivers=[];class ir{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){return r(this,null,function*(){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise((o,a)=>{const u=rr("",20);r.port1.start();const c=setTimeout(()=>{a(new Error("unsupported_event"))},n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===u)switch(t.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(c),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})})}}function sr(){return window}function or(){return void 0!==sr().WorkerGlobalScope&&"function"==typeof sr().importScripts}const ar="firebaseLocalStorageDb",ur="firebaseLocalStorage",cr="fbase_key";class lr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function hr(e,t){return e.transaction([ur],t?"readwrite":"readonly").objectStore(ur)}function dr(){const e=indexedDB.open(ar,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(ur,{keyPath:cr})}catch(r){n(r)}}),e.addEventListener("success",()=>r(this,null,function*(){const n=e.result;n.objectStoreNames.contains(ur)?t(n):(n.close(),yield function(){const e=indexedDB.deleteDatabase(ar);return new lr(e).toPromise()}(),t(yield dr()))}))})}function fr(e,t,n){return r(this,null,function*(){const r=hr(e,!0).put({[cr]:t,value:n});return new lr(r).toPromise()})}function pr(e,t){const n=hr(e,!0).delete(t);return new lr(n).toPromise()}class mr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return r(this,null,function*(){return this.db||(this.db=yield dr()),this.db})}_withRetries(e){return r(this,null,function*(){let t=0;for(;;)try{const t=yield this._openDb();return yield e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return r(this,null,function*(){return or()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return r(this,null,function*(){this.receiver=nr._getInstance(or()?self:null),this.receiver._subscribe("keyChanged",(e,t)=>r(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(t.key)}})),this.receiver._subscribe("ping",(e,t)=>r(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return r(this,null,function*(){var e,t;if(this.activeServiceWorker=yield function(){return r(this,null,function*(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(e){return null}})}(),!this.activeServiceWorker)return;this.sender=new ir(this.activeServiceWorker);const n=yield this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(e){return r(this,null,function*(){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{yield this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}})}_isAvailable(){return r(this,null,function*(){try{if(!indexedDB)return!1;const e=yield dr();return yield fr(e,Jn,"1"),yield pr(e,Jn),!0}catch(e){}return!1})}_withPendingWrite(e){return r(this,null,function*(){this.pendingWrites++;try{yield e()}finally{this.pendingWrites--}})}_set(e,t){return r(this,null,function*(){return this._withPendingWrite(()=>r(this,null,function*(){return yield this._withRetries(n=>fr(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)}))})}_get(e){return r(this,null,function*(){const t=yield this._withRetries(t=>function(e,t){return r(this,null,function*(){const n=hr(e,!1).get(t),r=yield new lr(n).toPromise();return void 0===r?null:r.value})}(t,e));return this.localCache[e]=t,t})}_remove(e){return r(this,null,function*(){return this._withPendingWrite(()=>r(this,null,function*(){return yield this._withRetries(t=>pr(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)}))})}_poll(){return r(this,null,function*(){const e=yield this._withRetries(e=>{const t=hr(e,!1).getAll();return new lr(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t})}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>r(this,null,function*(){return this._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}mr.type="LOCAL";const gr=mr,yr=1e12;class vr{constructor(e){this.auth=e,this.counter=yr,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new _r(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||yr;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||yr;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}execute(e){return r(this,null,function*(){var t;const n=e||yr;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""})}}class _r{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;tt(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<50;n++)e.push(t.charAt(Math.floor(62*Math.random())));return e.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const wr=an("rcb"),br=new at(3e4,6e4);class Ir{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=sr().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return tt(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&wt(sr().grecaptcha)?Promise.resolve(sr().grecaptcha):new Promise((n,r)=>{const i=sr().setTimeout(()=>{r(Xe(e,"network-request-failed"))},br.get());sr()[wr]=()=>{sr().clearTimeout(i),delete sr()[wr];const s=sr().grecaptcha;if(!s||!wt(s))return void r(Xe(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(s)},on(`${sn.recaptchaV2Script}?${N({onload:wr,render:"explicit",hl:t})}`).catch(()=>{clearTimeout(i),r(Xe(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=sr().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Tr{load(e){return r(this,null,function*(){return new vr(e)})}clearedOneInstance(){}}const Er="recaptcha",Sr={theme:"light",type:"image"};class kr{constructor(e,t,n=Object.assign({},Sr)){this.parameters=n,this.type=Er,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=nn(e),this.isInvisible="invisible"===this.parameters.size,tt("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof t?document.getElementById(t):t;tt(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Tr:new Ir,this.validateStartingState()}verify(){return r(this,null,function*(){this.assertNotDestroyed();const e=yield this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise(n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){tt(!this.parameters.sitekey,this.auth,"argument-error"),tt(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),tt("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof e)e(t);else if("string"==typeof e){const n=sr()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){tt(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){return r(this,null,function*(){if(yield this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId})}init(){return r(this,null,function*(){tt(st()&&!or(),this.auth,"internal-error"),yield function(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}(),this.recaptcha=yield this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=yield function(e){return r(this,null,function*(){return(yield ft(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})}(this.auth);tt(e,this.auth,"internal-error"),this.parameters.sitekey=e})}getAssertedRecaptcha(){return tt(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Cr{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=In._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}function Ar(e,t,n){return r(this,null,function*(){if(De(e.app))return Promise.reject(Ze(e));const r=nn(e),i=yield Nr(r,t,P(n));return new Cr(i,e=>Fn(r,e))})}function Nr(e,t,n){return r(this,null,function*(){var i;const s=yield n.verify();try{let o;if(tt("string"==typeof s,e,"argument-error"),tt(n.type===Er,e,"argument-error"),o="string"==typeof t?{phoneNumber:t}:t,"session"in o){const t=o.session;if("phoneNumber"in o){tt("enroll"===t.type,e,"internal-error");const n=yield function(e,t){return ft(e,"POST","/v2/accounts/mfaEnrollment:start",dt(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:o.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{tt("signin"===t.type,e,"internal-error");const n=(null===(i=o.multiFactorHint)||void 0===i?void 0:i.uid)||o.multiFactorUid;tt(n,e,"missing-multi-factor-info");const r=yield function(e,t){return ft(e,"POST","/v2/accounts/mfaSignIn:start",dt(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return r.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=yield function(e,t){return r(this,null,function*(){return ft(e,"POST","/v1/accounts:sendVerificationCode",dt(e,t))})}(e,{phoneNumber:o.phoneNumber,recaptchaToken:s});return t}}finally{n._reset()}})}class Dr{constructor(e){this.providerId=Dr.PROVIDER_ID,this.auth=nn(e)}verifyPhoneNumber(e,t){return Nr(this.auth,e,P(t))}static credential(e,t){return In._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Dr.credentialFromTaggedObject(t)}static credentialFromError(e){return Dr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?In._fromTokenResponse(t,n):null}}function Rr(e,t){return t?Ut(t):(tt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Dr.PROVIDER_ID="phone",Dr.PHONE_SIGN_IN_METHOD="phone";class xr extends fn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _n(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _n(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _n(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Or(e){return Un(e.auth,new xr(e),e.bypassAuthState)}function Pr(e){const{auth:t,user:n}=e;return tt(n,t,"internal-error"),function(e,t,n=!1){return r(this,null,function*(){const{auth:r}=e;if(De(r.app))return Promise.reject(Ze(r));const i="reauthenticate";try{const s=yield At(e,Ln(r,i,t,e),n);tt(s.idToken,r,"internal-error");const o=kt(s.idToken);tt(o,r,"internal-error");const{sub:a}=o;return tt(e.uid===a,r,"user-mismatch"),xn._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&Je(r,"user-mismatch"),s}})}(n,new xr(e),e.bypassAuthState)}function Lr(e){return r(this,null,function*(){const{auth:t,user:n}=e;return tt(n,t,"internal-error"),Mn(n,new xr(e),e.bypassAuthState)})}class Mr{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>r(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}onAuthEvent(e){return r(this,null,function*(){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(o)(a))}catch(u){this.reject(u)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Or;case"linkViaPopup":case"linkViaRedirect":return Lr;case"reauthViaPopup":case"reauthViaRedirect":return Pr;default:Je(this.auth,"internal-error")}}resolve(e){rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ur=new at(2e3,1e4);function Fr(e,t,n){return r(this,null,function*(){if(De(e.app))return Promise.reject(Xe(e,"operation-not-supported-in-this-environment"));const r=nn(e);!function(e,t){if(!(t instanceof Sn))throw Sn.name!==t.constructor.name&&Je(e,"argument-error"),Ye(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t);const i=Rr(r,n);return new Vr(r,"signInViaPopup",t,i).executeNotNull()})}class Vr extends Mr{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Vr.currentPopupAction&&Vr.currentPopupAction.cancel(),Vr.currentPopupAction=this}executeNotNull(){return r(this,null,function*(){const e=yield this.execute();return tt(e,this.auth,"internal-error"),e})}onExecution(){return r(this,null,function*(){rt(1===this.filter.length,"Popup operations only handle one event");const e=rr();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Xe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Xe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Vr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Xe(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Ur.get())};e()}}Vr.currentPopupAction=null;const jr=new Map;class Br extends Mr{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){return r(this,null,function*(){let e=jr.get(this.auth._key());if(!e){try{const t=(yield function(e,t){return r(this,null,function*(){const n=function(e){return jt("pendingRedirect",e.config.apiKey,e.name)}(t),r=function(e){return Ut(e._redirectPersistence)}(e);if(!(yield r._isAvailable()))return!1;const i="true"===(yield r._get(n));return yield r._remove(n),i})}(this.resolver,this.auth))?yield n(Br.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}jr.set(this.auth._key(),e)}return this.bypassAuthState||jr.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return r(this,null,function*(){if("signInViaRedirect"===e.type)return n(Br.prototype,this,"onAuthEvent").call(this,e);if("unknown"!==e.type){if(e.eventId){const t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,n(Br.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}}else this.resolve(null)})}onExecution(){return r(this,null,function*(){})}cleanUp(){}}function qr(e,t){jr.set(e._key(),t)}function zr(e,t){return r(this,null,function*(){return yield nn(e)._initializationPromise,Kr(e,t,!1)})}function Kr(e,t,n=!1){return r(this,null,function*(){if(De(e.app))return Promise.reject(Ze(e));const r=nn(e),i=Rr(r,t),s=new Br(r,i,n),o=yield s.execute();return o&&!n&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,t)),o})}class $r{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Hr(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Hr(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Xe(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Gr(e))}saveEventToCache(e){this.cachedEventUids.add(Gr(e)),this.lastProcessedEventTime=Date.now()}}function Gr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Hr({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Wr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Qr=/^https?/;function Jr(e){const t=it(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Qr.test(n))return!1;if(Wr.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Xr=new at(3e4,6e4);function Yr(){const e=sr().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let Zr=null;const ei=new at(5e3,15e3),ti={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ni=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ri(e){const t=e.config;tt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?ut(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:Oe},i=ni.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${N(r).slice(1)}`}function ii(e){return r(this,null,function*(){const t=yield function(e){return Zr=Zr||function(e){return new Promise((t,n)=>{var r,i,s;function o(){Yr(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Yr(),n(Xe(e,"network-request-failed"))},timeout:Xr.get()})}if(null===(i=null===(r=sr().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=sr().gapi)||void 0===s?void 0:s.load)){const t=an("iframefcb");return sr()[t]=()=>{gapi.load?o():n(Xe(e,"network-request-failed"))},on(`${sn.gapiScript}?onload=${t}`).catch(e=>n(e))}o()}}).catch(e=>{throw Zr=null,e})}(e),Zr}(e),n=sr().gapi;return tt(n,e,"internal-error"),t.open({where:document.body,url:ri(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ti,dontclear:!0},t=>new Promise((n,i)=>r(this,null,function*(){yield t.restyle({setHideOnLeave:!1});const r=Xe(e,"network-request-failed"),s=sr().setTimeout(()=>{i(r)},ei.get());function o(){sr().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})})))})}const si={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class oi{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const ai=encodeURIComponent("fac");function ui(e,t,n,i,s,o){return r(this,null,function*(){tt(e.config.authDomain,e,"auth-domain-config-required"),tt(e.config.apiKey,e,"invalid-api-key");const r={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:Oe,eventId:s};if(t instanceof Sn){t.setDefaultLanguage(e.languageCode),r.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(r.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))r[e]=t}if(t instanceof kn){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(r.scopes=e.join(","))}e.tenantId&&(r.tid=e.tenantId);const o=r;for(const e of Object.keys(o))void 0===o[e]&&delete o[e];const a=yield e._getAppCheckToken(),u=a?`#${ai}=${encodeURIComponent(a)}`:"";return`${function({config:e}){return e.emulator?ut(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${N(o).slice(1)}${u}`})}const ci="webStorageSupport",li=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tr,this._completeRedirectFn=Kr,this._overrideRedirectResult=qr}_openPopup(e,t,n,i){return r(this,null,function*(){var r;rt(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()");const s=yield ui(e,t,n,it(),i);return function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const u=Object.assign(Object.assign({},si),{width:r.toString(),height:i.toString(),top:s,left:o}),c=w().toLowerCase();n&&(a=$t(c)?"_blank":n),zt(c)&&(t=t||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=w()){var t;return Jt(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(c)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new oi(null);const h=window.open(t||"",a,l);tt(h,e,"popup-blocked");try{h.focus()}catch(d){}return new oi(h)}(e,s,rr())})}_openRedirect(e,t,n,i){return r(this,null,function*(){return yield this._originValidation(e),r=yield ui(e,t,n,it(),i),sr().location.href=r,new Promise(()=>{});var r})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(rt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}initAndGetManager(e){return r(this,null,function*(){const t=yield ii(e),n=new $r(e);return t.register("authEvent",t=>(tt(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ci,{type:ci},n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[ci];void 0!==i&&t(!!i),Je(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return r(this,null,function*(){if(e.config.emulator)return;const{authorizedDomains:t}=yield function(e){return r(this,arguments,function*(e,t={}){return ft(e,"GET","/v1/projects",t)})}(e);for(const e of t)try{if(Jr(e))return}catch(n){}Je(e,"unauthorized-domain")})}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Xt()||Kt()||Jt()}};var hi="@firebase/auth",di="1.7.9";class fi{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){return r(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){tt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const pi=y("authIdTokenMaxAge")||300;let mi=null;function gi(e=Le()){const t=Ne(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Ne(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(C(n.getOptions(),null!=t?t:{}))return e;Je(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:li,persistence:[gr,Zn,tr]}),i=y("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),e=>r(void 0,null,function*(){const t=e&&(yield e.getIdTokenResult()),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>pi)return;const r=null==t?void 0:t.token;mi!==r&&(mi=r,yield fetch(s,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))}));!function(e,t,n){P(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),Hn(n,e=>t(e))}}var s;const o=p("auth");return o&&function(e,t){const n=nn(e);tt(n._canInitEmulator,n,"emulator-config-failed"),tt(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const r=hn(t),{host:i,port:s}=function(e){const t=hn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:dn(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:dn(t)}}}(t),o=null===s?"":`:${s}`;n.config.emulator={url:`${r}//${i}${o}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:i,port:s,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})}),function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&console.info,"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${o}`),n}var yi;sn={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Xe("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},yi="Browser",Ae(new L("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;tt(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:yi,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Yt(yi)},u=new tn(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Ut);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Ae(new L("auth-internal",e=>{const t=nn(e.getProvider("auth").getImmediate());return new fi(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Me(hi,di,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(yi)),Me(hi,di,"esm2017");var vi,_i,wi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,s=this.h,o=0;o<t;){if(0==s)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i={};function s(e){return-128<=e&&128>e?function(e){var t=i;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new r([0|e],0>e?-1:0)}(e)}(e):new r([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var a=s(0),u=s(1),c=s(16777216);function l(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(u)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(l(t))throw Error("division by zero");if(l(e))return new m(a,a);if(h(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(h(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,r=t;0>=r.l(e);)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!l(r);){var c=s.add(r);0>=c.l(e)&&(i=i.add(n),s=c),r=v(r,1),n=v(n,1)}return t=f(e,i.j(t)),new m(i,t)}for(i=a;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),c=(s=o(n)).j(t);h(c)||0<c.l(e);)c=(s=o(n-=r)).j(t);l(s)&&(s=u),i=i.add(s),e=f(e,c)}return new m(i,e)}function y(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function v(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],o=0;o<i;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new r(s,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,r="";;){var i=g(n,t).g,s=((0<(n=f(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(l(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:l(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var o=i+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(c)&&0>e.l(c))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var u=this.i(i)>>>16,f=65535&this.i(i),m=e.i(s)>>>16,g=65535&e.i(s);n[2*i+2*s]+=f*g,p(n,2*i+2*s),n[2*i+2*s+1]+=u*g,p(n,2*i+2*s+1),n[2*i+2*s+1]+=f*m,p(n,2*i+2*s+1),n[2*i+2*s+2]+=u*m,p(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,_i=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=a,s=0;s<t.length;s+=8){var u=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+u),n);8>u?(u=o(Math.pow(n,u)),i=i.j(u).add(o(c))):i=(i=i.j(r)).add(o(c))}return i},vi=r}).apply(void 0!==wi?wi:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var bi,Ii,Ti,Ei,Si,ki,Ci,Ai,Ni="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ni&&Ni];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(0,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return t})}});var r=r||{},i=this||self;function s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function u(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:u).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(s(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function p(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var y=!(-1==m().indexOf("Gecko")||-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge")||-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE")||-1!=m().indexOf("Edge"));function v(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function _(e){const t={};for(const n in e)t[n]=e[n];return t}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<w.length;t++)n=w[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function I(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function T(e){i.setTimeout(()=>{throw e},0)}function E(){var e=N;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new k,e=>e.reset());class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,A=!1,N=new class{constructor(){this.h=this.g=null}add(e,t){const n=S.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},D=()=>{const e=i.Promise.resolve(void 0);C=()=>{e.then(R)}};var R=()=>{for(var e;e=E();){try{e.h.call(e.g)}catch(n){T(n)}var t=S;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}A=!1};function x(){this.s=this.s,this.C=this.C}function O(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}x.prototype.s=!1,x.prototype.ma=function(){this.s||(this.s=!0,this.N())},x.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},O.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function L(e,t){if(O.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{g(t.nodeName);var i=!0;break e}catch(s){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:M[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&L.aa.h.call(this)}}h(L,O);var M={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),F=0;function V(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++F,this.da=this.fa=!1}function j(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e){this.src=e,this.g={},this.h=0}function q(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(j(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function z(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}B.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=z(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new V(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var K="closure_lm_"+(1e6*Math.random()|0),$={};function G(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)G(e,t[s],n,r,i);return null}return n=Z(n),e&&e[U]?e.K(t,n,!!o(r)&&!!r.capture,i):function(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,u=X(e);if(u||(e[K]=u=new B(e)),(n=u.add(t,n,r,a,s)).proxy)return n;if(r=function(){const e=J;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)P||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Q(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}(e,t,n,!1,r,i)}function H(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)H(e,t[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=Z(n),e&&e[U]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=z(s=e.g[t],n,r,i))&&(j(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=X(e))&&(t=e.g[t.toString()],e=-1,t&&(e=z(t,n,r,i)),(n=-1<e?t[e]:null)&&W(n))}function W(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[U])q(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Q(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=X(t))?(q(n,e),0==n.h&&(n.src=null,t[K]=null)):j(e)}}}function Q(e){return e in $?$[e]:$[e]="on"+e}function J(e,t){if(e.da)e=!0;else{t=new L(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&W(e),e=n.call(r,t)}return e}function X(e){return(e=e[K])instanceof B?e:null}var Y="__closure_events_fn_"+(1e9*Math.random()>>>0);function Z(e){return"function"==typeof e?e:(e[Y]||(e[Y]=function(t){return e.handleEvent(t)}),e[Y])}function ee(){x.call(this),this.i=new B(this),this.M=this,this.F=null}function te(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new O(t,e);else if(t instanceof O)t.target=t.target||e;else{var i=t;b(t=new O(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=ne(o,r,!0,t)&&i}if(i=ne(o=t.g=e,r,!0,t)&&i,i=ne(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=ne(o=t.g=n[s],r,!1,t)&&i}function ne(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,u=o.ha||o.src;o.fa&&q(e.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}function re(e,t,n){if("function"==typeof e)n&&(e=c(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function ie(e){e.g=re(()=>{e.g=null,e.i&&(e.i=!1,ie(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(ee,x),ee.prototype[U]=!0,ee.prototype.removeEventListener=function(e,t,n,r){H(this,e,t,n,r)},ee.prototype.N=function(){if(ee.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)j(n[r]);delete t.g[e],t.h--}}this.F=null},ee.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ee.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class se extends x{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ie(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function oe(e){x.call(this),this.h=e,this.g={}}h(oe,x);var ae=[];function ue(e){v(e.g,function(e,t){this.g.hasOwnProperty(t)&&W(e)},e),e.g={}}oe.prototype.N=function(){oe.aa.N.call(this),ue(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ce=i.JSON.stringify,le=i.JSON.parse,he=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function de(){}function fe(e){return e.h||(e.h=e.i())}function pe(){}de.prototype.h=null;var me={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ge(){O.call(this,"d")}function ye(){O.call(this,"c")}h(ge,O),h(ye,O);var ve={},_e=null;function we(){return _e=_e||new ee}function be(e){O.call(this,ve.La,e)}function Ie(e){const t=we();te(t,new be(t))}function Te(e,t){O.call(this,ve.STAT_EVENT,e),this.stat=t}function Ee(e){const t=we();te(t,new Te(t,e))}function Se(e,t){O.call(this,ve.Ma,e),this.size=t}function ke(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Ce(){this.g=!0}function Ae(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return ce(n)}catch(a){return t}}(e,n)+(r?" "+r:"")})}ve.La="serverreachability",h(be,O),ve.STAT_EVENT="statevent",h(Te,O),ve.Ma="timingevent",h(Se,O),Ce.prototype.xa=function(){this.g=!1},Ce.prototype.info=function(){};var Ne,De={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Re={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function xe(){}function Oe(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new oe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pe}function Pe(){this.i=null,this.g="",this.h=!1}h(xe,de),xe.prototype.g=function(){return new XMLHttpRequest},xe.prototype.i=function(){return{}},Ne=new xe;var Le={},Me={};function Ue(e,t,n){e.L=1,e.v=ct(it(t)),e.m=n,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),Be(e),e.A=it(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),It(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Pe,e.g=ln(e.j,n?t:null,!e.m),0<e.O&&(e.M=new se(c(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(ae[0]=i.toString()),i=ae);for(var s=0;s<i.length;s++){var o=G(n,i[s],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?_(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ie(),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ve(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function je(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Me:(n=Number(t.substring(n,r)),isNaN(n)?Le:(r+=1)+n>t.length?Me:(t=t.slice(r,r+n),e.C=r+n,t))}function Be(e){e.S=Date.now()+e.I,qe(e,e.I)}function qe(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=ke(c(e.ba,e),t)}function ze(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function Ke(e){0==e.j.G||e.J||sn(e.j,e)}function $e(e){ze(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ue(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Ge(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Xe(n.h,e)))if(!e.K&&Xe(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(l){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;rn(n),Ht(n)}en(n),Ee(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=ke(c(n.Za,n),6e3));if(1>=Je(n.h)&&n.ca){try{n.ca()}catch(l){}n.ca=void 0}}else an(n,11)}else if((e.K||n.g==e)&&rn(n),!p(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.K=c[1],n.ia=c[2];const t=c[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=c[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const l=c[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Ye(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,ut(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=cn(r,r.J?r.ia:null,r.W),o.K){Ze(r.h,o);var a=o,u=r.L;u&&(a.I=u),a.B&&(ze(a),Be(a)),r.g=o}else Zt(r);0<n.i.length&&Qt(n)}else"stop"!=c[0]&&"close"!=c[0]||an(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?an(n,7):Gt(n):"noop"!=c[0]&&n.l&&n.l.ta(c),n.v=0)}Ie()}catch(l){}}Oe.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==qt(e)?t.j():this.Y(e)},Oe.prototype.Y=function(e){try{if(e==this.g)e:{const d=qt(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||zt(this.g)))){this.J||4!=d||7==t||Ie(),ze(this);var n=this.g.Z();this.X=n;t:if(Ve(this)){var r=zt(this.g);e="";var s=r.length,o=4==qt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){$e(this),Ke(this);var a="";break t}this.h.i=new i.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(o&&t==s-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(u)){var l=u;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,Ee(12),$e(this),Ke(this);break e}Ae(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ge(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=je(this,a),e==Me){4==d&&(this.s=4,Ee(14),n=!1),Ae(this.i,this.l,null,"[Incomplete Response]");break}if(e==Le){this.s=4,Ee(15),Ae(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Ae(this.i,this.l,e,null),Ge(this,e)}if(Ve(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Ee(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),tn(h),h.M=!0,Ee(11))}}else Ae(this.i,this.l,a,"[Invalid Chunked Response]"),$e(this),Ke(this)}else Ae(this.i,this.l,a,null),Ge(this,a);4==d&&$e(this),this.o&&!this.J&&(4==d?sn(this.j,this):(this.o=!1,Be(this)))}else(function(e){const t={};e=(e.g&&2<=qt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(p(e[r]))continue;var n=I(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Ee(12)):(this.s=0,Ee(13)),$e(this),Ke(this)}}}catch(d){}},Oe.prototype.cancel=function(){this.J=!0,$e(this)},Oe.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Ie(),Ee(17)),$e(this),this.s=2,Ke(this)):qe(this,this.S-e)};var He=class{constructor(e,t){this.g=e,this.map=t}};function We(e){this.l=e||10,e=i.PerformanceNavigationTiming?0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Je(e){return e.h?1:e.g?e.g.size:0}function Xe(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ye(e,t){e.g?e.g.add(t):e.h=t}function Ze(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function et(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function tt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(s(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(s(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(s(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}We.prototype.cancel=function(){if(this.i=et(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var nt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof rt){this.h=e.h,st(this,e.j),this.o=e.o,this.g=e.g,ot(this,e.s),this.l=e.l;var t=e.i,n=new vt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),at(this,n),this.m=e.m}else e&&(t=String(e).match(nt))?(this.h=!1,st(this,t[1]||"",!0),this.o=lt(t[2]||""),this.g=lt(t[3]||"",!0),ot(this,t[4]),this.l=lt(t[5]||"",!0),at(this,t[6]||"",!0),this.m=lt(t[7]||"")):(this.h=!1,this.i=new vt(null,this.h))}function it(e){return new rt(e)}function st(e,t,n){e.j=n?lt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ot(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function at(e,t,n){t instanceof vt?(e.i=t,function(e,t){t&&!e.j&&(_t(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(wt(this,t),It(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=ht(t,gt)),e.i=new vt(t,e.h))}function ut(e,t,n){e.i.set(t,n)}function ct(e){return ut(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function lt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ht(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,dt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function dt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}rt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ht(t,ft,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ht(t,ft,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ht(n,"/"==n.charAt(0)?mt:pt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ht(n,yt)),e.join("")};var ft=/[#\/\?@]/g,pt=/[#\?:]/g,mt=/[#\?]/g,gt=/[#\?@]/g,yt=/#/g;function vt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function _t(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function wt(e,t){_t(e),t=Tt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function bt(e,t){return _t(e),t=Tt(e,t),e.g.has(t)}function It(e,t,n){wt(e,t),0<n.length&&(e.i=null,e.g.set(Tt(e,t),d(n)),e.h+=n.length)}function Tt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Et(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(s){}}function St(){this.g=new he}function kt(e,t,n){const r=n||"";try{tt(e,function(e,n){let i=e;o(e)&&(i=ce(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Ct(e){this.l=e.Ub||null,this.j=e.eb||!1}function At(e,t){ee.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Nt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Dt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Rt(e)}function Rt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function xt(e){let t="";return v(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Ot(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=xt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ut(e,t,n))}function Pt(e){ee.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=vt.prototype).add=function(e,t){_t(this),this.i=null,e=Tt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){_t(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.na=function(){_t(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){_t(this);let t=[];if("string"==typeof e)bt(this,e)&&(t=t.concat(this.g.get(Tt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return _t(this),this.i=null,bt(this,e=Tt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")},h(Ct,de),Ct.prototype.g=function(){return new At(this.l,this.j)},Ct.prototype.i=function(e){return function(){return e}}({}),h(At,ee),(e=At.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Rt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Dt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Rt(this)),this.g&&(this.readyState=3,Rt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Dt(this):Rt(this),3==this.readyState&&Nt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Dt(this))},e.Qa=function(e){this.g&&(this.response=e,Dt(this))},e.ga=function(){this.g&&Dt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(At.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Pt,ee);var Lt=/^https?$/i,Mt=["POST","PUT"];function Ut(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Ft(e),jt(e)}function Ft(e){e.A||(e.A=!0,te(e,"complete"),te(e,"error"))}function Vt(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=qt(e)||2!=e.Z()))if(e.u&&4==qt(e))re(e.Ea,0,e);else if(te(e,"readystatechange"),4==qt(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){var o=String(e.D).match(nt)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!Lt.test(o?o.toLowerCase():"")}n=s}if(n)te(e,"complete"),te(e,"success");else{e.m=6;try{var a=2<qt(e)?e.g.statusText:""}catch(u){a=""}e.l=a+" ["+e.Z()+"]",Ft(e)}}finally{jt(e)}}}function jt(e,t){if(e.g){Bt(e);const r=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||te(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function Bt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function qt(e){return e.g?e.g.readyState:0}function zt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Kt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function $t(e){this.Aa=0,this.i=[],this.j=new Ce,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Kt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Kt("baseRetryDelayMs",5e3,e),this.cb=Kt("retryDelaySeedMs",1e4,e),this.Wa=Kt("forwardChannelMaxRetries",2,e),this.wa=Kt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new We(e&&e.concurrentRequestLimit),this.Da=new St,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Gt(e){if(Wt(e),3==e.G){var t=e.U++,n=it(e.I);if(ut(n,"SID",e.K),ut(n,"RID",t),ut(n,"TYPE","terminate"),Xt(e,n),(t=new Oe(e,e.j,t)).L=2,t.v=ct(it(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=ln(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Be(t)}un(e)}function Ht(e){e.g&&(tn(e),e.g.cancel(),e.g=null)}function Wt(e){Ht(e),e.u&&(i.clearTimeout(e.u),e.u=null),rn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Qt(e){if(!Qe(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||D(),A||(C(),A=!0),N.add(t,e),e.B=0}}function Jt(e,t){var n;n=t?t.l:e.U++;const r=it(e.I);ut(r,"SID",e.K),ut(r,"RID",n),ut(r,"AID",e.T),Xt(e,r),e.m&&e.o&&Ot(r,e.m,e.o),n=new Oe(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=Yt(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),Ye(e.h,n),Ue(n,r,t)}function Xt(e,t){e.H&&v(e.H,function(e,n){ut(t,n,e)}),e.l&&tt({},function(e,n){ut(t,n,e)})}function Yt(e,t,n){n=Math.min(e.i.length,n);var r=e.l?c(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let a=0;a<n;a++){let n=i[a].g;const u=i[a].map;if(n-=t,0>n)t=Math.max(0,i[a].g-100),o=!1;else try{kt(u,e,"req"+n+"_")}catch(s){r&&r(u)}}if(o){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function Zt(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||D(),A||(C(),A=!0),N.add(t,e),e.v=0}}function en(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=ke(c(e.Fa,e),on(e,e.v)),e.v++,0))}function tn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function nn(e){e.g=new Oe(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=it(e.qa);ut(t,"RID","rpc"),ut(t,"SID",e.K),ut(t,"AID",e.T),ut(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ut(t,"TO",e.ja),ut(t,"TYPE","xmlhttp"),Xt(e,t),e.m&&e.o&&Ot(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ct(it(t)),n.m=null,n.P=!0,Fe(n,e)}function rn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function sn(e,t){var n=null;if(e.g==t){rn(e),tn(e),e.g=null;var r=2}else{if(!Xe(e.h,t))return;n=t.D,Ze(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;te(r=we(),new Se(r,n)),Qt(e)}else Zt(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(Je(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=ke(c(e.Ga,e,t),on(e,e.B)),e.B++,0)))}(e,t)||2==r&&en(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:an(e,5);break;case 4:an(e,10);break;case 3:an(e,6);break;default:an(e,2)}}function on(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function an(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.fb,e),r=e.Xa;const t=!r;r=new rt(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||st(r,"https"),ct(r),t?function(e,t){const n=new Ce;if(i.Image){const r=new Image;r.onload=l(Et,n,"TestLoadImage: loaded",!0,t,r),r.onerror=l(Et,n,"TestLoadImage: error",!1,t,r),r.onabort=l(Et,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=l(Et,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ce;const n=new AbortController,r=setTimeout(()=>{n.abort(),Et(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?Et(0,0,!0,t):Et(0,0,!1,t)}).catch(()=>{clearTimeout(r),Et(0,0,!1,t)})}(r.toString(),n)}else Ee(2);e.G=0,e.l&&e.l.sa(t),un(e),Wt(e)}function un(e){if(e.G=0,e.ka=[],e.l){const t=et(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function cn(e,t,n){var r=n instanceof rt?it(n):new rt(n);if(""!=r.g)t&&(r.g=t+"."+r.g),ot(r,r.s);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var o=new rt(null);r&&st(o,r),t&&(o.g=t),s&&ot(o,s),n&&(o.l=n),r=o}return n=e.D,t=e.ya,n&&t&&ut(r,n,t),ut(r,"VER",e.la),Xt(e,r),r}function ln(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Pt(new Ct({eb:n})):new Pt(e.pa)).Ha(e.J),t}function hn(){}function dn(){}function fn(e,t){ee.call(this),this.g=new $t(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new gn(this)}function pn(e){ge.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function mn(){ye.call(this),this.status=1}function gn(e){this.g=e}(e=Pt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ne.g(),this.v=this.o?fe(this.o):fe(Ne),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Ut(this,o)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Mt,t,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Bt(this),this.u=!0,this.g.send(e),this.u=!1}catch(o){Ut(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,te(this,"complete"),te(this,"abort"),jt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),jt(this,!0)),Pt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Vt(this):this.bb())},e.bb=function(){Vt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<qt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),le(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=$t.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Ee(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=cn(this,null,this.W),Qt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Oe(this,this.j,e);let s=this.o;if(this.S&&(s?(s=_(s),b(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Yt(this,i,t),ut(n=it(this.I),"RID",e),ut(n,"CVER",22),this.D&&ut(n,"X-HTTP-Session-Id",this.D),Xt(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(xt(s)))+"&"+t:this.m&&Ot(n,this.m,s)),Ye(this.h,i),this.Ua&&ut(n,"TYPE","init"),this.P?(ut(n,"$req",t),ut(n,"SID","null"),i.T=!0,Ue(i,n,null)):Ue(i,n,t),this.G=2}}else 3==this.G&&(e?Jt(this,e):0==this.i.length||Qe(this.h)||Jt(this))},e.Fa=function(){if(this.u=null,nn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=ke(c(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ee(10),Ht(this),nn(this))},e.Za=function(){null!=this.C&&(this.C=null,Ht(this),en(this),Ee(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ee(2)):(this.j.info("Failed to ping google.com"),Ee(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=hn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},dn.prototype.g=function(e,t){return new fn(e,t)},h(fn,ee),fn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},fn.prototype.close=function(){Gt(this.g)},fn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ce(e),e=n);t.i.push(new He(t.Ya++,e)),3==t.G&&Qt(t)},fn.prototype.N=function(){this.g.l=null,delete this.j,Gt(this.g),delete this.g,fn.aa.N.call(this)},h(pn,ge),h(mn,ye),h(gn,hn),gn.prototype.ua=function(){te(this.g,"a")},gn.prototype.ta=function(e){te(this.g,new pn(e))},gn.prototype.sa=function(e){te(this.g,new mn)},gn.prototype.ra=function(){te(this.g,"b")},dn.prototype.createWebChannel=dn.prototype.g,fn.prototype.send=fn.prototype.o,fn.prototype.open=fn.prototype.m,fn.prototype.close=fn.prototype.close,Ai=function(){return new dn},Ci=function(){return we()},ki=ve,Si={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},De.NO_ERROR=0,De.TIMEOUT=8,De.HTTP_ERROR=6,Ei=De,Re.COMPLETE="complete",Ti=Re,pe.EventType=me,me.OPEN="a",me.CLOSE="b",me.ERROR="c",me.MESSAGE="d",ee.prototype.listen=ee.prototype.K,Ii=pe,Pt.prototype.listenOnce=Pt.prototype.L,Pt.prototype.getLastError=Pt.prototype.Ka,Pt.prototype.getLastErrorCode=Pt.prototype.Ba,Pt.prototype.getStatus=Pt.prototype.Z,Pt.prototype.getResponseJson=Pt.prototype.Oa,Pt.prototype.getResponseText=Pt.prototype.oa,Pt.prototype.send=Pt.prototype.ea,Pt.prototype.setWithCredentials=Pt.prototype.Ha,bi=Pt}).apply(void 0!==Ni?Ni:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Di="@firebase/firestore";class Ri{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ri.UNAUTHENTICATED=new Ri(null),Ri.GOOGLE_CREDENTIALS=new Ri("google-credentials-uid"),Ri.FIRST_PARTY=new Ri("first-party-uid"),Ri.MOCK_USER=new Ri("mock-user");let xi="10.14.0";const Oi=new $("@firebase/firestore");function Pi(){return Oi.logLevel}function Li(e,...t){if(Oi.logLevel<=V.DEBUG){const n=t.map(Fi);Oi.debug(`Firestore (${xi}): ${e}`,...n)}}function Mi(e,...t){if(Oi.logLevel<=V.ERROR){const n=t.map(Fi);Oi.error(`Firestore (${xi}): ${e}`,...n)}}function Ui(e,...t){if(Oi.logLevel<=V.WARN){const n=t.map(Fi);Oi.warn(`Firestore (${xi}): ${e}`,...n)}}function Fi(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(n){return e}var t}function Vi(e="Unexpected state"){const t=`FIRESTORE (${xi}) INTERNAL ASSERTION FAILED: `+e;throw Mi(t),new Error(t)}function ji(e,t){e||Vi()}function Bi(e,t){return e}const qi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class zi extends E{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ki{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class $i{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Gi{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ri.UNAUTHENTICATED))}shutdown(){}}class Hi{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Wi{constructor(e){this.t=e,this.currentUser=Ri.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ji(void 0===this.o);let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new Ki;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ki,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const t=s;e.enqueueRetryable(()=>r(this,null,function*(){yield t.promise,yield i(this.currentUser)}))},a=e=>{Li("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(Li("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ki)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(Li("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ji("string"==typeof t.accessToken),new $i(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ji(null===e||"string"==typeof e),new Ri(e)}}class Qi{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ri.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Ji{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Qi(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ri.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Xi{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Yi{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){ji(void 0===this.o);const n=e=>{null!=e.error&&Li("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,Li("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{Li("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):Li("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(ji("string"==typeof e.token),this.R=e.token,new Xi(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Zi(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class es{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Zi(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function ts(e,t){return e<t?-1:e>t?1:0}function ns(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function rs(e){return e+"\0"}class is{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new zi(qi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new zi(qi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new zi(qi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new zi(qi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return is.fromMillis(Date.now())}static fromDate(e){return is.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new is(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ts(this.nanoseconds,e.nanoseconds):ts(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ss{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ss(e)}static min(){return new ss(new is(0,0))}static max(){return new ss(new is(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class os{constructor(e,t,n){void 0===t?t=0:t>e.length&&Vi(),void 0===n?n=e.length-t:n>e.length-t&&Vi(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===os.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof os?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class as extends os{construct(e,t,n){return new as(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new zi(qi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new as(t)}static emptyPath(){return new as([])}}const us=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class cs extends os{construct(e,t,n){return new cs(e,t,n)}static isValidIdentifier(e){return us.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),cs.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new cs(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new zi(qi.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new zi(qi.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new zi(qi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new zi(qi.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new cs(t)}static emptyPath(){return new cs([])}}class ls{constructor(e){this.path=e}static fromPath(e){return new ls(as.fromString(e))}static fromName(e){return new ls(as.fromString(e).popFirst(5))}static empty(){return new ls(as.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===as.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return as.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ls(new as(e.slice()))}}class hs{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function ds(e){return e.fields.find(e=>2===e.kind)}function fs(e){return e.fields.filter(e=>2!==e.kind)}hs.UNKNOWN_ID=-1;class ps{constructor(e,t){this.fieldPath=e,this.kind=t}}class ms{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ms(0,ys.min())}}function gs(e){return new ys(e.readTime,e.key,-1)}class ys{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ys(ss.min(),ls.empty(),-1)}static max(){return new ys(ss.max(),ls.empty(),-1)}}function vs(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ls.comparator(e.documentKey,t.documentKey),0!==n?n:ts(e.largestBatchId,t.largestBatchId))}const _s="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ws{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function bs(e){return r(this,null,function*(){if(e.code!==qi.FAILED_PRECONDITION||e.message!==_s)throw e;Li("LocalStore","Unexpectedly lost primary lease")})}class Is{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Vi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Is((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Is?t:Is.resolve(t)}catch(t){return Is.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Is.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Is.reject(t)}static resolve(e){return new Is((t,n)=>{t(e)})}static reject(e){return new Is((t,n)=>{n(e)})}static waitFor(e){return new Is((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=Is.resolve(!1);for(const n of e)t=t.next(e=>e?Is.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new Is((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const u=a;t(e[u]).next(e=>{s[u]=e,++o,o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new Is((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}class Ts{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ki,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Cs(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=xs(t.target.error);this.V.reject(new Cs(e,n))}}static open(e,t,n,r){try{return new Ts(t,e.transaction(r,n))}catch(i){throw new Cs(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(Li("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Ns(t)}}class Es{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===Es.S(w())&&Mi("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Li("SimpleDb","Removing database:",e),Ds(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!I())return!1;if(Es.v())return!0;const e=w(),t=Es.S(e),n=0<t&&t<10,r=Ss(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static v(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.C)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return r(this,null,function*(){return this.db||(Li("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Cs(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new zi(qi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new zi(qi.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Cs(e,r))},r.onupgradeneeded=e=>{Li("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.O(t,r.transaction,e.oldVersion,this.version).next(()=>{Li("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return r(this,null,function*(){const r="readonly"===t;let s=0;for(;;){++s;try{this.db=yield this.M(e);const t=Ts.open(this.db,e,r?"readonly":"readwrite",n),s=i(t).next(e=>(t.g(),e)).catch(e=>(t.abort(e),Is.reject(e))).toPromise();return s.catch(()=>{}),yield t.m,s}catch(o){const e=o,t="FirebaseError"!==e.name&&s<3;if(Li("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}})}close(){this.db&&this.db.close(),this.db=void 0}}function Ss(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class ks{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Ds(this.B.delete())}}class Cs extends zi{constructor(e,t){super(qi.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function As(e){return"IndexedDbTransactionError"===e.name}class Ns{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Li("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Li("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Ds(n)}add(e){return Li("SimpleDb","ADD",this.store.name,e,e),Ds(this.store.add(e))}get(e){return Ds(this.store.get(e)).next(t=>(void 0===t&&(t=null),Li("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return Li("SimpleDb","DELETE",this.store.name,e),Ds(this.store.delete(e))}count(){return Li("SimpleDb","COUNT",this.store.name),Ds(this.store.count())}U(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new Is((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{const e=this.cursor(n),t=[];return this.W(e,(e,n)=>{t.push(n)}).next(()=>t)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Is((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}j(e,t){Li("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const r=this.cursor(n);return this.W(r,(e,t,n)=>n.delete())}J(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.W(r,t)}Y(e){const t=this.cursor({});return new Is((n,r)=>{t.onerror=e=>{const t=xs(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}W(e,t){const n=[];return new Is((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new ks(i),o=t(i.primaryKey,i.value,s);if(o instanceof Is){const e=o.catch(e=>(s.done(),Is.reject(e)));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}}).next(()=>Is.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ds(e){return new Is((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=xs(e.target.error);n(t)}})}let Rs=!1;function xs(e){const t=Es.S(w());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new zi("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Rs||(Rs=!0,setTimeout(()=>{throw e},0)),e}}return e}class Os{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){Li("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>r(this,null,function*(){this.task=null;try{Li("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(e){As(e)?Li("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield bs(e)}yield this.X(6e4)}))}}class Ps{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return r(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){const n=new Set;let r=t,i=!0;return Is.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return Li("IndexBackfiller",`Processing collection: ${t}`),this.ne(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.re(r,n)).next(n=>(Li("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}re(e,t){let n=e;return t.changes.forEach((e,t)=>{const r=gs(t);vs(r,n)>0&&(n=r)}),new ys(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Ls{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function Ms(e){return null==e}function Us(e){return 0===e&&1/e==-1/0}function Fs(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=js(t)),t=Vs(e.get(n),t);return js(t)}function Vs(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="";break;case"":n+="";break;default:n+=t}}return n}function js(e){return e+""}function Bs(e){const t=e.length;if(ji(t>=2),2===t)return ji(""===e.charAt(0)&&""===e.charAt(1)),as.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&Vi(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:Vi()}s=t+2}return new as(r)}Ls.oe=-1;const qs=["userId","batchId"];function zs(e,t){return[e,Fs(t)]}function Ks(e,t,n){return[e,Fs(t),n]}const $s={},Gs=["prefixPath","collectionGroup","readTime","documentId"],Hs=["prefixPath","collectionGroup","documentId"],Ws=["collectionGroup","readTime","prefixPath","documentId"],Qs=["canonicalId","targetId"],Js=["targetId","path"],Xs=["path","targetId"],Ys=["collectionId","parent"],Zs=["indexId","uid"],eo=["uid","sequenceNumber"],to=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],no=["indexId","uid","orderedDocumentKey"],ro=["userId","collectionPath","documentId"],io=["userId","collectionPath","largestBatchId"],so=["userId","collectionGroup","largestBatchId"],oo=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ao=[...oo,"documentOverlays"],uo=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],co=uo,lo=[...co,"indexConfiguration","indexState","indexEntries"],ho=lo,fo=[...lo,"globals"];class po extends ws{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function mo(e,t){const n=Bi(e);return Es.F(n._e,t)}function go(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function yo(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function vo(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class _o{constructor(e,t){this.comparator=e,this.root=t||bo.EMPTY}insert(e,t){return new _o(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,bo.BLACK,null,null))}remove(e){return new _o(this.comparator,this.root.remove(e,this.comparator).copy(null,null,bo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wo(this.root,e,this.comparator,!1)}getReverseIterator(){return new wo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wo(this.root,e,this.comparator,!0)}}class wo{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class bo{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:bo.RED,this.left=null!=r?r:bo.EMPTY,this.right=null!=i?i:bo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new bo(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return bo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return bo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,bo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,bo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Vi();if(this.right.isRed())throw Vi();const e=this.left.check();if(e!==this.right.check())throw Vi();return e+(this.isRed()?0:1)}}bo.EMPTY=null,bo.RED=!0,bo.BLACK=!1,bo.EMPTY=new class{constructor(){this.size=0}get key(){throw Vi()}get value(){throw Vi()}get color(){throw Vi()}get left(){throw Vi()}get right(){throw Vi()}copy(e,t,n,r,i){return this}insert(e,t,n){return new bo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Io{constructor(e){this.comparator=e,this.data=new _o(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new To(this.data.getIterator())}getIteratorFrom(e){return new To(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Io))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Io(this.comparator);return t.data=e,t}}class To{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Eo(e){return e.hasNext()?e.getNext():void 0}class So{constructor(e){this.fields=e,e.sort(cs.comparator)}static empty(){return new So([])}unionWith(e){let t=new Io(cs.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new So(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ns(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class ko extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Co{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new ko("Invalid base64 string: "+t):t}}(e);return new Co(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Co(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ts(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Co.EMPTY_BYTE_STRING=new Co("");const Ao=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function No(e){if(ji(!!e),"string"==typeof e){let t=0;const n=Ao.exec(e);if(ji(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Do(e.seconds),nanos:Do(e.nanos)}}function Do(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ro(e){return"string"==typeof e?Co.fromBase64String(e):Co.fromUint8Array(e)}function xo(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Oo(e){const t=e.mapValue.fields.__previous_value__;return xo(t)?Oo(t):t}function Po(e){const t=No(e.mapValue.fields.__local_write_time__.timestampValue);return new is(t.seconds,t.nanos)}class Lo{constructor(e,t,n,r,i,s,o,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=u}}class Mo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Mo("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Mo&&e.projectId===this.projectId&&e.database===this.database}}const Uo={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Fo={nullValue:"NULL_VALUE"};function Vo(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?xo(e)?4:ta(e)?9007199254740991:Zo(e)?10:11:Vi()}function jo(e,t){if(e===t)return!0;const n=Vo(e);if(n!==Vo(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Po(e).isEqual(Po(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=No(e.timestampValue),r=No(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,Ro(e.bytesValue).isEqual(Ro(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Do(e.geoPointValue.latitude)===Do(t.geoPointValue.latitude)&&Do(e.geoPointValue.longitude)===Do(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Do(e.integerValue)===Do(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Do(e.doubleValue),r=Do(t.doubleValue);return n===r?Us(n)===Us(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ns(e.arrayValue.values||[],t.arrayValue.values||[],jo);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(go(n)!==go(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!jo(n[i],r[i])))return!1;return!0}(e,t);default:return Vi()}var r}function Bo(e,t){return void 0!==(e.values||[]).find(e=>jo(e,t))}function qo(e,t){if(e===t)return 0;const n=Vo(e),r=Vo(t);if(n!==r)return ts(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ts(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Do(e.integerValue||e.doubleValue),r=Do(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return zo(e.timestampValue,t.timestampValue);case 4:return zo(Po(e),Po(t));case 5:return ts(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ro(e),r=Ro(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=ts(n[i],r[i]);if(0!==e)return e}return ts(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=ts(Do(e.latitude),Do(t.latitude));return 0!==n?n:ts(Do(e.longitude),Do(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Ko(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;const o=e.fields||{},a=t.fields||{},u=null===(n=o.value)||void 0===n?void 0:n.arrayValue,c=null===(r=a.value)||void 0===r?void 0:r.arrayValue,l=ts((null===(i=null==u?void 0:u.values)||void 0===i?void 0:i.length)||0,(null===(s=null==c?void 0:c.values)||void 0===s?void 0:s.length)||0);return 0!==l?l:Ko(u,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Uo.mapValue&&t===Uo.mapValue)return 0;if(e===Uo.mapValue)return 1;if(t===Uo.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=ts(r[o],s[o]);if(0!==e)return e;const t=qo(n[r[o]],i[s[o]]);if(0!==t)return t}return ts(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Vi()}}function zo(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ts(e,t);const n=No(e),r=No(t),i=ts(n.seconds,r.seconds);return 0!==i?i:ts(n.nanos,r.nanos)}function Ko(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=qo(n[i],r[i]);if(e)return e}return ts(n.length,r.length)}function $o(e){return Go(e)}function Go(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=No(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ro(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,ls.fromName(t).toString()):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Go(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Go(e.fields[i])}`;return n+"}"}(e.mapValue):Vi();var t}function Ho(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Wo(e){return!!e&&"integerValue"in e}function Qo(e){return!!e&&"arrayValue"in e}function Jo(e){return!!e&&"nullValue"in e}function Xo(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Yo(e){return!!e&&"mapValue"in e}function Zo(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ea(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return yo(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=ea(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ea(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ta(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}const na={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function ra(e){return"nullValue"in e?Fo:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Ho(Mo.empty(),ls.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?Zo(e)?na:{mapValue:{}}:Vi()}function ia(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Ho(Mo.empty(),ls.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?na:"mapValue"in e?Zo(e)?{mapValue:{}}:Uo:Vi()}function sa(e,t){const n=qo(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function oa(e,t){const n=qo(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class aa{constructor(e){this.value=e}static empty(){return new aa({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Yo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ea(t)}setAll(e){let t=cs.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=ea(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Yo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return jo(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Yo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){yo(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new aa(ea(this.value))}}function ua(e){const t=[];return yo(e.fields,(e,n)=>{const r=new cs([e]);if(Yo(n)){const e=ua(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new So(t)}class ca{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new ca(e,0,ss.min(),ss.min(),ss.min(),aa.empty(),0)}static newFoundDocument(e,t,n,r){return new ca(e,1,t,ss.min(),n,r,0)}static newNoDocument(e,t){return new ca(e,2,t,ss.min(),ss.min(),aa.empty(),0)}static newUnknownDocument(e,t){return new ca(e,3,t,ss.min(),ss.min(),aa.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ss.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=aa.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=aa.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ss.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ca&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ca(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class la{constructor(e,t){this.position=e,this.inclusive=t}}function ha(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?ls.comparator(ls.fromName(o.referenceValue),n.key):qo(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function da(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!jo(e.position[n],t.position[n]))return!1;return!0}class fa{constructor(e,t="asc"){this.field=e,this.dir=t}}function pa(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class ma{}class ga extends ma{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ka(e,t,n):"array-contains"===t?new Da(e,n):"in"===t?new Ra(e,n):"not-in"===t?new xa(e,n):"array-contains-any"===t?new Oa(e,n):new ga(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ca(e,n):new Aa(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(qo(t,this.value)):null!==t&&Vo(this.value)===Vo(t)&&this.matchesComparison(qo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Vi()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ya extends ma{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new ya(e,t)}matches(e){return va(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function va(e){return"and"===e.op}function _a(e){return"or"===e.op}function wa(e){return ba(e)&&va(e)}function ba(e){for(const t of e.filters)if(t instanceof ya)return!1;return!0}function Ia(e){if(e instanceof ga)return e.field.canonicalString()+e.op.toString()+$o(e.value);if(wa(e))return e.filters.map(e=>Ia(e)).join(",");{const t=e.filters.map(e=>Ia(e)).join(",");return`${e.op}(${t})`}}function Ta(e,t){return e instanceof ga?(n=e,(r=t)instanceof ga&&n.op===r.op&&n.field.isEqual(r.field)&&jo(n.value,r.value)):e instanceof ya?function(e,t){return t instanceof ya&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&Ta(n,t.filters[r]),!0)}(e,t):void Vi();var n,r}function Ea(e,t){const n=e.filters.concat(t);return ya.create(n,e.op)}function Sa(e){return e instanceof ga?`${(t=e).field.canonicalString()} ${t.op} ${$o(t.value)}`:e instanceof ya?function(e){return e.op.toString()+" {"+e.getFilters().map(Sa).join(" ,")+"}"}(e):"Filter";var t}class ka extends ga{constructor(e,t,n){super(e,t,n),this.key=ls.fromName(n.referenceValue)}matches(e){const t=ls.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ca extends ga{constructor(e,t){super(e,"in",t),this.keys=Na(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Aa extends ga{constructor(e,t){super(e,"not-in",t),this.keys=Na(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Na(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>ls.fromName(e.referenceValue))}class Da extends ga{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Qo(t)&&Bo(t.arrayValue,this.value)}}class Ra extends ga{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Bo(this.value.arrayValue,t)}}class xa extends ga{constructor(e,t){super(e,"not-in",t)}matches(e){if(Bo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Bo(this.value.arrayValue,t)}}class Oa extends ga{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Qo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Bo(this.value.arrayValue,e))}}class Pa{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ue=null}}function La(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Pa(e,t,n,r,i,s,o)}function Ma(e){const t=Bi(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Ia(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),Ms(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>$o(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>$o(e)).join(",")),t.ue=e}return t.ue}function Ua(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!pa(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Ta(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!da(e.startAt,t.startAt)&&da(e.endAt,t.endAt)}function Fa(e){return ls.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Va(e,t){return e.filters.filter(e=>e instanceof ga&&e.field.isEqual(t))}function ja(e,t,n){let r=Fo,i=!0;for(const s of Va(e,t)){let e=Fo,t=!0;switch(s.op){case"<":case"<=":e=ra(s.value);break;case"==":case"in":case">=":e=s.value;break;case">":e=s.value,t=!1;break;case"!=":case"not-in":e=Fo}sa({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];sa({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Ba(e,t,n){let r=Uo,i=!0;for(const s of Va(e,t)){let e=Uo,t=!0;switch(s.op){case">=":case">":e=ia(s.value),t=!1;break;case"==":case"in":case"<=":e=s.value;break;case"<":e=s.value,t=!1;break;case"!=":case"not-in":e=Uo}oa({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];oa({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class qa{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function za(e){return new qa(e)}function Ka(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function $a(e){return null!==e.collectionGroup}function Ga(e){const t=Bi(e);if(null===t.ce){t.ce=[];const e=new Set;for(const r of t.explicitOrderBy)t.ce.push(r),e.add(r.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new Io(cs.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new fa(r,n))}),e.has(cs.keyField().canonicalString())||t.ce.push(new fa(cs.keyField(),n))}return t.ce}function Ha(e){const t=Bi(e);return t.le||(t.le=function(e,t){if("F"===e.limitType)return La(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new fa(e.field,t)});const n=e.endAt?new la(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new la(e.startAt.position,e.startAt.inclusive):null;return La(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,Ga(e))),t.le}function Wa(e,t){const n=e.filters.concat([t]);return new qa(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Qa(e,t,n){return new qa(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Ja(e,t){return Ua(Ha(e),Ha(t))&&e.limitType===t.limitType}function Xa(e){return`${Ma(Ha(e))}|lt:${e.limitType}`}function Ya(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Sa(e)).join(", ")}]`),Ms(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>$o(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>$o(e)).join(",")),`Target(${t})`}(Ha(e))}; limitType=${e.limitType})`}function Za(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ls.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Ga(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(r=t,!((n=e).startAt&&!function(e,t,n){const r=ha(e,t,n);return e.inclusive?r<=0:r<0}(n.startAt,Ga(n),r)||n.endAt&&!function(e,t,n){const r=ha(e,t,n);return e.inclusive?r>=0:r>0}(n.endAt,Ga(n),r)));var n,r}function eu(e){return(t,n)=>{let r=!1;for(const i of Ga(e)){const e=tu(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function tu(e,t,n){const r=e.field.isKeyField()?ls.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?qo(r,i):Vi()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Vi()}}class nu{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){yo(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return vo(this.inner)}size(){return this.innerSize}}const ru=new _o(ls.comparator);function iu(){return ru}const su=new _o(ls.comparator);function ou(...e){let t=su;for(const n of e)t=t.insert(n.key,n);return t}function au(e){let t=su;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function uu(){return lu()}function cu(){return lu()}function lu(){return new nu(e=>e.toString(),(e,t)=>e.isEqual(t))}const hu=new _o(ls.comparator),du=new Io(ls.comparator);function fu(...e){let t=du;for(const n of e)t=t.add(n);return t}const pu=new Io(ts);function mu(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Us(t)?"-0":t}}function gu(e){return{integerValue:""+e}}function yu(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Us(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?gu(t):mu(e,t)}class vu{constructor(){this._=void 0}}function _u(e,t,n){return e instanceof Iu?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&xo(t)&&(t=Oo(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Tu?Eu(e,t):e instanceof Su?ku(e,t):function(e,t){const n=bu(e,t),r=Au(n)+Au(e.Pe);return Wo(n)&&Wo(e.Pe)?gu(r):mu(e.serializer,r)}(e,t)}function wu(e,t,n){return e instanceof Tu?Eu(e,t):e instanceof Su?ku(e,t):n}function bu(e,t){return e instanceof Cu?Wo(n=t)||(r=n)&&"doubleValue"in r?t:{integerValue:0}:null;var n,r}class Iu extends vu{}class Tu extends vu{constructor(e){super(),this.elements=e}}function Eu(e,t){const n=Nu(t);for(const r of e.elements)n.some(e=>jo(e,r))||n.push(r);return{arrayValue:{values:n}}}class Su extends vu{constructor(e){super(),this.elements=e}}function ku(e,t){let n=Nu(t);for(const r of e.elements)n=n.filter(e=>!jo(e,r));return{arrayValue:{values:n}}}class Cu extends vu{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Au(e){return Do(e.integerValue||e.doubleValue)}function Nu(e){return Qo(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Du{constructor(e,t){this.field=e,this.transform=t}}class Ru{constructor(e,t){this.version=e,this.transformResults=t}}class xu{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new xu}static exists(e){return new xu(void 0,e)}static updateTime(e){return new xu(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ou(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Pu{}function Lu(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new $u(e.key,xu.none()):new ju(e.key,e.data,xu.none());{const n=e.data,r=aa.empty();let i=new Io(cs.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Bu(e.key,r,new So(i.toArray()),xu.none())}}function Mu(e,t,n){var r;e instanceof ju?function(e,t,n){const r=e.value.clone(),i=zu(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Bu?function(e,t,n){if(!Ou(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=zu(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(qu(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):(r=n,t.convertToNoDocument(r.version).setHasCommittedMutations())}function Uu(e,t,n,r){return e instanceof ju?function(e,t,n,r){if(!Ou(e.precondition,t))return n;const i=e.value.clone(),s=Ku(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Bu?function(e,t,n,r){if(!Ou(e.precondition,t))return n;const i=Ku(e.fieldTransforms,r,t),s=t.data;return s.setAll(qu(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(i=t,s=n,Ou(e.precondition,i)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):s);var i,s}function Fu(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=bu(r.transform,e||null);null!=i&&(null===n&&(n=aa.empty()),n.set(r.field,i))}return n||null}function Vu(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&ns(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof Tu&&r instanceof Tu||n instanceof Su&&r instanceof Su?ns(n.elements,r.elements,jo):n instanceof Cu&&r instanceof Cu?jo(n.Pe,r.Pe):n instanceof Iu&&r instanceof Iu);var n,r}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class ju extends Pu{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Bu extends Pu{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function qu(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function zu(e,t,n){const r=new Map;ji(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,wu(o,a,n[i]))}return r}function Ku(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,_u(e,s,t))}return r}class $u extends Pu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Gu extends Pu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Hu{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Mu(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Uu(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Uu(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=cu();return this.mutations.forEach(r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Lu(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(ss.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),fu())}isEqual(e){return this.batchId===e.batchId&&ns(this.mutations,e.mutations,(e,t)=>Vu(e,t))&&ns(this.baseMutations,e.baseMutations,(e,t)=>Vu(e,t))}}class Wu{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){ji(e.mutations.length===n.length);let r=function(){return hu}();const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new Wu(e,t,n,r)}}class Qu{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ju{constructor(e,t){this.count=e,this.unchangedNames=t}}var Xu,Yu;function Zu(e){if(void 0===e)return Mi("GRPC error has no .code"),qi.UNKNOWN;switch(e){case Xu.OK:return qi.OK;case Xu.CANCELLED:return qi.CANCELLED;case Xu.UNKNOWN:return qi.UNKNOWN;case Xu.DEADLINE_EXCEEDED:return qi.DEADLINE_EXCEEDED;case Xu.RESOURCE_EXHAUSTED:return qi.RESOURCE_EXHAUSTED;case Xu.INTERNAL:return qi.INTERNAL;case Xu.UNAVAILABLE:return qi.UNAVAILABLE;case Xu.UNAUTHENTICATED:return qi.UNAUTHENTICATED;case Xu.INVALID_ARGUMENT:return qi.INVALID_ARGUMENT;case Xu.NOT_FOUND:return qi.NOT_FOUND;case Xu.ALREADY_EXISTS:return qi.ALREADY_EXISTS;case Xu.PERMISSION_DENIED:return qi.PERMISSION_DENIED;case Xu.FAILED_PRECONDITION:return qi.FAILED_PRECONDITION;case Xu.ABORTED:return qi.ABORTED;case Xu.OUT_OF_RANGE:return qi.OUT_OF_RANGE;case Xu.UNIMPLEMENTED:return qi.UNIMPLEMENTED;case Xu.DATA_LOSS:return qi.DATA_LOSS;default:return Vi()}}(Yu=Xu||(Xu={}))[Yu.OK=0]="OK",Yu[Yu.CANCELLED=1]="CANCELLED",Yu[Yu.UNKNOWN=2]="UNKNOWN",Yu[Yu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Yu[Yu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Yu[Yu.NOT_FOUND=5]="NOT_FOUND",Yu[Yu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Yu[Yu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Yu[Yu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Yu[Yu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Yu[Yu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Yu[Yu.ABORTED=10]="ABORTED",Yu[Yu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Yu[Yu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Yu[Yu.INTERNAL=13]="INTERNAL",Yu[Yu.UNAVAILABLE=14]="UNAVAILABLE",Yu[Yu.DATA_LOSS=15]="DATA_LOSS";const ec=new vi([4294967295,4294967295],0);function tc(e){const t=(new TextEncoder).encode(e),n=new _i;return n.update(t),new Uint8Array(n.digest())}function nc(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new vi([n,r],0),new vi([i,s],0)]}class rc{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ic(`Invalid padding: ${t}`);if(n<0)throw new ic(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new ic(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ic(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=vi.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(vi.fromNumber(n)));return 1===r.compare(ec)&&(r=new vi([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=tc(e),[n,r]=nc(t);for(let i=0;i<this.hashCount;i++){const e=this.Ee(n,r,i);if(!this.de(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new rc(i,r,t);return n.forEach(e=>s.insert(e)),s}insert(e){if(0===this.Ie)return;const t=tc(e),[n,r]=nc(t);for(let i=0;i<this.hashCount;i++){const e=this.Ee(n,r,i);this.Ae(e)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ic extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class sc{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,oc.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new sc(ss.min(),r,new _o(ts),iu(),fu())}}class oc{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new oc(n,t,fu(),fu(),fu())}}class ac{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class uc{constructor(e,t){this.targetId=e,this.me=t}}class cc{constructor(e,t,n=Co.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class lc{constructor(){this.fe=0,this.ge=fc(),this.pe=Co.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=fu(),t=fu(),n=fu();return this.ge.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Vi()}}),new oc(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=fc()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ji(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class hc{constructor(e){this.Le=e,this.Be=new Map,this.ke=iu(),this.qe=dc(),this.Qe=new _o(ts)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Vi()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((e,n)=>{this.ze(n)&&t(n)})}He(e){const t=e.targetId,n=e.me.count,r=this.Je(t);if(r){const i=r.target;if(Fa(i))if(0===n){const e=new ls(i.path);this.Ue(t,e,ca.newNoDocument(e,ss.min()))}else ji(1===n);else{const r=this.Ye(t);if(r!==n){const n=this.Ze(e),i=n?this.Xe(n,e,r):1;if(0!==i){this.je(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=Ro(n).toUint8Array()}catch(a){if(a instanceof ko)return Ui("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{o=new rc(s,r,i)}catch(a){return Ui(a instanceof ic?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return 0===o.Ie?null:o}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const i=this.Le.tt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.Ue(t,n,null),r++)}),r}rt(e){const t=new Map;this.Be.forEach((n,r)=>{const i=this.Je(r);if(i){if(n.current&&Fa(i.target)){const t=new ls(i.target.path);null!==this.ke.get(t)||this.it(r,t)||this.Ue(r,t,ca.newNoDocument(t,e))}n.be&&(t.set(r,n.ve()),n.Ce())}});let n=fu();this.qe.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.ke.forEach((t,n)=>n.setReadTime(e));const r=new sc(e,t,this.Qe,this.ke,n);return this.ke=iu(),this.qe=dc(),this.Qe=new _o(ts),r}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new lc,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Io(ts),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||Li("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new lc),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function dc(){return new _o(ls.comparator)}function fc(){return new _o(ls.comparator)}const pc=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),mc=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),gc=(()=>({and:"AND",or:"OR"}))();class yc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function vc(e,t){return e.useProto3Json||Ms(t)?t:{value:t}}function _c(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function wc(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function bc(e,t){return _c(e,t.toTimestamp())}function Ic(e){return ji(!!e),ss.fromTimestamp(function(e){const t=No(e);return new is(t.seconds,t.nanos)}(e))}function Tc(e,t){return Ec(e,t).canonicalString()}function Ec(e,t){const n=(r=e,new as(["projects",r.projectId,"databases",r.database])).child("documents");var r;return void 0===t?n:n.child(t)}function Sc(e){const t=as.fromString(e);return ji(Gc(t)),t}function kc(e,t){return Tc(e.databaseId,t.path)}function Cc(e,t){const n=Sc(t);if(n.get(1)!==e.databaseId.projectId)throw new zi(qi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new zi(qi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ls(Rc(n))}function Ac(e,t){return Tc(e.databaseId,t)}function Nc(e){const t=Sc(e);return 4===t.length?as.emptyPath():Rc(t)}function Dc(e){return new as(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Rc(e){return ji(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function xc(e,t,n){return{name:kc(e,t),fields:n.value.mapValue.fields}}function Oc(e,t){let n;if(t instanceof ju)n={update:xc(e,t.key,t.value)};else if(t instanceof $u)n={delete:kc(e,t.key)};else if(t instanceof Bu)n={update:xc(e,t.key,t.data),updateMask:$c(t.fieldMask)};else{if(!(t instanceof Gu))return Vi();n={verify:kc(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Iu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Tu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Su)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Cu)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw Vi()}(0,e))),t.precondition.isNone||(n.currentDocument=(r=e,void 0!==(i=t.precondition).updateTime?{updateTime:bc(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:Vi())),n;var r,i}function Pc(e,t){const n=t.currentDocument?void 0!==(i=t.currentDocument).updateTime?xu.updateTime(Ic(i.updateTime)):void 0!==i.exists?xu.exists(i.exists):xu.none():xu.none(),r=t.updateTransforms?t.updateTransforms.map(t=>function(e,t){let n=null;if("setToServerValue"in t)ji("REQUEST_TIME"===t.setToServerValue),n=new Iu;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Tu(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Su(e)}else"increment"in t?n=new Cu(e,t.increment):Vi();const r=cs.fromServerFormat(t.fieldPath);return new Du(r,n)}(e,t)):[];var i;if(t.update){t.update.name;const i=Cc(e,t.update.name),s=new aa({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new So(t.map(e=>cs.fromServerFormat(e)))}(t.updateMask);return new Bu(i,s,e,n,r)}return new ju(i,s,n,r)}if(t.delete){const r=Cc(e,t.delete);return new $u(r,n)}if(t.verify){const r=Cc(e,t.verify);return new Gu(r,n)}return Vi()}function Lc(e,t){return{documents:[Ac(e,t.path)]}}function Mc(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ac(e,i);const s=function(e){if(0!==e.length)return Kc(ya.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map(e=>{return{field:qc((t=e).field),direction:Vc(t.dir)};var t})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=vc(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt={before:(u=t.startAt).inclusive,values:u.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:i};var u}function Uc(e){let t=Nc(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){ji(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Fc(e);return t instanceof ya&&wa(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new fa(zc((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ms(t)?null:t}(n.limit));let u=null;n.startAt&&(u=function(e){const t=!!e.before,n=e.values||[];return new la(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new la(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new qa(e,t,n,r,i,"F",o,a)}(t,i,o,s,a,0,u,c)}function Fc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=zc(e.unaryFilter.field);return ga.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=zc(e.unaryFilter.field);return ga.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=zc(e.unaryFilter.field);return ga.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=zc(e.unaryFilter.field);return ga.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Vi()}}(e):void 0!==e.fieldFilter?(t=e,ga.create(zc(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Vi()}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return ya.create(e.compositeFilter.filters.map(e=>Fc(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Vi()}}(e.compositeFilter.op))}(e):Vi();var t}function Vc(e){return pc[e]}function jc(e){return mc[e]}function Bc(e){return gc[e]}function qc(e){return{fieldPath:e.canonicalString()}}function zc(e){return cs.fromServerFormat(e.fieldPath)}function Kc(e){return e instanceof ga?function(e){if("=="===e.op){if(Xo(e.value))return{unaryFilter:{field:qc(e.field),op:"IS_NAN"}};if(Jo(e.value))return{unaryFilter:{field:qc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Xo(e.value))return{unaryFilter:{field:qc(e.field),op:"IS_NOT_NAN"}};if(Jo(e.value))return{unaryFilter:{field:qc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qc(e.field),op:jc(e.op),value:e.value}}}(e):e instanceof ya?function(e){const t=e.getFilters().map(e=>Kc(e));return 1===t.length?t[0]:{compositeFilter:{op:Bc(e.op),filters:t}}}(e):Vi()}function $c(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Gc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Hc{constructor(e,t,n,r,i=ss.min(),s=ss.min(),o=Co.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Hc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Hc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Hc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Hc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Wc{constructor(e){this.ct=e}}function Qc(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Jc(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:kc(i=e.ct,(s=t).key),fields:s.data.value.mapValue.fields,updateTime:_c(i,s.version.toTimestamp()),createTime:_c(i,s.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Xc(t.version)};else{if(!t.isUnknownDocument())return Vi();r.unknownDocument={path:n.path.toArray(),version:Xc(t.version)}}var i,s;return r}function Jc(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Xc(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Yc(e){const t=new is(e.seconds,e.nanoseconds);return ss.fromTimestamp(t)}function Zc(e,t){const n=(t.baseMutations||[]).map(t=>Pc(e.ct,t));for(let s=0;s<t.mutations.length-1;++s){const e=t.mutations[s];if(s+1<t.mutations.length&&void 0!==t.mutations[s+1].transform){const n=t.mutations[s+1];e.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}const r=t.mutations.map(t=>Pc(e.ct,t)),i=is.fromMillis(t.localWriteTimeMs);return new Hu(t.batchId,i,n,r)}function el(e){const t=Yc(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Yc(e.lastLimboFreeSnapshotVersion):ss.min();let r;return r=void 0!==e.query.documents?(ji(1===(i=e.query).documents.length),Ha(za(Nc(i.documents[0])))):function(e){return Ha(Uc(e))}(e.query),new Hc(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,Co.fromBase64String(e.resumeToken));var i}function tl(e,t){const n=Xc(t.snapshotVersion),r=Xc(t.lastLimboFreeSnapshotVersion);let i;i=Fa(t.target)?Lc(e.ct,t.target):Mc(e.ct,t.target)._t;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Ma(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function nl(e){const t=Uc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Qa(t,t.limit,"L"):t}function rl(e,t){return new Qu(t.largestBatchId,Pc(e.ct,t.overlayMutation))}function il(e,t){const n=t.path.lastSegment();return[e,Fs(t.path.popLast()),n]}function sl(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:Xc(r.readTime),documentKey:Fs(r.documentKey.path),largestBatchId:r.largestBatchId}}class ol{getBundleMetadata(e,t){return al(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:Yc(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return al(e).put({bundleId:(n=t).id,createTime:Xc(Ic(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return ul(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:nl(t.bundledQuery),readTime:Yc(t.readTime)};var t})}saveNamedQuery(e,t){return ul(e).put({name:(n=t).name,readTime:Xc(Ic(n.readTime)),bundledQuery:n.bundledQuery});var n}}function al(e){return mo(e,"bundles")}function ul(e){return mo(e,"namedQueries")}class cl{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const n=t.uid||"";return new cl(e,n)}getOverlay(e,t){return ll(e).get(il(this.userId,t)).next(e=>e?rl(this.serializer,e):null)}getOverlays(e,t){const n=uu();return Is.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){const r=[];return n.forEach((n,i)=>{const s=new Qu(t,i);r.push(this.ht(e,s))}),Is.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach(e=>r.add(Fs(e.getCollectionPath())));const i=[];return r.forEach(t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(ll(e).j("collectionPathOverlayIndex",r))}),Is.waitFor(i)}getOverlaysForCollection(e,t,n){const r=uu(),i=Fs(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ll(e).U("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=rl(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){const i=uu();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ll(e).J({index:"collectionGroupOverlayIndex",range:o},(e,t,n)=>{const o=rl(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()}).next(()=>i)}ht(e,t){return ll(e).put(function(e,t,n){const[r,i,s]=il(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Oc(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function ll(e){return mo(e,"documentOverlays")}class hl{Pt(e){return mo(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(e=>{const t=null==e?void 0:e.value;return t?Co.fromUint8Array(t):Co.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class dl{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Do(e.integerValue));else if("doubleValue"in e){const n=Do(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Us(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=No(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Ro(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?ta(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Zo(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Vi()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const r of Object.keys(n))this.Vt(r,t),this.Tt(n[r],t)}wt(e,t){var n,r;const i=e.fields||{};this.dt(t,53);const s="value",o=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.dt(t,15),t.At(Do(o)),this.Vt(s,t),this.Tt(i[s],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const r of n)this.Tt(r,t)}yt(e,t){this.dt(t,37),ls.fromName(e).path.forEach(e=>{this.dt(t,60),this.Dt(e,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function fl(e){if(0===e)return 8;let t=0;return!(e>>4)&&(t+=4,e<<=4),!(e>>6)&&(t+=2,e<<=2),!(e>>7)&&(t+=1),t}function pl(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=fl(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}dl.vt=new dl;class ml{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ft(e);else if(e<2048)this.Ft(960|e>>>6),this.Ft(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e);else{const e=t.codePointAt(0);this.Ft(240|e>>>18),this.Ft(128|63&e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e)}}this.Mt()}Bt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ot(e);else if(e<2048)this.Ot(960|e>>>6),this.Ot(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|e>>>12),this.Ot(128|63&e>>>6),this.Ot(128|63&e);else{const e=t.codePointAt(0);this.Ot(240|e>>>18),this.Ot(128|63&e>>>12),this.Ot(128|63&e>>>6),this.Ot(128|63&e)}}this.Nt()}kt(e){const t=this.qt(e),n=pl(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Kt(e){const t=this.qt(e),n=pl(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Ft(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class gl{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class yl{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class vl{constructor(){this.jt=new ml,this.Ht=new gl(this.jt),this.Jt=new yl(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class _l{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Zt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new _l(this.indexId,this.documentKey,this.arrayValue,n)}}function wl(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=bl(e.arrayValue,t.arrayValue),0!==n?n:(n=bl(e.directionalValue,t.directionalValue),0!==n?n:ls.comparator(e.documentKey,t.documentKey)))}function bl(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Il{constructor(e){this.Xt=new Io((e,t)=>cs.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const e=t;e.isInequality()?this.Xt=this.Xt.add(e):this.tn.push(e)}}get nn(){return this.Xt.size>1}rn(e){if(ji(e.collectionGroup===this.collectionId),this.nn)return!1;const t=ds(e);if(void 0!==t&&!this.sn(t))return!1;const n=fs(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.sn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Xt.size>0){const e=this.Xt.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.on(e,t)||!this._n(this.en[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.en.length||!this._n(this.en[s++],e))return!1}return!0}an(){if(this.nn)return null;let e=new Io(cs.comparator);const t=[];for(const n of this.tn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new ps(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new ps(n.field,0))}for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new ps(n.field,"asc"===n.dir?0:1)));return new hs(hs.UNKNOWN_ID,this.collectionId,t,ms.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Tl(e){var t,n;if(ji(e instanceof ga||e instanceof ya),e instanceof ga){if(e instanceof Ra){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map(t=>ga.create(e.field,"==",t)))||[];return ya.create(r,"or")}return e}const r=e.filters.map(e=>Tl(e));return ya.create(r,e.op)}function El(e){if(0===e.getFilters().length)return[];const t=Al(Tl(e));return ji(Cl(t)),Sl(t)||kl(t)?[t]:t.getFilters()}function Sl(e){return e instanceof ga}function kl(e){return e instanceof ya&&wa(e)}function Cl(e){return Sl(e)||kl(e)||function(e){if(e instanceof ya&&_a(e)){for(const t of e.getFilters())if(!Sl(t)&&!kl(t))return!1;return!0}return!1}(e)}function Al(e){if(ji(e instanceof ga||e instanceof ya),e instanceof ga)return e;if(1===e.filters.length)return Al(e.filters[0]);const t=e.filters.map(e=>Al(e));let n=ya.create(t,e.op);return n=Rl(n),Cl(n)?n:(ji(n instanceof ya),ji(va(n)),ji(n.filters.length>1),n.filters.reduce((e,t)=>Nl(e,t)))}function Nl(e,t){let n;return ji(e instanceof ga||e instanceof ya),ji(t instanceof ga||t instanceof ya),n=e instanceof ga?t instanceof ga?(r=e,i=t,ya.create([r,i],"and")):Dl(e,t):t instanceof ga?Dl(t,e):function(e,t){if(ji(e.filters.length>0&&t.filters.length>0),va(e)&&va(t))return Ea(e,t.getFilters());const n=_a(e)?e:t,r=_a(e)?t:e,i=n.filters.map(e=>Nl(e,r));return ya.create(i,"or")}(e,t),Rl(n);var r,i}function Dl(e,t){if(va(t))return Ea(t,e.getFilters());{const n=t.filters.map(t=>Nl(e,t));return ya.create(n,"or")}}function Rl(e){if(ji(e instanceof ga||e instanceof ya),e instanceof ga)return e;const t=e.getFilters();if(1===t.length)return Rl(t[0]);if(ba(e))return e;const n=t.map(e=>Rl(e)),r=[];return n.forEach(t=>{t instanceof ga?r.push(t):t instanceof ya&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:ya.create(r,e.op)}class xl{constructor(){this.un=new Ol}addToCollectionParentIndex(e,t){return this.un.add(t),Is.resolve()}getCollectionParents(e,t){return Is.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return Is.resolve()}deleteFieldIndex(e,t){return Is.resolve()}deleteAllFieldIndexes(e){return Is.resolve()}createTargetIndexes(e,t){return Is.resolve()}getDocumentsMatchingTarget(e,t){return Is.resolve(null)}getIndexType(e,t){return Is.resolve(0)}getFieldIndexes(e,t){return Is.resolve([])}getNextCollectionGroupToUpdate(e){return Is.resolve(null)}getMinOffset(e,t){return Is.resolve(ys.min())}getMinOffsetFromCollectionGroup(e,t){return Is.resolve(ys.min())}updateCollectionGroup(e,t,n){return Is.resolve()}updateIndexEntries(e,t){return Is.resolve()}}class Ol{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Io(as.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Io(as.comparator)).toArray()}}const Pl=new Uint8Array(0);class Ll{constructor(e,t){this.databaseId=t,this.cn=new Ol,this.ln=new nu(e=>Ma(e),(e,t)=>Ua(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:n,parent:Fs(r)};return Ml(e).put(i)}return Is.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[rs(t),""],!1,!0);return Ml(e).U(r).next(e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Bs(r.parent))}return n})}addFieldIndex(e,t){const n=Fl(e),r={indexId:(i=t).indexId,collectionGroup:i.collectionGroup,fields:i.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};var i;delete r.indexId;const s=n.add(r);if(t.indexState){const n=Vl(e);return s.next(e=>{n.put(sl(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=Fl(e),r=Vl(e),i=Ul(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Fl(e),n=Ul(e),r=Vl(e);return t.j().next(()=>n.j()).next(()=>r.j())}createTargetIndexes(e,t){return Is.forEach(this.hn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){const n=new Il(t).an();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){const n=Ul(e);let r=!0;const i=new Map;return Is.forEach(this.hn(t),t=>this.Pn(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=fu();const r=[];return Is.forEach(i,(i,s)=>{var o;Li("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${Ma(t)}`);const a=function(e,t){const n=ds(t);if(void 0===n)return null;for(const r of Va(e,n.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}(s,i),u=function(e,t){const n=new Map;for(const r of fs(t))for(const t of Va(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),c=function(e,t){const n=[];let r=!0;for(const i of fs(t)){const t=0===i.kind?ja(e,i.fieldPath,e.startAt):Ba(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new la(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of fs(t)){const t=0===i.kind?Ba(e,i.fieldPath,e.endAt):ja(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new la(n,r)}(s,i),h=this.In(i,s,c),d=this.In(i,s,l),f=this.Tn(i,s,u),p=this.En(i.indexId,a,h,c.inclusive,d,l.inclusive,f);return Is.forEach(p,i=>n.G(i,t.limit).next(t=>{t.forEach(t=>{const n=ls.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return Is.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:El(ya.create(e.filters,"and")).map(t=>La(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),u=a/(null!=t?t.length:1),c=[];for(let l=0;l<a;++l){const a=t?this.dn(t[l/u]):Pl,h=this.An(e,a,n[l%u],r),d=this.Rn(e,a,i[l%u],s),f=o.map(t=>this.An(e,a,t,!0));c.push(...this.createRange(h,d,f))}return c}An(e,t,n,r){const i=new _l(e,ls.empty(),t,n);return r?i:i.Zt()}Rn(e,t,n,r){const i=new _l(e,ls.empty(),t,n);return r?i.Zt():i}Pn(e,t){const n=new Il(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(const r of e)n.rn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2;const r=this.hn(t);return Is.forEach(r,t=>this.Pn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new Io(cs.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}Vn(e,t){const n=new vl;for(const r of fs(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.Yt(r.kind);dl.vt.It(e,i)}return n.zt()}dn(e){const t=new vl;return dl.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new vl;return dl.vt.It(Ho(this.databaseId,t),n.Yt(function(e){const t=fs(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(null===n)return[];let r=[];r.push(new vl);let i=0;for(const s of fs(e)){const e=n[i++];for(const n of r)if(this.fn(t,s.fieldPath)&&Qo(e))r=this.gn(r,s,e);else{const t=n.Yt(s.kind);dl.vt.It(e,t)}}return this.pn(r)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const r=[...e],i=[];for(const s of n.arrayValue.values||[])for(const e of r){const n=new vl;n.seed(e.zt()),dl.vt.It(s,n.Yt(t.kind)),i.push(n)}return i}fn(e,t){return!!e.filters.find(e=>e instanceof ga&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=Fl(e),r=Vl(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(e=>{const t=[];return Is.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){const n=t?new ms(t.sequenceNumber,new ys(Yc(t.readTime),new ls(Bs(t.documentKey)),t.largestBatchId)):ms.empty(),r=e.fields.map(([e,t])=>new ps(cs.fromServerFormat(e),t));return new hs(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:ts(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){const r=Fl(e),i=Vl(e);return this.yn(e).next(e=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>Is.forEach(t,t=>i.put(sl(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){const n=new Map;return Is.forEach(t,(t,r)=>{const i=n.get(t.collectionGroup);return(i?Is.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),Is.forEach(i,n=>this.wn(e,t,n).next(t=>{const i=this.Sn(r,n);return t.isEqual(i)?Is.resolve():this.bn(e,r,n,t,i)}))))})}Dn(e,t,n,r){return Ul(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,r){return Ul(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const r=Ul(e);let i=new Io(wl);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(e,r)=>{i=i.add(new _l(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}Sn(e,t){let n=new Io(wl);const r=this.Vn(t,e);if(null==r)return n;const i=ds(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Qo(s))for(const i of s.arrayValue.values||[])n=n.add(new _l(t.indexId,e.key,this.dn(i),r))}else n=n.add(new _l(t.indexId,e.key,Pl,r));return n}bn(e,t,n,r,i){Li("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=Eo(s),u=Eo(o);for(;a||u;){let e=!1,t=!1;if(a&&u){const r=n(a,u);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(u),u=Eo(o)):t?(i(a),a=Eo(s)):(a=Eo(s),u=Eo(o))}}(r,i,wl,r=>{s.push(this.Dn(e,t,n,r))},r=>{s.push(this.vn(e,t,n,r))}),Is.waitFor(s)}yn(e){let t=1;return Vl(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>wl(e,t)).filter((e,t,n)=>!t||0!==wl(e,n[t-1]));const r=[];r.push(e);for(const s of n){const n=wl(s,e),i=wl(s,t);if(0===n)r[0]=e.Zt();else if(n>0&&i<0)r.push(s),r.push(s.Zt());else if(i>0)break}r.push(t);const i=[];for(let s=0;s<r.length;s+=2){if(this.Cn(r[s],r[s+1]))return[];const e=[r[s].indexId,this.uid,r[s].arrayValue,r[s].directionalValue,Pl,[]],t=[r[s+1].indexId,this.uid,r[s+1].arrayValue,r[s+1].directionalValue,Pl,[]];i.push(IDBKeyRange.bound(e,t))}return i}Cn(e,t){return wl(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(jl)}getMinOffset(e,t){return Is.mapArray(this.hn(t),t=>this.Pn(e,t).next(e=>e||Vi())).next(jl)}}function Ml(e){return mo(e,"collectionParents")}function Ul(e){return mo(e,"indexEntries")}function Fl(e){return mo(e,"indexConfiguration")}function Vl(e){return mo(e,"indexState")}function jl(e){ji(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;vs(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new ys(t.readTime,t.documentKey,n)}const Bl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ql{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ql(e,ql.DEFAULT_COLLECTION_PERCENTILE,ql.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function zl(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const u=r.J({range:o},(e,t,n)=>(a++,n.delete()));s.push(u.next(()=>{ji(1===a)}));const c=[];for(const l of n.mutations){const e=Ks(t,l.key.path,n.batchId);s.push(i.delete(e)),c.push(l.key)}return Is.waitFor(s).next(()=>c)}function Kl(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Vi();t=e.noDocument}return JSON.stringify(t).length}ql.DEFAULT_COLLECTION_PERCENTILE=10,ql.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ql.DEFAULT=new ql(41943040,ql.DEFAULT_COLLECTION_PERCENTILE,ql.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ql.DISABLED=new ql(-1,0,0);class $l{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Fn={}}static lt(e,t,n,r){ji(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new $l(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Hl(e).J({index:"userMutationsIndex",range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){const i=Wl(e),s=Hl(e);return s.add({}).next(o=>{ji("number"==typeof o);const a=new Hu(o,t,n,r),u=function(e,t,n){const r=n.baseMutations.map(t=>Oc(e.ct,t)),i=n.mutations.map(t=>Oc(e.ct,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),c=[];let l=new Io((e,t)=>ts(e.canonicalString(),t.canonicalString()));for(const e of r){const t=Ks(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),c.push(s.put(u)),c.push(i.put(t,$s))}return l.forEach(t=>{c.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Fn[o]=a.keys()}),Is.waitFor(c).next(()=>a)})}lookupMutationBatch(e,t){return Hl(e).get(t).next(e=>e?(ji(e.userId===this.userId),Zc(this.serializer,e)):null)}Mn(e,t){return this.Fn[t]?Is.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){const n=e.keys();return this.Fn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Hl(e).J({index:"userMutationsIndex",range:r},(e,t,r)=>{t.userId===this.userId&&(ji(t.batchId>=n),i=Zc(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Hl(e).J({index:"userMutationsIndex",range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Hl(e).U("userMutationsIndex",t).next(e=>e.map(e=>Zc(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=zs(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Wl(e).J({range:r},(n,r,s)=>{const[o,a,u]=n,c=Bs(a);if(o===this.userId&&t.path.isEqual(c))return Hl(e).get(u).next(e=>{if(!e)throw Vi();ji(e.userId===this.userId),i.push(Zc(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Io(ts);const r=[];return t.forEach(t=>{const i=zs(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Wl(e).J({range:s},(e,r,i)=>{const[s,o,a]=e,u=Bs(o);s===this.userId&&t.path.isEqual(u)?n=n.add(a):i.done()});r.push(o)}),Is.waitFor(r).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=zs(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new Io(ts);return Wl(e).J({range:s},(e,t,i)=>{const[s,a,u]=e,c=Bs(a);s===this.userId&&n.isPrefixOf(c)?c.length===r&&(o=o.add(u)):i.done()}).next(()=>this.xn(e,o))}xn(e,t){const n=[],r=[];return t.forEach(t=>{r.push(Hl(e).get(t).next(e=>{if(null===e)throw Vi();ji(e.userId===this.userId),n.push(Zc(this.serializer,e))}))}),Is.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return zl(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),Is.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return Is.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return Wl(e).J({range:n},(e,t,n)=>{if(e[0]===this.userId){const t=Bs(e[1]);r.push(t)}else n.done()}).next(()=>{ji(0===r.length)})})}containsKey(e,t){return Gl(e,this.userId,t)}Nn(e){return Ql(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Gl(e,t,n){const r=zs(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Wl(e).J({range:s,H:!0},(e,n,r)=>{const[s,a,u]=e;s===t&&a===i&&(o=!0),r.done()}).next(()=>o)}function Hl(e){return mo(e,"mutations")}function Wl(e){return mo(e,"documentMutations")}function Ql(e){return mo(e,"mutationQueues")}class Jl{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Jl(0)}static kn(){return new Jl(-1)}}class Xl{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const n=new Jl(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(e=>ss.fromTimestamp(new is(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Qn(e,r)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Yl(e).delete(t.targetId)).next(()=>this.qn(e)).next(t=>(ji(t.targetCount>0),t.targetCount-=1,this.Qn(e,t)))}removeTargets(e,t,n){let r=0;const i=[];return Yl(e).J((s,o)=>{const a=el(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))}).next(()=>Is.waitFor(i)).next(()=>r)}forEachTarget(e,t){return Yl(e).J((e,n)=>{const r=el(n);t(r)})}qn(e){return Zl(e).get("targetGlobalKey").next(e=>(ji(null!==e),e))}Qn(e,t){return Zl(e).put("targetGlobalKey",t)}Kn(e,t){return Yl(e).put(tl(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(e=>e.targetCount)}getTargetData(e,t){const n=Ma(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Yl(e).J({range:r,index:"queryTargetsIndex"},(e,n,r)=>{const s=el(n);Ua(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){const r=[],i=eh(e);return t.forEach(t=>{const s=Fs(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),Is.waitFor(r)}removeMatchingKeys(e,t,n){const r=eh(e);return Is.forEach(t,t=>{const i=Fs(t.path);return Is.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){const n=eh(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=eh(e);let i=fu();return r.J({range:n,H:!0},(e,t,n)=>{const r=Bs(e[1]),s=new ls(r);i=i.add(s)}).next(()=>i)}containsKey(e,t){const n=Fs(t.path),r=IDBKeyRange.bound([n],[rs(n)],!1,!0);let i=0;return eh(e).J({index:"documentTargetsIndex",H:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}ot(e,t){return Yl(e).get(t).next(e=>e?el(e):null)}}function Yl(e){return mo(e,"targets")}function Zl(e){return mo(e,"targetGlobal")}function eh(e){return mo(e,"targetDocuments")}function th([e,t],[n,r]){const i=ts(e,n);return 0===i?ts(t,r):i}class nh{constructor(e){this.Un=e,this.buffer=new Io(th),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();th(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class rh{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(e){Li("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>r(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){As(e)?Li("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield bs(e)}yield this.Hn(3e5)}))}}class ih{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Is.resolve(Ls.oe);const n=new nh(t);return this.Jn.forEachTarget(e,e=>n.zn(e.sequenceNumber)).next(()=>this.Jn.Zn(e,e=>n.zn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Li("LruGarbageCollector","Garbage collection skipped; disabled"),Is.resolve(Bl)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(Li("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bl):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,r,i,s,o,a,u;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(Li("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(u=Date.now(),Pi()<=V.DEBUG&&Li("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-c}ms\n\tDetermined least recently used ${r} in `+(o-s)+`ms\n\tRemoved ${i} targets in `+(a-o)+`ms\n\tRemoved ${e} documents in `+(u-a)+`ms\nTotal Duration: ${u-c}ms`),Is.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class sh{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new ih(e,t)}(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}er(e){let t=0;return this.Zn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(e,n)=>t(n))}addReference(e,t,n){return oh(e,n)}removeReference(e,t,n){return oh(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return oh(e,t)}nr(e,t){return function(e,t){let n=!1;return Ql(e).Y(r=>Gl(e,r,t).next(e=>(e&&(n=!0),Is.resolve(!e)))).next(()=>n)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.tr(e,(s,o)=>{if(o<=t){const t=this.nr(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,ss.min()),eh(e).delete([0,Fs(s.path)])))});r.push(t)}}).next(()=>Is.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return oh(e,t)}tr(e,t){const n=eh(e);let r,i=Ls.oe;return n.J({index:"documentTargetsIndex"},([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==Ls.oe&&t(new ls(Bs(r)),i),i=o,r=s):i=Ls.oe}).next(()=>{i!==Ls.oe&&t(new ls(Bs(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function oh(e,t){return eh(e).put((n=t,r=e.currentSequenceNumber,{targetId:0,path:Fs(n.path),sequenceNumber:r}));var n,r}class ah{constructor(){this.changes=new nu(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ca.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Is.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class uh{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return dh(e).put(n)}removeEntry(e,t,n){return dh(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Jc(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=ca.newInvalidDocument(t);return dh(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(fh(t))},(e,r)=>{n=this.ir(t,r)}).next(()=>n)}sr(e,t){let n={size:0,document:ca.newInvalidDocument(t)};return dh(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(fh(t))},(e,r)=>{n={document:this.ir(t,r),size:Kl(r)}}).next(()=>n)}getEntries(e,t){let n=iu();return this._r(e,t,(e,t)=>{const r=this.ir(e,t);n=n.insert(e,r)}).next(()=>n)}ar(e,t){let n=iu(),r=new _o(ls.comparator);return this._r(e,t,(e,t)=>{const i=this.ir(e,t);n=n.insert(e,i),r=r.insert(e,Kl(t))}).next(()=>({documents:n,ur:r}))}_r(e,t,n){if(t.isEmpty())return Is.resolve();let r=new Io(mh);t.forEach(e=>r=r.add(e));const i=IDBKeyRange.bound(fh(r.first()),fh(r.last())),s=r.getIterator();let o=s.getNext();return dh(e).J({index:"documentKeyIndex",range:i},(e,t,r)=>{const i=ls.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&mh(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.$(fh(o)):r.done()}).next(()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),Jc(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return dh(e).U(IDBKeyRange.bound(o,a,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=iu();for(const i of e){const e=this.ir(ls.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Za(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=iu();const s=ph(t,n),o=ph(t,ys.max());return dh(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},(e,t,n)=>{const s=this.ir(ls.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new lh(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return hh(e).get("remoteDocumentGlobalKey").next(e=>(ji(!!e),e))}rr(e,t){return hh(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const e=function(e,t){let n;if(t.document)n=function(e,t,n){const r=Cc(e,t.name),i=Ic(t.updateTime),s=t.createTime?Ic(t.createTime):ss.min(),o=new aa({mapValue:{fields:t.fields}}),a=ca.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=ls.fromSegments(t.noDocument.path),r=Yc(t.noDocument.readTime);n=ca.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Vi();{const e=ls.fromSegments(t.unknownDocument.path),r=Yc(t.unknownDocument.version);n=ca.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new is(e[0],e[1]);return ss.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(ss.min()))return e}return ca.newInvalidDocument(e)}}function ch(e){return new uh(e)}class lh extends ah{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new nu(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){const t=[];let n=0,r=new Io((e,t)=>ts(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{const o=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=Qc(this.cr.serializer,s);r=r.add(i.path.popLast());const u=Kl(a);n+=u-o.size,t.push(this.cr.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=Qc(this.cr.serializer,s.convertToNoDocument(ss.min()));t.push(this.cr.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.cr.updateMetadata(e,n)),Is.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(e=>(this.lr.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:e,ur:t})=>(t.forEach((t,n)=>{this.lr.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function hh(e){return mo(e,"remoteDocumentGlobal")}function dh(e){return mo(e,"remoteDocumentsV14")}function fh(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ph(e,t){const n=t.documentKey.path.toArray();return[e,Jc(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function mh(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=ts(n[s],r[s]),i)return i;return i=ts(n.length,r.length),i||(i=ts(n[n.length-2],r[r.length-2]),i||ts(n[n.length-1],r[r.length-1]))}class gh{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class yh{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Uu(n.mutation,e,So.empty(),is.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,fu()).next(()=>t))}getLocalViewOfDocuments(e,t,n=fu()){const r=uu();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=ou();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=uu();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,fu()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=iu();const s=lu(),o=lu();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Bu)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Uu(o.mutation,t,o.mutation.getFieldMask(),is.now())):s.set(t.key,So.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new gh(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=lu();let r=new _o((e,t)=>e-t),i=fu();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||So.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||fu()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,u=r.value,c=cu();u.forEach(e=>{if(!i.has(e)){const r=Lu(t.get(e),n.get(e));null!==r&&c.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,c))}return Is.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return i=t,ls.isDocumentKey(i.path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):$a(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r);var i}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Is.resolve(uu());let o=-1,a=i;return s.next(t=>Is.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Is.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,fu())).next(e=>({batchId:o,changes:au(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ls(t)).next(e=>{let t=ou();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=ou();return this.indexManager.getCollectionParents(e,i).next(o=>Is.forEach(o,o=>{const a=(u=t,c=o.child(i),new qa(c,null,u.explicitOrderBy.slice(),u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt));var u,c;return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,ca.newInvalidDocument(r)))});let n=ou();return e.forEach((e,r)=>{const s=i.get(e);void 0!==s&&Uu(s.mutation,r,So.empty(),is.now()),Za(t,r)&&(n=n.insert(e,r))}),n})}}class vh{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return Is.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(n=t).id,version:n.version,createTime:Ic(n.createTime)}),Is.resolve();var n}getNamedQuery(e,t){return Is.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(n=t).name,query:nl(n.bundledQuery),readTime:Ic(n.readTime)}),Is.resolve();var n}}class _h{constructor(){this.overlays=new _o(ls.comparator),this.Ir=new Map}getOverlay(e,t){return Is.resolve(this.overlays.get(t))}getOverlays(e,t){const n=uu();return Is.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.ht(e,t,r)}),Is.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Ir.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Ir.delete(n)),Is.resolve()}getOverlaysForCollection(e,t,n){const r=uu(),i=t.length+1,s=new ls(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Is.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new _o((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=uu(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=uu(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return Is.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Qu(t,n));let i=this.Ir.get(t);void 0===i&&(i=fu(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}class wh{constructor(){this.sessionToken=Co.EMPTY_BYTE_STRING}getSessionToken(e){return Is.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Is.resolve()}}class bh{constructor(){this.Tr=new Io(Ih.Er),this.dr=new Io(Ih.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Ih(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Vr(new Ih(e,t))}mr(e,t){e.forEach(e=>this.removeReference(e,t))}gr(e){const t=new ls(new as([])),n=new Ih(t,e),r=new Ih(t,e+1),i=[];return this.dr.forEachInRange([n,r],e=>{this.Vr(e),i.push(e.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ls(new as([])),n=new Ih(t,e),r=new Ih(t,e+1);let i=fu();return this.dr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new Ih(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Ih{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ls.comparator(e.key,t.key)||ts(e.wr,t.wr)}static Ar(e,t){return ts(e.wr,t.wr)||ls.comparator(e.key,t.key)}}class Th{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Io(Ih.Er)}checkEmpty(e){return Is.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Hu(i,t,n,r);this.mutationQueue.push(s);for(const o of r)this.br=this.br.add(new Ih(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return Is.resolve(s)}lookupMutationBatch(e,t){return Is.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.vr(n),i=r<0?0:r;return Is.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Is.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return Is.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Ih(t,0),r=new Ih(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,r],e=>{const t=this.Dr(e.wr);i.push(t)}),Is.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Io(ts);return t.forEach(e=>{const t=new Ih(e,0),r=new Ih(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,r],e=>{n=n.add(e.wr)})}),Is.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ls.isDocumentKey(i)||(i=i.child(""));const s=new Ih(new ls(i),0);let o=new Io(ts);return this.br.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.wr)),!0)},s),Is.resolve(this.Cr(o))}Cr(e){const t=[];return e.forEach(e=>{const n=this.Dr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){ji(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return Is.forEach(t.mutations,r=>{const i=new Ih(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Ih(t,0),r=this.br.firstAfterOrEqual(n);return Is.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Is.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Eh{constructor(e){this.Mr=e,this.docs=new _o(ls.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Is.resolve(n?n.document.mutableCopy():ca.newInvalidDocument(t))}getEntries(e,t){let n=iu();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ca.newInvalidDocument(e))}),Is.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=iu();const s=t.path,o=new ls(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||vs(gs(o),n)<=0||(r.has(o.key)||Za(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Is.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Vi()}Or(e,t){return Is.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Sh(this)}getSize(e){return Is.resolve(this.size)}}class Sh extends ah{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)}),Is.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class kh{constructor(e){this.persistence=e,this.Nr=new nu(e=>Ma(e),Ua),this.lastRemoteSnapshotVersion=ss.min(),this.highestTargetId=0,this.Lr=0,this.Br=new bh,this.targetCount=0,this.kr=Jl.Bn()}forEachTarget(e,t){return this.Nr.forEach((e,n)=>t(n)),Is.resolve()}getLastRemoteSnapshotVersion(e){return Is.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Is.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),Is.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),Is.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Jl(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,Is.resolve()}updateTargetData(e,t){return this.Kn(t),Is.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,Is.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Nr.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Nr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),Is.waitFor(i).next(()=>r)}getTargetCount(e){return Is.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return Is.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),Is.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),Is.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),Is.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return Is.resolve(n)}containsKey(e,t){return Is.resolve(this.Br.containsKey(t))}}class Ch{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Ls(0),this.Kr=!1,this.Kr=!0,this.$r=new wh,this.referenceDelegate=e(this),this.Ur=new kh(this),this.indexManager=new xl,this.remoteDocumentCache=new Eh(e=>this.referenceDelegate.Wr(e)),this.serializer=new Wc(t),this.Gr=new vh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _h,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Th(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){Li("MemoryPersistence","Starting transaction:",e);const r=new Ah(this.Qr.next());return this.referenceDelegate.zr(),n(r).next(e=>this.referenceDelegate.jr(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Hr(e,t){return Is.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Ah extends ws{constructor(e){super(),this.currentSequenceNumber=e}}class Nh{constructor(e){this.persistence=e,this.Jr=new bh,this.Yr=null}static Zr(e){return new Nh(e)}get Xr(){if(this.Yr)return this.Yr;throw Vi()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),Is.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),Is.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),Is.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(e=>this.Xr.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Xr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Is.forEach(this.Xr,n=>{const r=ls.fromPath(n);return this.ei(e,r).next(e=>{e||t.removeEntry(r,ss.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return Is.or([()=>Is.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Dh{constructor(e){this.serializer=e}O(e,t,n,r){const i=new Ts("createOrUpgrade",t);var s;n<1&&r>=1&&(e.createObjectStore("owner"),(s=e).createObjectStore("mutationQueues",{keyPath:"userId"}),s.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",qs,{unique:!0}),s.createObjectStore("documentMutations"),Rh(e),function(e){e.createObjectStore("remoteDocuments")}(e));let o=Is.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Rh(e)),o=o.next(()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ss.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i))),n<4&&r>=4&&(0!==n&&(o=o.next(()=>function(e,t){return t.store("mutations").U().next(n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",qs,{unique:!0});const r=t.store("mutations"),i=n.map(e=>r.put(e));return Is.waitFor(i)})}(e,i))),o=o.next(()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(o=o.next(()=>this.ni(i))),n<6&&r>=6&&(o=o.next(()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),n<7&&r>=7&&(o=o.next(()=>this.ii(i))),n<8&&r>=8&&(o=o.next(()=>this.si(e,i))),n<9&&r>=9&&(o=o.next(()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&r>=10&&(o=o.next(()=>this.oi(i))),n<11&&r>=11&&(o=o.next(()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(o=o.next(()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:ro});t.createIndex("collectionPathOverlayIndex",io,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",so,{unique:!1})}(e)})),n<13&&r>=13&&(o=o.next(()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Gs});t.createIndex("documentKeyIndex",Hs),t.createIndex("collectionGroupIndex",Ws)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(o=o.next(()=>this.ai(e,i))),n<15&&r>=15&&(o=o.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Zs}).createIndex("sequenceNumberIndex",eo,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:to}).createIndex("documentKeyIndex",no,{unique:!1})}(e))),n<16&&r>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&r>=17&&(o=o.next(()=>{!function(e){e.createObjectStore("globals",{keyPath:"name"})}(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((e,n)=>{t+=Kl(n)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(t=>Is.forEach(t,t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",r).next(n=>Is.forEach(n,n=>{ji(n.userId===t.userId);const r=Zc(this.serializer,n);return zl(e,t.userId,r).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{const r=[];return n.J((n,i)=>{const s=new as(n),o=[0,Fs(s)];r.push(t.get(o).next(n=>{return n?Is.resolve():(r=s,t.put({targetId:0,path:Fs(r),sequenceNumber:e.highestListenSequenceNumber}));var r}))}).next(()=>Is.waitFor(r))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:Ys});const n=t.store("collectionParents"),r=new Ol,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Fs(r)})}};return t.store("remoteDocuments").J({H:!0},(e,t)=>{const n=new as(e);return i(n.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([e,t,n],r)=>{const s=Bs(t);return i(s.popLast())}))}oi(e){const t=e.store("targets");return t.J((e,n)=>{const r=el(n),i=tl(this.serializer,r);return t.put(i)})}_i(e,t){const n=t.store("remoteDocuments"),r=[];return n.J((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(a=n,a.document?new ls(as.fromString(a.document.name).popFirst(5)):a.noDocument?ls.fromSegments(a.noDocument.path):a.unknownDocument?ls.fromSegments(a.unknownDocument.path):Vi()).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};var a;r.push(i.put(o))}).next(()=>Is.waitFor(r))}ai(e,t){const n=t.store("mutations"),r=ch(this.serializer),i=new Ch(Nh.Zr,this.serializer.ct);return n.U().next(e=>{const n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:fu();Zc(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),Is.forEach(n,(e,n)=>{const s=new Ri(n),o=cl.lt(this.serializer,s),a=i.getIndexManager(s),u=$l.lt(s,this.serializer,a,i.referenceDelegate);return new yh(r,u,o,a).recalculateAndSaveOverlaysForDocumentKeys(new po(t,Ls.oe),e).next()})})}}function Rh(e){e.createObjectStore("targetDocuments",{keyPath:Js}).createIndex("documentTargetsIndex",Xs,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Qs,{unique:!0}),e.createObjectStore("targetGlobal")}const xh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Oh{constructor(e,t,n,r,i,s,o,a,u,c,l=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=i,this.window=s,this.document=o,this.ci=u,this.li=c,this.hi=l,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=e=>Promise.resolve(),!Oh.D())throw new zi(qi.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sh(this,r),this.Ai=t+"main",this.serializer=new Wc(a),this.Ri=new Es(this.Ai,this.hi,new Dh(this.serializer)),this.$r=new hl,this.Ur=new Xl(this.referenceDelegate,this.serializer),this.remoteDocumentCache=ch(this.serializer),this.Gr=new ol,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===c&&Mi("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new zi(qi.FAILED_PRECONDITION,xh);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Ls(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>r(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>r(this,null,function*(){null===t.newVersion&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>r(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Lh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(e=>{e||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(As(e))return Li("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Li("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Ph(e).get("owner").next(e=>Is.resolve(this.vi(e)))}Ci(e){return Lh(e).delete(this.clientId)}Fi(){return r(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const t=mo(e,"clientMetadata");return t.U().next(e=>{const n=this.xi(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return Is.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?Is.resolve(!0):Ph(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new zi(qi.FAILED_PRECONDITION,xh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Lh(e).U().next(e=>void 0===this.xi(e,5e3).find(e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&Li("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return r(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new po(e,Ls.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(e=>this.Mi(e.updateTimeMs,t)&&!this.Ni(e.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Lh(e).U().next(e=>this.xi(e,18e5).map(e=>e.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return $l.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Ll(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return cl.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){Li("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=17===(s=this.hi)?fo:16===s?ho:15===s?lo:14===s?co:13===s?uo:12===s?ao:11===s?oo:void Vi();var s;let o;return this.Ri.runTransaction(e,r,i,r=>(o=new po(r,this.Qr?this.Qr.next():Ls.oe),"readwrite-primary"===t?this.wi(o).next(e=>!!e||this.Si(o)).next(t=>{if(!t)throw Mi(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new zi(qi.FAILED_PRECONDITION,_s);return n(o)}).next(e=>this.Di(o).next(()=>e)):this.Ki(o).next(()=>n(o)))).then(e=>(o.raiseOnCommittedEvent(),e))}Ki(e){return Ph(e).get("owner").next(e=>{if(null!==e&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)&&!this.vi(e)&&!(this.li||this.allowTabSynchronization&&e.allowTabSynchronization))throw new zi(qi.FAILED_PRECONDITION,xh)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ph(e).put("owner",t)}static D(){return Es.D()}bi(e){const t=Ph(e);return t.get("owner").next(e=>this.vi(e)?(Li("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Is.resolve())}Mi(e,t){const n=Date.now();return!(e<n-t||e>n&&(Mi(`Detected an update time that is in the future: ${e} > ${n}`),1))}fi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=()=>{this.Li();const e=/(?:Version|Mobile)\/1[456]/;b()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const n=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return Li("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Mi("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Mi("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch(e){}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ph(e){return mo(e,"owner")}function Lh(e){return mo(e,"clientMetadata")}class Mh{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=fu(),r=fu();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Mh(e,t.fromCache,n,r)}}class Uh{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Fh{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=b()?8:Ss(w())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.Yi(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Zi(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const n=new Uh;return this.Xi(e,t,n).next(r=>{if(i.result=r,this.zi)return this.es(e,t,n,r.size)})}).next(()=>i.result)}es(e,t,n,r){return n.documentReadCount<this.ji?(Pi()<=V.DEBUG&&Li("QueryEngine","SDK will not create cache indexes for query:",Ya(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Is.resolve()):(Pi()<=V.DEBUG&&Li("QueryEngine","Query:",Ya(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(Pi()<=V.DEBUG&&Li("QueryEngine","The SDK decides to create cache indexes for query:",Ya(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ha(t))):Is.resolve())}Yi(e,t){if(Ka(t))return Is.resolve(null);let n=Ha(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Qa(t,null,"F"),n=Ha(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const i=fu(...r);return this.Ji.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const s=this.ts(t,r);return this.ns(t,s,i,n.readTime)?this.Yi(e,Qa(t,null,"F")):this.rs(e,s,t,n)}))})))}Zi(e,t,n,r){return Ka(t)||r.isEqual(ss.min())?Is.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const s=this.ts(t,i);return this.ns(t,s,n,r)?Is.resolve(null):(Pi()<=V.DEBUG&&Li("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ya(t)),this.rs(e,s,t,function(e){const t=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,r=ss.fromTimestamp(1e9===n?new is(t+1,0):new is(t,n));return new ys(r,ls.empty(),-1)}(r)).next(e=>e))})}ts(e,t){let n=new Io(eu(e));return t.forEach((t,r)=>{Za(e,r)&&(n=n.add(r))}),n}ns(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Xi(e,t,n){return Pi()<=V.DEBUG&&Li("QueryEngine","Using full collection scan to execute query:",Ya(t)),this.Ji.getDocumentsMatchingQuery(e,t,ys.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class Vh{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new _o(ts),this._s=new nu(e=>Ma(e),Ua),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yh(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function jh(e,t,n,r){return new Vh(e,t,n,r)}function Bh(e,t){return r(this,null,function*(){const n=Bi(e);return yield n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.ls(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],s=[];let o=fu();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({hs:e,removedBatchIds:i,addedBatchIds:s}))})})})}function qh(e){const t=Bi(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function zh(e,t){const n=Bi(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Kh(e,t,n){return r(this,null,function*(){const r=Bi(e),i=r.os.get(t),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(o){if(!As(o))throw o;Li("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.os=r.os.remove(t),r._s.delete(i.target)})}function $h(e,t,n){const r=Bi(e);let i=ss.min(),s=fu();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=Bi(e),i=r._s.get(n);return void 0!==i?Is.resolve(r.os.get(i)):r.Ur.getTargetData(t,n)}(r,e,Ha(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.ss.getDocumentsMatchingQuery(e,t,n?i:ss.min(),n?s:fu())).next(e=>(function(e,t,n){let r=e.us.get(t)||ss.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.us.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Ts:s})))}class Gh{constructor(){this.activeTargetIds=pu}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Hh{constructor(){this.so=new Gh,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Gh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Wh{_o(e){}shutdown(){}}class Qh{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Li("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Li("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Jh=null;function Xh(){return null===Jh?Jh=268435456+Math.round(2147483648*Math.random()):Jh++,"0x"+Jh.toString(16)}const Yh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Zh{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const ed="WebChannelConnection";class td extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo=`projects/${n}/databases/${r}`,this.Co="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get Fo(){return!1}Mo(e,t,n,r,i){const s=Xh(),o=this.xo(e,t.toUriEncodedString());Li("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(a,r,i),this.No(e,o,a,n).then(t=>(Li("RestConnection",`Received RPC '${e}' ${s}: `,t),t),t=>{throw Ui("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}Lo(e,t,n,r,i,s){return this.Mo(e,t,n,r,i)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+xi,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}xo(e,t){const n=Yh[e];return`${this.Do}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){const i=Xh();return new Promise((s,o)=>{const a=new bi;a.setWithCredentials(!0),a.listenOnce(Ti.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Ei.NO_ERROR:const t=a.getResponseJson();Li(ed,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case Ei.TIMEOUT:Li(ed,`RPC '${e}' ${i} timed out`),o(new zi(qi.DEADLINE_EXCEEDED,"Request time out"));break;case Ei.HTTP_ERROR:const n=a.getStatus();if(Li(ed,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(qi).indexOf(t)>=0?t:qi.UNKNOWN}(t.status);o(new zi(e,t.message))}else o(new zi(qi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new zi(qi.UNAVAILABLE,"Connection failed."));break;default:Vi()}}finally{Li(ed,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(r);Li(ed,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",u,n,15)})}Bo(e,t,n){const r=Xh(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Ai(),o=Ci(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(a.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Oo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const c=i.join("");Li(ed,`Creating RPC '${e}' stream ${r}: ${c}`,a);const l=s.createWebChannel(c,a);let h=!1,d=!1;const f=new Zh({Io:t=>{d?Li(ed,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(Li(ed,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),Li(ed,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},To:()=>l.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return p(l,Ii.EventType.OPEN,()=>{d||(Li(ed,`RPC '${e}' stream ${r} transport opened.`),f.yo())}),p(l,Ii.EventType.CLOSE,()=>{d||(d=!0,Li(ed,`RPC '${e}' stream ${r} transport closed`),f.So())}),p(l,Ii.EventType.ERROR,t=>{d||(d=!0,Ui(ed,`RPC '${e}' stream ${r} transport errored:`,t),f.So(new zi(qi.UNAVAILABLE,"The operation could not be completed")))}),p(l,Ii.EventType.MESSAGE,t=>{var n;if(!d){const i=t.data[0];ji(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Li(ed,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=Xu[e];if(void 0!==t)return Zu(t)}(t),i=o.message;void 0===n&&(n=qi.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.So(new zi(n,i)),l.close()}else Li(ed,`RPC '${e}' stream ${r} received:`,i),f.bo(i)}}),p(o,ki.STAT_EVENT,t=>{t.stat===Si.PROXY?Li(ed,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Si.NOPROXY&&Li(ed,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{f.wo()},0),f}}function nd(){return"undefined"!=typeof document?document:null}function rd(e){return new yc(e,!0)}class id{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);r>0&&Li("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class sd{constructor(e,t,n,r,i,s,o,a){this.ui=e,this.Ho=n,this.Jo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new id(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){return r(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return r(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return r(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===qi.RESOURCE_EXHAUSTED?(Mi(t.toString()),Mi("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===qi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.Yo===t&&this.P_(e,n)},t=>{e(()=>{const e=new zi(qi.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(e=>{n(()=>this.I_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.e_?this.E_(e):this.onNext(e))})}i_(){this.state=5,this.t_.Go(()=>r(this,null,function*(){this.state=0,this.start()}))}I_(e){return Li("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(Li("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class od extends sd{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:Vi(),s=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(ji(void 0===t||"string"==typeof t),Co.fromBase64String(t||"")):(ji(void 0===t||t instanceof Buffer||t instanceof Uint8Array),Co.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(e){const t=void 0===e.code?qi.UNKNOWN:Zu(e.code);return new zi(t,e.message||"")}(a);n=new cc(i,s,o,u||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Cc(e,r.document.name),s=Ic(r.document.updateTime),o=r.document.createTime?Ic(r.document.createTime):ss.min(),a=new aa({mapValue:{fields:r.document.fields}}),u=ca.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];n=new ac(c,l,u.key,u)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Cc(e,r.document),s=r.readTime?Ic(r.readTime):ss.min(),o=ca.newNoDocument(i,s),a=r.removedTargetIds||[];n=new ac([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Cc(e,r.document),s=r.removedTargetIds||[];n=new ac([],s,i,null)}else{if(!("filter"in t))return Vi();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Ju(r,i),o=e.targetId;n=new uc(o,s)}}var r;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ss.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ss.min():t.readTime?Ic(t.readTime):ss.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Dc(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Fa(r)?{documents:Lc(e,r)}:{query:Mc(e,r)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=wc(e,t.resumeToken);const r=vc(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ss.min())>0){n.readTime=_c(e,t.snapshotVersion.toTimestamp());const r=vc(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Vi()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Dc(this.serializer),t.removeTarget=e,this.a_(t)}}class ad extends sd{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ji(!!e.streamToken),this.lastStreamToken=e.streamToken,ji(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){ji(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function(e,t){return e&&e.length>0?(ji(void 0!==t),e.map(e=>function(e,t){let n=e.updateTime?Ic(e.updateTime):Ic(t);return n.isEqual(ss.min())&&(n=Ic(t)),new Ru(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Ic(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Dc(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>Oc(this.serializer,e))};this.a_(t)}}class ud extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new zi(qi.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Mo(e,Ec(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===qi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new zi(qi.UNKNOWN,e.toString())})}Lo(e,t,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Lo(e,Ec(t,n),r,s,o,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===qi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new zi(qi.UNKNOWN,e.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class cd{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Mi(t),this.D_=!1):Li("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class ld{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(e=>{n.enqueueAndForget(()=>r(this,null,function*(){_d(this)&&(Li("RemoteStore","Restarting streams for network reachability change."),yield function(e){return r(this,null,function*(){const t=Bi(e);t.L_.add(4),yield dd(t),t.q_.set("Unknown"),t.L_.delete(4),yield hd(t)})}(this))}))}),this.q_=new cd(n,i)}}function hd(e){return r(this,null,function*(){if(_d(e))for(const t of e.B_)yield t(!0)})}function dd(e){return r(this,null,function*(){for(const t of e.B_)yield t(!1)})}function fd(e,t){const n=Bi(e);n.N_.has(t.targetId)||(n.N_.set(t.targetId,t),vd(n)?yd(n):Ud(n).r_()&&md(n,t))}function pd(e,t){const n=Bi(e),r=Ud(n);n.N_.delete(t),r.r_()&&gd(n,t),0===n.N_.size&&(r.r_()?r.o_():_d(n)&&n.q_.set("Unknown"))}function md(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ss.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ud(e).A_(t)}function gd(e,t){e.Q_.xe(t),Ud(e).R_(t)}function yd(e){e.Q_=new hc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),Ud(e).start(),e.q_.v_()}function vd(e){return _d(e)&&!Ud(e).n_()&&e.N_.size>0}function _d(e){return 0===Bi(e).L_.size}function wd(e){e.Q_=void 0}function bd(e){return r(this,null,function*(){e.q_.set("Online")})}function Id(e){return r(this,null,function*(){e.N_.forEach((t,n)=>{md(e,t)})})}function Td(e,t){return r(this,null,function*(){wd(e),vd(e)?(e.q_.M_(t),yd(e)):e.q_.set("Unknown")})}function Ed(e,t,n){return r(this,null,function*(){if(e.q_.set("Online"),t instanceof cc&&2===t.state&&t.cause)try{yield function(e,t){return r(this,null,function*(){const n=t.cause;for(const r of t.targetIds)e.N_.has(r)&&(yield e.remoteSyncer.rejectListen(r,n),e.N_.delete(r),e.Q_.removeTarget(r))})}(e,t)}catch(i){Li("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),i),yield Sd(e,i)}else if(t instanceof ac?e.Q_.Ke(t):t instanceof uc?e.Q_.He(t):e.Q_.We(t),!n.isEqual(ss.min()))try{const t=yield qh(e.localStore);n.compareTo(t)>=0&&(yield function(e,t){const n=e.Q_.rt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.N_.get(r);i&&e.N_.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.N_.get(t);if(!r)return;e.N_.set(t,r.withResumeToken(Co.EMPTY_BYTE_STRING,r.snapshotVersion)),gd(e,t);const i=new Hc(r.target,t,n,r.sequenceNumber);md(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n))}catch(s){Li("RemoteStore","Failed to raise snapshot:",s),yield Sd(e,s)}})}function Sd(e,t,n){return r(this,null,function*(){if(!As(t))throw t;e.L_.add(1),yield dd(e),e.q_.set("Offline"),n||(n=()=>qh(e.localStore)),e.asyncQueue.enqueueRetryable(()=>r(this,null,function*(){Li("RemoteStore","Retrying IndexedDB access"),yield n(),e.L_.delete(1),yield hd(e)}))})}function kd(e,t){return t().catch(n=>Sd(e,n,t))}function Cd(e){return r(this,null,function*(){const t=Bi(e),n=Fd(t);let r=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;Ad(t);)try{const e=yield zh(t.localStore,r);if(null===e){0===t.O_.length&&n.o_();break}r=e.batchId,Nd(t,e)}catch(i){yield Sd(t,i)}Dd(t)&&Rd(t)})}function Ad(e){return _d(e)&&e.O_.length<10}function Nd(e,t){e.O_.push(t);const n=Fd(e);n.r_()&&n.V_&&n.m_(t.mutations)}function Dd(e){return _d(e)&&!Fd(e).n_()&&e.O_.length>0}function Rd(e){Fd(e).start()}function xd(e){return r(this,null,function*(){Fd(e).p_()})}function Od(e){return r(this,null,function*(){const t=Fd(e);for(const n of e.O_)t.m_(n.mutations)})}function Pd(e,t,n){return r(this,null,function*(){const r=e.O_.shift(),i=Wu.from(r,t,n);yield kd(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),yield Cd(e)})}function Ld(e,t){return r(this,null,function*(){t&&Fd(e).V_&&(yield function(e,t){return r(this,null,function*(){if(function(e){switch(e){default:return Vi();case qi.CANCELLED:case qi.UNKNOWN:case qi.DEADLINE_EXCEEDED:case qi.RESOURCE_EXHAUSTED:case qi.INTERNAL:case qi.UNAVAILABLE:case qi.UNAUTHENTICATED:return!1;case qi.INVALID_ARGUMENT:case qi.NOT_FOUND:case qi.ALREADY_EXISTS:case qi.PERMISSION_DENIED:case qi.FAILED_PRECONDITION:case qi.ABORTED:case qi.OUT_OF_RANGE:case qi.UNIMPLEMENTED:case qi.DATA_LOSS:return!0}}(n=t.code)&&n!==qi.ABORTED){const n=e.O_.shift();Fd(e).s_(),yield kd(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),yield Cd(e)}var n})}(e,t)),Dd(e)&&Rd(e)})}function Md(e,t){return r(this,null,function*(){const n=Bi(e);n.asyncQueue.verifyOperationInProgress(),Li("RemoteStore","RemoteStore received new credentials");const r=_d(n);n.L_.add(3),yield dd(n),r&&n.q_.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.L_.delete(3),yield hd(n)})}function Ud(e){return e.K_||(e.K_=function(e,t,n){const r=Bi(e);return r.w_(),new od(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:bd.bind(null,e),Ro:Id.bind(null,e),mo:Td.bind(null,e),d_:Ed.bind(null,e)}),e.B_.push(t=>r(this,null,function*(){t?(e.K_.s_(),vd(e)?yd(e):e.q_.set("Unknown")):(yield e.K_.stop(),wd(e))}))),e.K_}function Fd(e){return e.U_||(e.U_=function(e,t,n){const r=Bi(e);return r.w_(),new ad(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:xd.bind(null,e),mo:Ld.bind(null,e),f_:Od.bind(null,e),g_:Pd.bind(null,e)}),e.B_.push(t=>r(this,null,function*(){t?(e.U_.s_(),yield Cd(e)):(yield e.U_.stop(),e.O_.length>0&&(Li("RemoteStore",`Stopping write stream with ${e.O_.length} pending writes`),e.O_=[]))}))),e.U_}class Vd{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ki,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Vd(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new zi(qi.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function jd(e,t){if(Mi("AsyncQueue",`${t}: ${e}`),As(e))return new zi(qi.UNAVAILABLE,`${t}: ${e}`);throw e}class Bd{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ls.comparator(t.key,n.key):(e,t)=>ls.comparator(e.key,t.key),this.keyedMap=ou(),this.sortedSet=new _o(this.comparator)}static emptySet(e){return new Bd(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Bd))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Bd;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class qd{constructor(){this.W_=new _o(ls.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Vi():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class zd{constructor(e,t,n,r,i,s,o,a,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new zd(e,t,Bd.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ja(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Kd{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class $d{constructor(){this.queries=Gd(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=Bi(e),r=n.queries;n.queries=Gd(),r.forEach((e,n)=>{for(const r of n.j_)r.onError(t)})}(this,new zi(qi.ABORTED,"Firestore shutting down"))}}function Gd(){return new nu(e=>Xa(e),Ja)}function Hd(e,t){return r(this,null,function*(){const n=Bi(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.H_()&&t.J_()&&(r=2):(s=new Kd,r=t.J_()?0:1);try{switch(r){case 0:s.z_=yield n.onListen(i,!0);break;case 1:s.z_=yield n.onListen(i,!1);break;case 2:yield n.onFirstRemoteStoreListen(i)}}catch(o){const e=jd(o,`Initialization of query '${Ya(t.query)}' failed`);return void t.onError(e)}n.queries.set(i,s),s.j_.push(t),t.Z_(n.onlineState),s.z_&&t.X_(s.z_)&&Xd(n)})}function Wd(e,t){return r(this,null,function*(){const n=Bi(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.j_.indexOf(t);e>=0&&(s.j_.splice(e,1),0===s.j_.length?i=t.J_()?0:1:!s.H_()&&t.J_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}})}function Qd(e,t){const n=Bi(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.j_)e.X_(i)&&(r=!0);t.z_=i}}r&&Xd(n)}function Jd(e,t,n){const r=Bi(e),i=r.queries.get(t);if(i)for(const s of i.j_)s.onError(n);r.queries.delete(t)}function Xd(e){e.Y_.forEach(e=>{e.next()})}var Yd,Zd;(Zd=Yd||(Yd={})).ea="default",Zd.Cache="cache";class ef{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new zd(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache)return!0;if(!this.J_())return!0;const n="Offline"!==t;return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}oa(e){e=zd.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Yd.Cache}}class tf{constructor(e){this.key=e}}class nf{constructor(e){this.key=e}}class rf{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=fu(),this.mutatedKeys=fu(),this.Aa=eu(e),this.Ra=new Bd(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new qd,r=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,u="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const c=r.get(e),l=Za(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;c&&l?c.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.ga(c,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Aa(l,a)>0||u&&this.Aa(l,u)<0)&&(o=!0)):!c&&l?(n.track({type:0,doc:l}),f=!0):c&&!l&&(n.track({type:1,doc:c}),f=!0,(a||u)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ra:s,fa:n,ns:o,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const s=e.fa.G_();s.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Vi()}};return n(e)-n(t)}(e.type,t.type)||this.Aa(e.doc,t.doc)),this.pa(n),r=null!=r&&r;const o=t&&!r?this.ya():[],a=0===this.da.size&&this.current&&!r?1:0,u=a!==this.Ea;return this.Ea=a,0!==s.length||u?{snapshot:new zd(this.query,e.Ra,i,s,e.mutatedKeys,0===a,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:o}:{wa:o}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new qd,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=fu(),this.Ra.forEach(e=>{this.Sa(e.key)&&(this.da=this.da.add(e.key))});const t=[];return e.forEach(e=>{this.da.has(e)||t.push(new nf(e))}),this.da.forEach(n=>{e.has(n)||t.push(new tf(n))}),t}ba(e){this.Ta=e.Ts,this.da=fu();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return zd.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class sf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class of{constructor(e){this.key=e,this.va=!1}}class af{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Ca={},this.Fa=new nu(e=>Xa(e),Ja),this.Ma=new Map,this.xa=new Set,this.Oa=new _o(ls.comparator),this.Na=new Map,this.La=new bh,this.Ba={},this.ka=new Map,this.qa=Jl.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function uf(e,t,n=!0){return r(this,null,function*(){const r=Af(e);let i;const s=r.Fa.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield lf(r,t,n,!0),i})}function cf(e,t){return r(this,null,function*(){const n=Af(e);yield lf(n,t,!0,!1)})}function lf(e,t,n,i){return r(this,null,function*(){const s=yield function(e,t){const n=Bi(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Ur.getTargetData(e,t).next(i=>i?(r=i,Is.resolve(r)):n.Ur.allocateTargetId(e).next(i=>(r=new Hc(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Ur.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.os.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.os=n.os.insert(e.targetId,e),n._s.set(t,e.targetId)),e})}(e.localStore,Ha(t)),o=s.targetId,a=e.sharedClientState.addLocalQueryTarget(o,n);let u;return i&&(u=yield function(e,t,n,i,s){return r(this,null,function*(){e.Ka=(t,n,i)=>function(e,t,n,i){return r(this,null,function*(){let r=t.view.ma(n);r.ns&&(r=yield $h(e.localStore,t.query,!1).then(({documents:e})=>t.view.ma(e,r)));const s=i&&i.targetChanges.get(t.targetId),o=i&&null!=i.targetMismatches.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,s,o);return If(e,t.targetId,a.wa),a.snapshot})}(e,t,n,i);const o=yield $h(e.localStore,t,!0),a=new rf(t,o.Ts),u=a.ma(o.documents),c=oc.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,s),l=a.applyChanges(u,e.isPrimaryClient,c);If(e,n,l.wa);const h=new sf(t,n,a);return e.Fa.set(t,h),e.Ma.has(n)?e.Ma.get(n).push(t):e.Ma.set(n,[t]),l.snapshot})}(e,t,o,"current"===a,s.resumeToken)),e.isPrimaryClient&&n&&fd(e.remoteStore,s),u})}function hf(e,t,n){return r(this,null,function*(){const r=Bi(e),i=r.Fa.get(t),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(e=>!Ja(e,t))),void r.Fa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Kh(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&pd(r.remoteStore,i.targetId),wf(r,i.targetId)}).catch(bs))):(wf(r,i.targetId),yield Kh(r.localStore,i.targetId,!0))})}function df(e,t){return r(this,null,function*(){const n=Bi(e),r=n.Fa.get(t),i=n.Ma.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),pd(n.remoteStore,r.targetId))})}function ff(e,t){return r(this,null,function*(){const n=Bi(e);try{const e=yield function(e,t){const n=Bi(e),r=t.snapshotVersion;let i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;const o=[];t.targetChanges.forEach((s,a)=>{const u=i.get(a);if(!u)return;o.push(n.Ur.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.Ur.addMatchingKeys(e,s.addedDocuments,a)));let c=u.withSequenceNumber(e.currentSequenceNumber);var l,h,d;null!==t.targetMismatches.get(a)?c=c.withResumeToken(Co.EMPTY_BYTE_STRING,ss.min()).withLastLimboFreeSnapshotVersion(ss.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,r)),i=i.insert(a,c),h=c,d=s,(0===(l=u).resumeToken.approximateByteSize()||h.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.Ur.updateTargetData(e,c))});let a=iu(),u=fu();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n){let r=fu(),i=fu();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=iu();return n.forEach((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ss.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Li("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{Ps:r,Is:i}})}(e,s,t.documentUpdates).next(e=>{a=e.Ps,u=e.Is})),!r.isEqual(ss.min())){const t=n.Ur.getLastRemoteSnapshotVersion(e).next(t=>n.Ur.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return Is.waitFor(o).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,u)).next(()=>a)}).then(e=>(n.os=i,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Na.get(t);r&&(ji(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.va=!0:e.modifiedDocuments.size>0?ji(r.va):e.removedDocuments.size>0&&(ji(r.va),r.va=!1))}),yield Sf(n,e,t)}catch(r){yield bs(r)}})}function pf(e,t,n){const r=Bi(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Fa.forEach((n,r)=>{const i=r.view.Z_(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=Bi(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.j_)i.Z_(t)&&(r=!0)}),r&&Xd(n)}(r.eventManager,t),e.length&&r.Ca.d_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function mf(e,t,n){return r(this,null,function*(){const r=Bi(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Na.get(t),s=i&&i.key;if(s){let e=new _o(ls.comparator);e=e.insert(s,ca.newNoDocument(s,ss.min()));const n=fu().add(s),i=new sc(ss.min(),new Map,new _o(ts),e,n);yield ff(r,i),r.Oa=r.Oa.remove(s),r.Na.delete(t),Ef(r)}else yield Kh(r.localStore,t,!1).then(()=>wf(r,t,n)).catch(bs)})}function gf(e,t){return r(this,null,function*(){const n=Bi(e),r=t.batch.batchId;try{const e=yield function(e,t){const n=Bi(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Is.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);ji(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=fu();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);_f(n,r,null),vf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield Sf(n,e)}catch(i){yield bs(i)}})}function yf(e,t,n){return r(this,null,function*(){const r=Bi(e);try{const e=yield function(e,t){const n=Bi(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(ji(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);_f(r,t,n),vf(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),yield Sf(r,e)}catch(i){yield bs(i)}})}function vf(e,t){(e.ka.get(t)||[]).forEach(e=>{e.resolve()}),e.ka.delete(t)}function _f(e,t,n){const r=Bi(e);let i=r.Ba[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ba[r.currentUser.toKey()]=i}}function wf(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Ma.get(t))e.Fa.delete(r),n&&e.Ca.$a(r,n);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach(t=>{e.La.containsKey(t)||bf(e,t)})}function bf(e,t){e.xa.delete(t.path.canonicalString());const n=e.Oa.get(t);null!==n&&(pd(e.remoteStore,n),e.Oa=e.Oa.remove(t),e.Na.delete(n),Ef(e))}function If(e,t,n){for(const r of n)r instanceof tf?(e.La.addReference(r.key,t),Tf(e,r)):r instanceof nf?(Li("SyncEngine","Document no longer in limbo: "+r.key),e.La.removeReference(r.key,t),e.La.containsKey(r.key)||bf(e,r.key)):Vi()}function Tf(e,t){const n=t.key,r=n.path.canonicalString();e.Oa.get(n)||e.xa.has(r)||(Li("SyncEngine","New document in limbo: "+n),e.xa.add(r),Ef(e))}function Ef(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){const t=e.xa.values().next().value;e.xa.delete(t);const n=new ls(as.fromString(t)),r=e.qa.next();e.Na.set(r,new of(n)),e.Oa=e.Oa.insert(n,r),fd(e.remoteStore,new Hc(Ha(za(n.path)),r,"TargetPurposeLimboResolution",Ls.oe))}}function Sf(e,t,n){return r(this,null,function*(){const i=Bi(e),s=[],o=[],a=[];i.Fa.isEmpty()||(i.Fa.forEach((e,r)=>{a.push(i.Ka(r,t,n).then(e=>{var t;if((e||n)&&i.isPrimaryClient){const s=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(r.targetId))||void 0===t?void 0:t.current;i.sharedClientState.updateQueryState(r.targetId,s?"current":"not-current")}if(e){s.push(e);const t=Mh.Wi(r.targetId,e);o.push(t)}}))}),yield Promise.all(a),i.Ca.d_(s),yield function(e,t){return r(this,null,function*(){const n=Bi(e);try{yield n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Is.forEach(t,t=>Is.forEach(t.$i,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Is.forEach(t.Ui,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(r){if(!As(r))throw r;Li("LocalStore","Failed to update sequence numbers: "+r)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.os.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.os=n.os.insert(t,i)}}})}(i.localStore,o))})}function kf(e,t){return r(this,null,function*(){const n=Bi(e);if(!n.currentUser.isEqual(t)){Li("SyncEngine","User change. New user:",t.toKey());const e=yield Bh(n.localStore,t);n.currentUser=t,(r=n).ka.forEach(e=>{e.forEach(e=>{e.reject(new zi(qi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.ka.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield Sf(n,e.hs)}var r})}function Cf(e,t){const n=Bi(e),r=n.Na.get(t);if(r&&r.va)return fu().add(r.key);{let e=fu();const r=n.Ma.get(t);if(!r)return e;for(const t of r){const r=n.Fa.get(t);e=e.unionWith(r.view.Va)}return e}}function Af(e){const t=Bi(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=ff.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Cf.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=mf.bind(null,t),t.Ca.d_=Qd.bind(null,t.eventManager),t.Ca.$a=Jd.bind(null,t.eventManager),t}function Nf(e){const t=Bi(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=gf.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=yf.bind(null,t),t}class Df{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return r(this,null,function*(){this.serializer=rd(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),yield this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)})}ja(e,t){return null}Ha(e,t){return null}za(e){return jh(this.persistence,new Fh,e.initialUser,this.serializer)}Ga(e){return new Ch(Nh.Zr,this.serializer)}Wa(e){return new Hh}terminate(){return r(this,null,function*(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}Df.provider={build:()=>new Df};class Rf extends Df{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return r(this,null,function*(){yield n(Rf.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield Nf(this.Ja.syncEngine),yield Cd(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return jh(this.persistence,new Fh,e.initialUser,this.serializer)}ja(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new rh(n,e.asyncQueue,t)}Ha(e,t){const n=new Ps(t,this.persistence);return new Os(e.asyncQueue,n)}Ga(e){const t=function(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ql.withCacheSize(this.cacheSizeBytes):ql.DEFAULT;return new Oh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,"undefined"!=typeof window?window:null,nd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Hh}}class xf{initialize(e,t){return r(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>pf(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=kf.bind(null,this.syncEngine),yield function(e,t){return r(this,null,function*(){const n=Bi(e);t?(n.L_.delete(2),yield hd(n)):t||(n.L_.add(2),yield dd(n),n.q_.set("Unknown"))})}(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return new $d}createDatastore(e){const t=rd(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new td(r));var r;return function(e,t,n,r){return new ud(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>pf(this.syncEngine,e,0),s=Qh.D()?new Qh:new Wh,new ld(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new af(e,t,n,r,i,s);return o&&(a.Qa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return r(this,null,function*(){var e,t;yield function(e){return r(this,null,function*(){const t=Bi(e);Li("RemoteStore","RemoteStore shutting down."),t.L_.add(5),yield dd(t),t.k_.shutdown(),t.q_.set("Unknown")})}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()})}}xf.provider={build:()=>new xf};class Of{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Mi("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class Pf{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ri.UNAUTHENTICATED,this.clientId=es.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,e=>r(this,null,function*(){Li("FirestoreClient","Received user=",e.uid),yield this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,e=>(Li("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ki;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>r(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=jd(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}function Lf(e,t){return r(this,null,function*(){e.asyncQueue.verifyOperationInProgress(),Li("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;yield t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(e=>r(this,null,function*(){i.isEqual(e)||(yield Bh(t.localStore,e),i=e)})),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t})}function Mf(e,t){return r(this,null,function*(){e.asyncQueue.verifyOperationInProgress();const n=yield function(e){return r(this,null,function*(){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Li("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Lf(e,e._uninitializedComponentsProvider._offline)}catch(t){const i=t;if(!("FirebaseError"===(n=i).name?n.code===qi.FAILED_PRECONDITION||n.code===qi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw i;Ui("Error using user provided cache. Falling back to memory cache: "+i),yield Lf(e,new Df)}}else Li("FirestoreClient","Using default OfflineComponentProvider"),yield Lf(e,new Df);var n;return e._offlineComponents})}(e);Li("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>Md(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>Md(t.remoteStore,n)),e._onlineComponents=t})}function Uf(e){return r(this,null,function*(){return e._onlineComponents||(e._uninitializedComponentsProvider?(Li("FirestoreClient","Using user provided OnlineComponentProvider"),yield Mf(e,e._uninitializedComponentsProvider._online)):(Li("FirestoreClient","Using default OnlineComponentProvider"),yield Mf(e,new xf))),e._onlineComponents})}function Ff(e){return r(this,null,function*(){const t=yield Uf(e),n=t.eventManager;return n.onListen=uf.bind(null,t.syncEngine),n.onUnlisten=hf.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=cf.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=df.bind(null,t.syncEngine),n})}function Vf(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const jf=new Map;function Bf(e,t,n){if(!n)throw new zi(qi.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function qf(e,t,n,r){if(!0===t&&!0===r)throw new zi(qi.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function zf(e){if(!ls.isDocumentKey(e))throw new zi(qi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Kf(e){if(ls.isDocumentKey(e))throw new zi(qi.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function $f(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":Vi()}function Gf(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new zi(qi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=$f(e);throw new zi(qi.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Hf{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new zi(qi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new zi(qi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}qf("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Vf(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new zi(qi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new zi(qi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new zi(qi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Wf{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hf({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new zi(qi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new zi(qi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hf(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Gi;switch(e.type){case"firstParty":return new Ji(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new zi(qi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return r(this,null,function*(){"notTerminated"===this._terminateTask?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=jf.get(e);t&&(Li("ComponentProvider","Removing Datastore"),jf.delete(e),t.terminate())}(this),Promise.resolve()}}function Qf(e,t,n,r={}){var i;const s=(e=Gf(e,Wf))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ui("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Ri.MOCK_USER;else{t=_(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new zi(qi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ri(s)}e._authCredentials=new Hi(new $i(t,n))}}class Jf{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Jf(this.firestore,e,this._query)}}class Xf{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Yf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Xf(this.firestore,e,this._key)}}class Yf extends Jf{constructor(e,t,n){super(e,t,za(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Xf(this.firestore,null,new ls(e))}withConverter(e){return new Yf(this.firestore,e,this._path)}}function Zf(e,t,...n){if(e=P(e),Bf("collection","path",t),e instanceof Wf){const r=as.fromString(t,...n);return Kf(r),new Yf(e,null,r)}{if(!(e instanceof Xf||e instanceof Yf))throw new zi(qi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(as.fromString(t,...n));return Kf(r),new Yf(e.firestore,null,r)}}function ep(e,t,...n){if(e=P(e),1===arguments.length&&(t=es.newId()),Bf("doc","path",t),e instanceof Wf){const r=as.fromString(t,...n);return zf(r),new Xf(e,null,new ls(r))}{if(!(e instanceof Xf||e instanceof Yf))throw new zi(qi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(as.fromString(t,...n));return zf(r),new Xf(e.firestore,e instanceof Yf?e.converter:null,new ls(r))}}class tp{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new id(this,"async_queue_retry"),this.Vu=()=>{const e=nd();e&&Li("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=nd();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=nd();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Ki;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return r(this,null,function*(){if(0!==this.Pu.length){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!As(e))throw e;Li("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(e=>{throw this.Eu=e,this.du=!1,Mi("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.du=!1,e))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const r=Vd.createAndSchedule(this,e,t,n,e=>this.yu(e));return this.Tu.push(r),r}fu(){this.Eu&&Vi()}verifyOperationInProgress(){}wu(){return r(this,null,function*(){let e;do{e=this.mu,yield e}while(e!==this.mu)})}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function np(e){return function(e){if("object"!=typeof e||null===e)return!1;const t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return!0;return!1}(e)}class rp extends Wf{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new tp,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return r(this,null,function*(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new tp(e),this._firestoreClient=void 0,yield e}})}}function ip(e,t){const n="string"==typeof e?e:"(default)",r=Ne("object"==typeof e?e:Le(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=m("firestore");e&&Qf(r,...e)}return r}function sp(e){if(e._terminated)throw new zi(qi.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||op(e),e._firestoreClient}function op(e){var t,n,r;const i=e._freezeSettings(),s=(o=e._databaseId,a=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",u=e._persistenceKey,new Lo(o,a,u,(c=i).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,Vf(c.experimentalLongPollingOptions),c.useFetchStreams));var o,a,u,c;e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Pf(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}function ap(e,t){Ui("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings();return function(e,t,n){if((e=Gf(e,rp))._firestoreClient||e._terminated)throw new zi(qi.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new zi(qi.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},op(e)}(e,xf.provider,{build:e=>new Rf(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}class up{constructor(e){this._byteString=e}static fromBase64String(e){try{return new up(Co.fromBase64String(e))}catch(t){throw new zi(qi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new up(Co.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class cp{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new zi(qi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new cs(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class lp{constructor(e){this._methodName=e}}class hp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new zi(qi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new zi(qi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ts(this._lat,e._lat)||ts(this._long,e._long)}}class dp{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const fp=/^__.*__$/;class pp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Bu(e,this.data,this.fieldMask,t,this.fieldTransforms):new ju(e,this.data,t,this.fieldTransforms)}}class mp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Bu(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function gp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Vi()}}class yp{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new yp(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Lp(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(gp(this.Cu)&&fp.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class vp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||rd(e)}Qu(e,t,n,r=!1){return new yp({Cu:e,methodName:t,qu:n,path:cs.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _p(e){const t=e._freezeSettings(),n=rd(e._databaseId);return new vp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function wp(e,t,n,r,i,s={}){const o=e.Qu(s.merge||s.mergeFields?2:0,t,n,i);Rp("Data must be an object, but it was:",o,r);const a=Np(r,o);let u,c;if(s.merge)u=new So(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=xp(t,r,n);if(!o.contains(i))throw new zi(qi.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Mp(e,i)||e.push(i)}u=new So(e),c=o.fieldTransforms.filter(e=>u.covers(e.field))}else u=null,c=o.fieldTransforms;return new pp(new aa(a),u,c)}class bp extends lp{_toFieldTransform(e){if(2!==e.Cu)throw 1===e.Cu?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof bp}}function Ip(e,t,n){return new yp({Cu:3,qu:t.settings.qu,methodName:e._methodName,xu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Tp extends lp{_toFieldTransform(e){return new Du(e.path,new Iu)}isEqual(e){return e instanceof Tp}}class Ep extends lp{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Ip(this,e,!0),n=this.Ku.map(e=>Ap(e,t)),r=new Tu(n);return new Du(e.path,r)}isEqual(e){return e instanceof Ep&&C(this.Ku,e.Ku)}}class Sp extends lp{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Ip(this,e,!0),n=this.Ku.map(e=>Ap(e,t)),r=new Su(n);return new Du(e.path,r)}isEqual(e){return e instanceof Sp&&C(this.Ku,e.Ku)}}class kp extends lp{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Cu(e.serializer,yu(e.serializer,this.$u));return new Du(e.path,t)}isEqual(e){return e instanceof kp&&this.$u===e.$u}}function Cp(e,t,n,r=!1){return Ap(n,e.Qu(r?4:3,t))}function Ap(e,t){if(Dp(e=P(e)))return Rp("Unsupported field value:",t,e),Np(e,t);if(e instanceof lp)return function(e,t){if(!gp(t.Cu))throw t.Bu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Bu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Ap(i,t.Lu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=P(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return yu(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=is.fromDate(e);return{timestampValue:_c(t.serializer,n)}}if(e instanceof is){const n=new is(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:_c(t.serializer,n)}}if(e instanceof hp)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof up)return{bytesValue:wc(t.serializer,e._byteString)};if(e instanceof Xf){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Bu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Tc(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof dp)return n=t,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw n.Bu("VectorValues must only contain numeric values.");return mu(n.serializer,e)})}}}}};var n;throw t.Bu(`Unsupported field value: ${$f(e)}`)}(e,t)}function Np(e,t){const n={};return vo(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):yo(e,(e,r)=>{const i=Ap(r,t.Mu(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function Dp(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof is||e instanceof hp||e instanceof up||e instanceof Xf||e instanceof lp||e instanceof dp)}function Rp(e,t,n){if(!Dp(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=$f(n);throw"an object"===r?t.Bu(e+" a custom object"):t.Bu(e+" "+r)}var r}function xp(e,t,n){if((t=P(t))instanceof cp)return t._internalPath;if("string"==typeof t)return Pp(e,t);throw Lp("Field path arguments must be of type string or ",e,!1,void 0,n)}const Op=new RegExp("[~\\*/\\[\\]]");function Pp(e,t,n){if(t.search(Op)>=0)throw Lp(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new cp(...t.split("."))._internalPath}catch(r){throw Lp(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Lp(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new zi(qi.INVALID_ARGUMENT,a+e+u)}function Mp(e,t){return e.some(e=>e.isEqual(t))}class Up{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Xf(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Fp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Vp("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Fp extends Up{data(){return super.data()}}function Vp(e,t){return"string"==typeof t?Pp(e,t):t instanceof cp?t._internalPath:t._delegate._internalPath}function jp(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new zi(qi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Bp{}class qp extends Bp{}function zp(e,t,...n){let r=[];t instanceof Bp&&r.push(t),r=r.concat(n),function(e){const t=e.filter(e=>e instanceof Gp).length,n=e.filter(e=>e instanceof Kp).length;if(t>1||t>0&&n>0)throw new zi(qi.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)e=i._apply(e);return e}class Kp extends qp{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Kp(e,t,n)}_apply(e){const t=this._parse(e);return tm(e._query,t),new Jf(e.firestore,e.converter,Wa(e._query,t))}_parse(e){const t=_p(e.firestore);return function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new zi(qi.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){em(o,s);const t=[];for(const n of o)t.push(Zp(r,e,n));a={arrayValue:{values:t}}}else a=Zp(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||em(o,s),a=Cp(n,"where",o,"in"===s||"not-in"===s);return ga.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function $p(e,t,n){const r=t,i=Vp("where",e);return Kp._create(i,r,n)}class Gp extends Bp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Gp(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ya.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)tm(n,i),n=Wa(n,i)}(e._query,t),new Jf(e.firestore,e.converter,Wa(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Hp extends qp{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Hp(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new zi(qi.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new zi(qi.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new fa(t,n)}(e._query,this._field,this._direction);return new Jf(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new qa(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Wp(e,t="asc"){const n=t,r=Vp("orderBy",e);return Hp._create(r,n)}class Qp extends qp{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Qp(e,t,n)}_apply(e){return new Jf(e.firestore,e.converter,Qa(e._query,this._limit,this._limitType))}}function Jp(e){return function(e,t){if(t<=0)throw new zi(qi.INVALID_ARGUMENT,`Function limit() requires a positive number, but it was: ${t}.`)}(0,e),Qp._create("limit",e,"F")}class Xp extends qp{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Xp(e,t,n)}_apply(e){const t=function(e,t,n,r){if(n[0]=P(n[0]),n[0]instanceof Up)return function(e,t,n,r,i){if(!r)throw new zi(qi.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const o of Ga(e))if(o.field.isKeyField())s.push(Ho(t,r.key));else{const e=r.data.field(o.field);if(xo(e))throw new zi(qi.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=o.field.canonicalString();throw new zi(qi.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new la(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=_p(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new zi(qi.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let u=0;u<i.length;u++){const s=i[u];if(o[u].field.isKeyField()){if("string"!=typeof s)throw new zi(qi.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof s}`);if(!$a(e)&&-1!==s.indexOf("/"))throw new zi(qi.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${s}' contains a slash.`);const n=e.path.child(as.fromString(s));if(!ls.isDocumentKey(n))throw new zi(qi.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new ls(n);a.push(Ho(t,i))}else{const e=Cp(n,r,s);a.push(e)}}return new la(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}(e,this.type,this._docOrFields,this._inclusive);return new Jf(e.firestore,e.converter,(n=e._query,r=t,new qa(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,r,n.endAt)));var n,r}}function Yp(...e){return Xp._create("startAfter",e,!1)}function Zp(e,t,n){if("string"==typeof(n=P(n))){if(""===n)throw new zi(qi.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$a(t)&&-1!==n.indexOf("/"))throw new zi(qi.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(as.fromString(n));if(!ls.isDocumentKey(r))throw new zi(qi.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ho(e,new ls(r))}if(n instanceof Xf)return Ho(e,n._key);throw new zi(qi.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${$f(n)}.`)}function em(e,t){if(!Array.isArray(e)||0===e.length)throw new zi(qi.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function tm(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new zi(qi.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new zi(qi.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class nm{convertValue(e,t="none"){switch(Vo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Do(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ro(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Vi()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return yo(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e=>Do(e.doubleValue));return new dp(i)}convertGeoPoint(e){return new hp(Do(e.latitude),Do(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Oo(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Po(e));default:return null}}convertTimestamp(e){const t=No(e);return new is(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=as.fromString(e);ji(Gc(n));const r=new Mo(n.get(1),n.get(3)),i=new ls(n.popFirst(5));return r.isEqual(t)||Mi(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function rm(e,t,n){let r;return r=e?e.toFirestore(t):t,r}class im{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class sm extends Up{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new om(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Vp("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class om extends sm{data(e={}){return super.data(e)}}class am{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new im(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new om(this._firestore,this._userDataWriter,n.key,n,new im(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new zi(qi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new om(e._firestore,e._userDataWriter,n.doc.key,n.doc,new im(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new om(e._firestore,e._userDataWriter,t.doc.key,t.doc,new im(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:um(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function um(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Vi()}}function cm(e){e=Gf(e,Xf);const t=Gf(e.firestore,rp);return function(e,t,n={}){const i=new Ki;return e.asyncQueue.enqueueAndForget(()=>r(this,null,function*(){return function(e,t,n,r,i){const s=new Of({next:a=>{s.Za(),t.enqueueAndForget(()=>Wd(e,o));const u=a.docs.has(n);!u&&a.fromCache?i.reject(new zi(qi.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&a.fromCache&&r&&"server"===r.source?i.reject(new zi(qi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),o=new ef(za(n.path),s,{includeMetadataChanges:!0,_a:!0});return Hd(e,o)}(yield Ff(e),e.asyncQueue,t,n,i)})),i.promise}(sp(t),e._key).then(n=>vm(t,e,n))}class lm extends nm{constructor(e){super(),this.firestore=e}convertBytes(e){return new up(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Xf(this.firestore,null,t)}}function hm(e){e=Gf(e,Jf);const t=Gf(e.firestore,rp),n=sp(t),i=new lm(t);return jp(e._query),function(e,t,n={}){const i=new Ki;return e.asyncQueue.enqueueAndForget(()=>r(this,null,function*(){return function(e,t,n,r,i){const s=new Of({next:n=>{s.Za(),t.enqueueAndForget(()=>Wd(e,o)),n.fromCache&&"server"===r.source?i.reject(new zi(qi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new ef(n,s,{includeMetadataChanges:!0,_a:!0});return Hd(e,o)}(yield Ff(e),e.asyncQueue,t,n,i)})),i.promise}(n,e._query).then(n=>new am(t,i,e,n))}function dm(e,t,n){e=Gf(e,Xf);const r=Gf(e.firestore,rp),i=rm(e.converter,t);return ym(r,[wp(_p(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,xu.none())])}function fm(e,t,n,...r){e=Gf(e,Xf);const i=Gf(e.firestore,rp),s=_p(i);let o;return o="string"==typeof(t=P(t))||t instanceof cp?function(e,t,n,r,i,s){const o=e.Qu(1,t,n),a=[xp(t,r,n)],u=[i];if(s.length%2!=0)throw new zi(qi.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(xp(t,s[d])),u.push(s[d+1]);const c=[],l=aa.empty();for(let d=a.length-1;d>=0;--d)if(!Mp(c,a[d])){const e=a[d];let t=u[d];t=P(t);const n=o.Nu(e);if(t instanceof bp)c.push(e);else{const r=Ap(t,n);null!=r&&(c.push(e),l.set(e,r))}}const h=new So(c);return new mp(l,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.Qu(1,t,n);Rp("Data must be an object, but it was:",i,r);const s=[],o=aa.empty();yo(r,(e,r)=>{const a=Pp(t,e,n);r=P(r);const u=i.Nu(a);if(r instanceof bp)s.push(a);else{const e=Ap(r,u);null!=e&&(s.push(a),o.set(a,e))}});const a=new So(s);return new mp(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),ym(i,[o.toMutation(e._key,xu.exists(!0))])}function pm(e){return ym(Gf(e.firestore,rp),[new $u(e._key,xu.none())])}function mm(e,t){const n=Gf(e.firestore,rp),r=ep(e),i=rm(e.converter,t);return ym(n,[wp(_p(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,xu.exists(!1))]).then(()=>r)}function gm(e,...t){var n,i,s;e=P(e);let o={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[a]||np(t[a])||(o=t[a],a++);const u={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(np(t[a])){const e=t[a];t[a]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[a+1]=null===(i=e.error)||void 0===i?void 0:i.bind(e),t[a+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let c,l,h;if(e instanceof Xf)l=Gf(e.firestore,rp),h=za(e._key.path),c={next:n=>{t[a]&&t[a](vm(l,e,n))},error:t[a+1],complete:t[a+2]};else{const n=Gf(e,Jf);l=Gf(n.firestore,rp),h=n._query;const r=new lm(l);c={next:e=>{t[a]&&t[a](new am(l,r,n,e))},error:t[a+1],complete:t[a+2]},jp(e._query)}return function(e,t,n,i){const s=new Of(i),o=new ef(t,s,n);return e.asyncQueue.enqueueAndForget(()=>r(this,null,function*(){return Hd(yield Ff(e),o)})),()=>{s.Za(),e.asyncQueue.enqueueAndForget(()=>r(this,null,function*(){return Wd(yield Ff(e),o)}))}}(sp(l),h,u,c)}function ym(e,t){return function(e,t){const n=new Ki;return e.asyncQueue.enqueueAndForget(()=>r(this,null,function*(){return function(t,n,i){return r(this,null,function*(){const r=Nf(t);try{const e=yield function(e,t){const n=Bi(e),r=is.now(),i=t.reduce((e,t)=>e.add(t.key),fu());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=iu(),u=fu();return n.cs.getEntries(e,i).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(u=u.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(i=>{s=i;const o=[];for(const e of t){const t=Fu(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Bu(e.key,t,ua(t.value.mapValue),xu.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(s,u);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:au(s)}))}(r.localStore,n);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ba[e.currentUser.toKey()];r||(r=new _o(ts)),r=r.insert(t,n),e.Ba[e.currentUser.toKey()]=r}(r,e.batchId,i),yield Sf(r,e.changes),yield Cd(r.remoteStore)}catch(e){const n=jd(e,"Failed to persist write");i.reject(n)}})}(yield function(e){return Uf(e).then(e=>e.syncEngine)}(e),t,n)})),n.promise}(sp(e),t)}function vm(e,t,n){const r=n.docs.get(t._key),i=new lm(e);return new sm(e,i,t._key,r,new im(n.hasPendingWrites,n.fromCache),t.converter)}function _m(){return new Tp("serverTimestamp")}function wm(...e){return new Ep("arrayUnion",e)}function bm(...e){return new Sp("arrayRemove",e)}function Im(e){return new kp("increment",e)}!function(e,t=!0){xi=Oe,Ae(new L("firestore",(e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new rp(new Wi(e.getProvider("auth-internal")),new Yi(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new zi(qi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mo(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),Me(Di,"4.7.3",e),Me(Di,"4.7.3","esm2017")}();const Tm=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:nm,Bytes:up,CollectionReference:Yf,DocumentReference:Xf,DocumentSnapshot:sm,FieldPath:cp,FieldValue:lp,Firestore:rp,FirestoreError:zi,GeoPoint:hp,Query:Jf,QueryCompositeFilterConstraint:Gp,QueryConstraint:qp,QueryDocumentSnapshot:om,QueryFieldFilterConstraint:Kp,QueryLimitConstraint:Qp,QueryOrderByConstraint:Hp,QuerySnapshot:am,QueryStartAtConstraint:Xp,SnapshotMetadata:im,Timestamp:is,VectorValue:dp,_AutoId:es,_ByteString:Co,_DatabaseId:Mo,_DocumentKey:ls,_EmptyAuthCredentialsProvider:Gi,_FieldPath:cs,_cast:Gf,_logWarn:Ui,_validateIsNotUsedTogether:qf,addDoc:mm,arrayRemove:bm,arrayUnion:wm,collection:Zf,connectFirestoreEmulator:Qf,deleteDoc:pm,doc:ep,enableIndexedDbPersistence:ap,ensureFirestoreConfigured:sp,executeWrite:ym,getDoc:cm,getDocs:hm,getFirestore:ip,increment:Im,limit:Jp,onSnapshot:gm,orderBy:Wp,query:zp,serverTimestamp:_m,setDoc:dm,startAfter:Yp,updateDoc:fm,where:$p},Symbol.toStringTag,{value:"Module"})),Em="firebasestorage.googleapis.com",Sm="storageBucket";class km extends E{constructor(e,t,n=0){super(Rm(e),`Firebase Storage: ${t} (${Rm(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,km.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Rm(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Cm,Am,Nm,Dm;function Rm(e){return"storage/"+e}function xm(){return new km(Cm.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Om(){return new km(Cm.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Pm(){return new km(Cm.CANCELED,"User canceled the upload/download.")}function Lm(){return new km(Cm.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Mm(e){return new km(Cm.INVALID_ARGUMENT,e)}function Um(){return new km(Cm.APP_DELETED,"The Firebase app was deleted.")}function Fm(e,t){return new km(Cm.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function Vm(e){throw new km(Cm.INTERNAL_ERROR,"Internal error: "+e)}(Am=Cm||(Cm={})).UNKNOWN="unknown",Am.OBJECT_NOT_FOUND="object-not-found",Am.BUCKET_NOT_FOUND="bucket-not-found",Am.PROJECT_NOT_FOUND="project-not-found",Am.QUOTA_EXCEEDED="quota-exceeded",Am.UNAUTHENTICATED="unauthenticated",Am.UNAUTHORIZED="unauthorized",Am.UNAUTHORIZED_APP="unauthorized-app",Am.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",Am.INVALID_CHECKSUM="invalid-checksum",Am.CANCELED="canceled",Am.INVALID_EVENT_NAME="invalid-event-name",Am.INVALID_URL="invalid-url",Am.INVALID_DEFAULT_BUCKET="invalid-default-bucket",Am.NO_DEFAULT_BUCKET="no-default-bucket",Am.CANNOT_SLICE_BLOB="cannot-slice-blob",Am.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",Am.NO_DOWNLOAD_URL="no-download-url",Am.INVALID_ARGUMENT="invalid-argument",Am.INVALID_ARGUMENT_COUNT="invalid-argument-count",Am.APP_DELETED="app-deleted",Am.INVALID_ROOT_OPERATION="invalid-root-operation",Am.INVALID_FORMAT="invalid-format",Am.INTERNAL_ERROR="internal-error",Am.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class jm{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=jm.makeFromUrl(e,t)}catch(i){return new jm(e,"")}if(""===n.path)return n;throw r=e,new km(Cm.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Em?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let u=0;u<a.length;u++){const t=a[u],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let i=r[t.indices.path];i||(i=""),n=new jm(e,i),t.postModify(n);break}}if(null==n)throw function(e){return new km(Cm.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Bm{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function qm(e){return"string"==typeof e||e instanceof String}function zm(e){return Km()&&e instanceof Blob}function Km(){return"undefined"!=typeof Blob}function $m(e,t,n,r){if(r<t)throw Mm(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw Mm(`Invalid value for '${e}'. Expected ${n} or less.`)}function Gm(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function Hm(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}function Wm(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}(Dm=Nm||(Nm={}))[Dm.NO_ERROR=0]="NO_ERROR",Dm[Dm.NETWORK_ERROR=1]="NETWORK_ERROR",Dm[Dm.ABORT=2]="ABORT";class Qm{constructor(e,t,n,r,i,s,o,a,u,c,l,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=u,this.progressCallback_=c,this.connectionFactory_=l,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());void 0===e?n():n(e)}catch(s){r(s)}else if(null!==i){const e=xm();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else t.canceled?r(this.appDelete_?Um():Pm()):r(Om())};this.canceled_?e(0,new Jm(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function u(){return 2===a}let c=!1;function l(...e){c||(c=!0,t.apply(null,e))}function h(t){i=setTimeout(()=>{i=null,e(f,u())},t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(c)return void d();if(e)return d(),void l.call(null,e,...t);if(u()||o)return d(),void l.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),h(n)}let p=!1;function m(e){p||(p=!0,d(),c||(null!==i?(e||(a=2),clearTimeout(i),h(0)):e||(a=1)))}return h(0),s=setTimeout(()=>{o=!0,m(!0)},n),m}((e,t)=>{if(t)return void e(!1,new Jm(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Nm.NO_ERROR,i=n.getStatus();if(!t||Wm(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Nm.ABORT;return void e(!1,new Jm(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new Jm(s,n))})},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Jm{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Xm(...e){const t="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(Km())return new Blob(e);throw new km(Cm.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const Ym="base64",Zm="base64url",eg="data_url";class tg{constructor(e,t){this.data=e,this.contentType=t||null}}function ng(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):55296==(64512&r)?n<e.length-1&&56320==(64512&e.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function rg(e,t){switch(e){case Ym:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw Fm(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case Zm:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw Fm(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=function(e){if("undefined"==typeof atob)throw new km(Cm.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(i){if(i.message.includes("polyfill"))throw i;throw Fm(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class ig{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw Fm(eg,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;var r,i;null!=n&&(this.base64=(i=";base64",(r=n).length>=7&&r.substring(r.length-7)===i),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class sg{constructor(e,t){let n=0,r="";zm(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(zm(this.data_)){const s=(r=e,i=t,(n=this.data_).webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new sg(s)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new sg(n,!0)}var n,r,i}static getBlob(...e){if(Km()){const t=e.map(e=>e instanceof sg?e.data_:e);return new sg(Xm.apply(null,t))}{const t=e.map(e=>qm(e)?function(e,t){switch(e){case"raw":return new tg(ng(t));case Ym:case Zm:return new tg(rg(e,t));case eg:return new tg(function(e){const t=new ig(e);return t.base64?rg(Ym,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(n){throw Fm(eg,"Malformed data URL.")}return ng(t)}(t.rest)}(t),new ig(t).contentType)}throw xm()}("raw",e).data:e.data_);let n=0;t.forEach(e=>{n+=e.byteLength});const r=new Uint8Array(n);let i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]}),new sg(r,!0)}}uploadData(){return this.data_}}function og(e){let t;try{t=JSON.parse(e)}catch(r){return null}return"object"!=typeof(n=t)||Array.isArray(n)?null:t;var n}function ag(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function ug(e,t){return t}class cg{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||ug}}let lg=null;function hg(){if(lg)return lg;const e=[];e.push(new cg("bucket")),e.push(new cg("generation")),e.push(new cg("metageneration")),e.push(new cg("name","fullPath",!0));const t=new cg("name");t.xform=function(e,t){return function(e){return!qm(e)||e.length<2?e:ag(e)}(t)},e.push(t);const n=new cg("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new cg("timeCreated")),e.push(new cg("updated")),e.push(new cg("md5Hash",null,!0)),e.push(new cg("cacheControl",null,!0)),e.push(new cg("contentDisposition",null,!0)),e.push(new cg("contentEncoding",null,!0)),e.push(new cg("contentLanguage",null,!0)),e.push(new cg("contentType",null,!0)),e.push(new cg("metadata","customMetadata",!0)),lg=e,lg}function dg(e,t,n){const r=og(t);return null===r?null:function(e,t,n){const r={type:"file"},i=n.length;for(let s=0;s<i;s++){const e=n[s];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new jm(n,r);return t._makeStorageReference(i)}})}(r,e),r}(e,r,n)}function fg(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}class pg{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function mg(e){if(!e)throw xm()}function gg(e,t){return function(n,r){const i=dg(e,r,t);return mg(null!==i),i}}function yg(e){return function(t,n){let r;var i,s;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new km(Cm.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new km(Cm.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new km(Cm.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new km(Cm.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function vg(e){const t=yg(e);return function(n,r){let i=t(n,r);var s;return 404===n.getStatus()&&(s=e.path,i=new km(Cm.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function _g(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return t&&t.type()||"application/octet-stream"}(0,t)),r}function wg(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const u=_g(t,r,i),c="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+fg(u,n)+"\r\n--"+a+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",l="\r\n--"+a+"--",h=sg.getBlob(c,r,l);if(null===h)throw Lm();const d={name:u.fullPath},f=Gm(s,e.host,e._protocol),p=e.maxUploadRetryTime,m=new pg(f,"POST",gg(e,n),p);return m.urlParams=d,m.headers=o,m.body=h.uploadData(),m.errorHandler=yg(t),m}class bg{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function Ig(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(r){mg(!1)}return mg(!!n&&-1!==(t||["active"]).indexOf(n)),n}const Tg=262144;const Eg="running",Sg="paused",kg="success",Cg="canceled",Ag="error";function Ng(e){switch(e){case"running":case"pausing":case"canceling":return Eg;case"paused":return Sg;case"success":return kg;case"canceled":return Cg;default:return Ag}}class Dg{constructor(e,t,n){if("function"==typeof e||null!=t||null!=n)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function Rg(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}class xg{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Nm.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Nm.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Nm.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw Vm("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Vm("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Vm("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw Vm("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Vm("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Og extends xg{initXhr(){this.xhr_.responseType="text"}}function Pg(){return new Og}class Lg{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=hg(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(Cm.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const t=this.isExponentialBackoffExpired();if(Wm(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=Om()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(Cm.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{const n=function(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o=_g(t,r,i),a={name:o.fullPath},u=Gm(s,e.host,e._protocol),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},l=fg(o,n),h=e.maxUploadRetryTime,d=new pg(u,"POST",function(e){let t;Ig(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(n){mg(!1)}return mg(qm(t)),t},h);return d.urlParams=a,d.headers=c,d.body=l,d.errorHandler=yg(t),d}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Pg,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,n)=>{const r=function(e,t,n,r){const i=e.maxUploadRetryTime,s=new pg(n,"POST",function(e){const t=Ig(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(s){mg(!1)}n||mg(!1);const i=Number(n);return mg(!isNaN(i)),new bg(i,r.size(),"final"===t)},i);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=yg(t),s}(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(r,Pg,t,n);this._request=i,i.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=Tg*this._chunkMultiplier,t=new bg(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken((r,i)=>{let s;try{s=function(e,t,n,r,i,s,o,a){const u=new bg(0,0);if(o?(u.current=o.current,u.total=o.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new km(Cm.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");const c=u.total-u.current;let l=c;i>0&&(l=Math.min(l,i));const h=u.current,d=h+l;let f="";f=0===l?"finalize":c===l?"upload, finalize":"upload";const p={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":`${u.current}`},m=r.slice(h,d);if(null===m)throw Lm();const g=t.maxUploadRetryTime,y=new pg(n,"POST",function(e,n){const i=Ig(e,["active","final"]),o=u.current+l,a=r.size();let c;return c="final"===i?gg(t,s)(e,n):null,new bg(o,a,"final"===i,c)},g);return y.headers=p,y.body=m.uploadData(),y.progressCallback=a||null,y.errorHandler=yg(e),y}(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(a){return this._error=a,void this._transition("error")}const o=this._ref.storage._makeRequest(s,Pg,r,i,!1);this._request=o,o.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){Tg*this._chunkMultiplier*2<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const n=function(e,t,n){const r=Gm(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new pg(r,"GET",gg(e,n),i);return s.errorHandler=vg(t),s}(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,Pg,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const n=wg(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Pg,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=Pm(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=Ng(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new Dg(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(Ng(this._state)){case kg:Rg(this._resolve.bind(null,this.snapshot))();break;case Cg:case Ag:Rg(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Ng(this._state)){case Eg:case Sg:e.next&&Rg(e.next.bind(e,this.snapshot))();break;case kg:e.complete&&Rg(e.complete.bind(e))();break;default:e.error&&Rg(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class Mg{constructor(e,t){this._service=e,this._location=t instanceof jm?t:jm.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Mg(e,t)}get root(){const e=new jm(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ag(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new jm(this._location.bucket,e);return new Mg(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new km(Cm.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Ug(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=Gm(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new pg(r,"GET",function(e,t){return function(n,r){const i=dg(e,r,t);return mg(null!==i),function(e,t,n,r){const i=og(t);if(null===i)return null;if(!qm(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map(t=>{const i=e.bucket,s=e.fullPath;return Gm("/b/"+o(i)+"/o/"+o(s),n,r)+Hm({alt:"media",token:t})})[0]}(i,r,e.host,e._protocol)}}(e,n),i);return s.errorHandler=vg(t),s}(e.storage,e._location,hg());return e.storage.makeRequestWithTokens(t,Pg).then(e=>{if(null===e)throw new km(Cm.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function Fg(e,t){if(e instanceof Bg){const n=e;if(null==n._bucket)throw new km(Cm.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Sm+"' property when initializing the app?");const r=new Mg(n,n._bucket);return null!=t?Fg(r,t):r}return void 0!==t?function(e,t){const n=function(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new jm(e._location.bucket,n);return new Mg(e.storage,r)}(e,t):e}function Vg(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof Bg)return new Mg(e,t);throw Mm("To use ref(service, url), the first argument must be a Storage instance.")}return Fg(e,t)}function jg(e,t){const n=null==t?void 0:t[Sm];return null==n?null:jm.makeFromBucketSpec(n,e)}class Bg{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=Em,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?jm.makeFromBucketSpec(r,this._host):jg(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=jm.makeFromBucketSpec(this._url,e):this._bucket=jg(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){$m("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){$m("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return r(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=yield e.getToken();if(null!==t)return t.accessToken}return null})}_getAppCheckToken(){return r(this,null,function*(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Mg(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new Bm(Um());{const s=function(e,t,n,r,i,s,o=!0){const a=Hm(e.urlParams),u=e.url+a,c=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(c,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(c,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(c,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(c,r),new Qm(u,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}makeRequestWithTokens(e,t){return r(this,null,function*(){const[n,r]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()})}}const qg="@firebase/storage",zg="0.13.2",Kg="storage";function $g(e,t,n){return function(e,t,n){e._throwIfRoot("uploadBytes");const r=wg(e.storage,e._location,hg(),new sg(t,!0),n);return e.storage.makeRequestWithTokens(r,Pg).then(t=>({metadata:t,ref:e}))}(e=P(e),t,n)}function Gg(e,t,n){return function(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new Lg(e,new sg(t),n)}(e=P(e),t,n)}function Hg(e){return Ug(e=P(e))}function Wg(e){return function(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=Gm(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,i=new pg(n,"DELETE",function(e,t){},r);return i.successCodes=[200,204],i.errorHandler=vg(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,Pg)}(e=P(e))}function Qg(e,t){return Vg(e=P(e),t)}function Jg(e=Le(),t){const n=Ne(e=P(e),Kg).getImmediate({identifier:t}),r=m("storage");return r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"==typeof i?i:_(i,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}Ae(new L(Kg,function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new Bg(n,r,i,t,Oe)},"PUBLIC").setMultipleInstances(!0)),Me(qg,zg,""),Me(qg,zg,"esm2017");const Xg="@firebase/installations",Yg="0.6.9",Zg=`w:${Yg}`,ey="FIS_v2",ty=new S("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ny(e){return e instanceof E&&e.code.includes("request-failed")}function ry({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function iy(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}function sy(e,t){return r(this,null,function*(){const n=(yield t.json()).error;return ty.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})})}function oy({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function ay(e){return r(this,null,function*(){const t=yield e();return t.status>=500&&t.status<600?e():t})}function uy(e){return new Promise(t=>{setTimeout(t,e)})}const cy=/^[cdef][\w-]{21}$/;function ly(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return cy.test(t)?t:""}catch(e){return""}}function hy(e){return`${e.appName}!${e.appId}`}const dy=new Map;function fy(e,t){const n=hy(e);py(n,t),function(e,t){const n=(!my&&"BroadcastChannel"in self&&(my=new BroadcastChannel("[Firebase] FID Change"),my.onmessage=e=>{py(e.data.key,e.data.fid)}),my);n&&n.postMessage({key:e,fid:t}),0===dy.size&&my&&(my.close(),my=null)}(n,t)}function py(e,t){const n=dy.get(e);if(n)for(const r of n)r(t)}let my=null;const gy="firebase-installations-store";let yy=null;function vy(){return yy||(yy=i("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(gy)}})),yy}function _y(e,t){return r(this,null,function*(){const n=hy(e),r=(yield vy()).transaction(gy,"readwrite"),i=r.objectStore(gy),s=yield i.get(n);return yield i.put(t,n),yield r.done,s&&s.fid===t.fid||fy(e,t.fid),t})}function wy(e){return r(this,null,function*(){const t=hy(e),n=(yield vy()).transaction(gy,"readwrite");yield n.objectStore(gy).delete(t),yield n.done})}function by(e,t){return r(this,null,function*(){const n=hy(e),r=(yield vy()).transaction(gy,"readwrite"),i=r.objectStore(gy),s=yield i.get(n),o=t(s);return void 0===o?yield i.delete(n):yield i.put(o,n),yield r.done,!o||s&&s.fid===o.fid||fy(e,o.fid),o})}function Iy(e){return r(this,null,function*(){let t;const n=yield by(e.appConfig,n=>{const i=function(e){return Sy(e||{fid:ly(),registrationStatus:0})}(n),s=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(ty.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=function(e,t){return r(this,null,function*(){try{const n=yield function(e,t){return r(this,arguments,function*({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=ry(e),i=oy(e),s=t.getImmediate({optional:!0});if(s){const e=yield s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:ey,appId:e.appId,sdkVersion:Zg},a={method:"POST",headers:i,body:JSON.stringify(o)},u=yield ay(()=>fetch(r,a));if(u.ok){const e=yield u.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:iy(e.authToken)}}throw yield sy("Create Installation",u)})}(e,t);return _y(e.appConfig,n)}catch(n){throw ny(n)&&409===n.customData.serverCode?yield wy(e.appConfig):yield _y(e.appConfig,{fid:t.fid,registrationStatus:0}),n}})}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Ty(e)}:{installationEntry:t}}(e,i);return t=s.registrationPromise,s.installationEntry});return""===n.fid?{installationEntry:yield t}:{installationEntry:n,registrationPromise:t}})}function Ty(e){return r(this,null,function*(){let t=yield Ey(e.appConfig);for(;1===t.registrationStatus;)yield uy(100),t=yield Ey(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=yield Iy(e);return n||t}return t})}function Ey(e){return by(e,e=>{if(!e)throw ty.create("installation-not-found");return Sy(e)})}function Sy(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}function ky(e,t){return r(this,arguments,function*({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${ry(e)}/${t}/authTokens:generate`}(e,n),i=function(e,{refreshToken:t}){const n=oy(e);return n.append("Authorization",function(e){return`${ey} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=yield s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:Zg,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},u=yield ay(()=>fetch(r,a));if(u.ok)return iy(yield u.json());throw yield sy("Generate Auth Token",u)})}function Cy(e,t=!1){return r(this,null,function*(){let n;const i=yield by(e.appConfig,i=>{if(!Ny(i))throw ty.create("not-registered");const s=i.authToken;if(!t&&(2===(o=s).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(o)))return i;var o;if(1===s.requestStatus)return n=function(e,t){return r(this,null,function*(){let n=yield Ay(e.appConfig);for(;1===n.authToken.requestStatus;)yield uy(100),n=yield Ay(e.appConfig);const r=n.authToken;return 0===r.requestStatus?Cy(e,t):r})}(e,t),i;{if(!navigator.onLine)throw ty.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=function(e,t){return r(this,null,function*(){try{const n=yield ky(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return yield _y(e.appConfig,r),n}catch(n){if(!ny(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});yield _y(e.appConfig,n)}else yield wy(e.appConfig);throw n}})}(e,t),t}});return n?yield n:i.authToken})}function Ay(e){return by(e,e=>{if(!Ny(e))throw ty.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t})}function Ny(e){return void 0!==e&&2===e.registrationStatus}function Dy(e){return ty.create("missing-app-config-values",{valueName:e})}const Ry="installations";Ae(new L(Ry,e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Dy("App Configuration");if(!e.name)throw Dy("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Dy(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:Ne(t,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),Ae(new L("installations-internal",e=>{const t=Ne(e.getProvider("app").getImmediate(),Ry).getImmediate();return{getId:()=>function(e){return r(this,null,function*(){const t=e,{installationEntry:n,registrationPromise:r}=yield Iy(t);return r?r.catch(console.error):Cy(t).catch(console.error),n.fid})}(t),getToken:e=>function(e,t=!1){return r(this,null,function*(){const n=e;return yield function(e){return r(this,null,function*(){const{registrationPromise:t}=yield Iy(e);t&&(yield t)})}(n),(yield Cy(n,t)).token})}(t,e)}},"PRIVATE")),Me(Xg,Yg),Me(Xg,Yg,"esm2017");const xy="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Oy="google.c.a.c_id";var Py,Ly,My;function Uy(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Fy(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(Ly=Py||(Py={}))[Ly.DATA_MESSAGE=1]="DATA_MESSAGE",Ly[Ly.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(My||(My={}));const Vy="fcm_token_details_db",jy="fcm_token_object_Store",By="firebase-messaging-store";let qy=null;function zy(){return qy||(qy=i("firebase-messaging-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(By)}})),qy}function Ky(e,t){return r(this,null,function*(){const n=$y(e),r=(yield zy()).transaction(By,"readwrite");return yield r.objectStore(By).put(t,n),yield r.done,t})}function $y({appConfig:e}){return e.appId}const Gy=new S("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function Hy({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}function Wy(e){return r(this,arguments,function*({appConfig:e,installations:t}){const n=yield t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})})}function Qy({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==xy&&(i.web.applicationPubKey=r),i}function Jy(e){return r(this,null,function*(){const t=yield function(e,t){return r(this,null,function*(){return(yield e.pushManager.getSubscription())||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Fy(t)})})}(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:Uy(t.getKey("auth")),p256dh:Uy(t.getKey("p256dh"))},s=yield function(e){return r(this,null,function*(){const t=$y(e),n=yield zy(),s=yield n.transaction(By).objectStore(By).get(t);if(s)return s;{const t=yield function(e){return r(this,null,function*(){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(e=>e.name).includes(Vy))return null;let t=null;return(yield i(Vy,5,{upgrade:(n,i,s,o)=>r(this,null,function*(){var r;if(i<2)return;if(!n.objectStoreNames.contains(jy))return;const s=o.objectStore(jy),a=yield s.index("fcmSenderId").get(e);if(yield s.clear(),a)if(2===i){const e=a;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(r=e.createTime)&&void 0!==r?r:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:Uy(e.vapidKey)}}}else if(3===i){const e=a;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:Uy(e.auth),p256dh:Uy(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:Uy(e.vapidKey)}}}else if(4===i){const e=a;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:Uy(e.auth),p256dh:Uy(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:Uy(e.vapidKey)}}}})})).close(),yield o(Vy),yield o("fcm_vapid_details_db"),yield o("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}(t)?t:null})}(e.appConfig.senderId);if(t)return yield Ky(e,t),t}})}(e.firebaseDependencies);if(s){if(function(e,t){const n=t.vapidKey===e.vapidKey,r=t.endpoint===e.endpoint,i=t.auth===e.auth,s=t.p256dh===e.p256dh;return n&&r&&i&&s}(s.subscriptionOptions,n))return Date.now()>=s.createTime+6048e5?function(e,t){return r(this,null,function*(){try{const n=yield function(e,t){return r(this,null,function*(){const n=yield Wy(e),r=Qy(t.subscriptionOptions),i={method:"PATCH",headers:n,body:JSON.stringify(r)};let s;try{const n=yield fetch(`${Hy(e.appConfig)}/${t.token}`,i);s=yield n.json()}catch(o){throw Gy.create("token-update-failed",{errorInfo:null==o?void 0:o.toString()})}if(s.error){const e=s.error.message;throw Gy.create("token-update-failed",{errorInfo:e})}if(!s.token)throw Gy.create("token-update-no-token");return s.token})}(e.firebaseDependencies,t),i=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return yield Ky(e.firebaseDependencies,i),n}catch(n){throw n}})}(e,{token:s.token,createTime:Date.now(),subscriptionOptions:n}):s.token;try{yield function(e,t){return r(this,null,function*(){const n={method:"DELETE",headers:yield Wy(e)};try{const r=yield fetch(`${Hy(e.appConfig)}/${t}`,n),i=yield r.json();if(i.error){const e=i.error.message;throw Gy.create("token-unsubscribe-failed",{errorInfo:e})}}catch(r){throw Gy.create("token-unsubscribe-failed",{errorInfo:null==r?void 0:r.toString()})}})}(e.firebaseDependencies,s.token)}catch(a){}return Xy(e.firebaseDependencies,n)}return Xy(e.firebaseDependencies,n)})}function Xy(e,t){return r(this,null,function*(){const n=yield function(e,t){return r(this,null,function*(){const n=yield Wy(e),r=Qy(t),i={method:"POST",headers:n,body:JSON.stringify(r)};let s;try{const t=yield fetch(Hy(e.appConfig),i);s=yield t.json()}catch(o){throw Gy.create("token-subscribe-failed",{errorInfo:null==o?void 0:o.toString()})}if(s.error){const e=s.error.message;throw Gy.create("token-subscribe-failed",{errorInfo:e})}if(!s.token)throw Gy.create("token-subscribe-no-token");return s.token})}(e,t),i={token:n,createTime:Date.now(),subscriptionOptions:t};return yield Ky(e,i),i.token})}function Yy(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i);const s=t.notification.icon;s&&(e.notification.icon=s)}(t,e),function(e,t){t.data&&(e.data=t.data)}(t,e),function(e,t){var n,r,i,s,o;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};const a=null!==(i=null===(r=t.fcmOptions)||void 0===r?void 0:r.link)&&void 0!==i?i:null===(s=t.notification)||void 0===s?void 0:s.click_action;a&&(e.fcmOptions.link=a);const u=null===(o=t.fcmOptions)||void 0===o?void 0:o.analytics_label;u&&(e.fcmOptions.analyticsLabel=u)}(t,e),t}function Zy(e){return Gy.create("missing-app-config-values",{valueName:e})}class ev{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=function(e){if(!e||!e.options)throw Zy("App Configuration Object");if(!e.name)throw Zy("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const r of t)if(!n[r])throw Zy(r);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}function tv(e,t){return r(this,null,function*(){if(!navigator)throw Gy.create("only-available-in-window");if("default"===Notification.permission&&(yield Notification.requestPermission()),"granted"!==Notification.permission)throw Gy.create("permission-blocked");return yield function(e,t){return r(this,null,function*(){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=xy)})}(e,null==t?void 0:t.vapidKey),yield function(e,t){return r(this,null,function*(){if(t||e.swRegistration||(yield function(e){return r(this,null,function*(){try{e.swRegistration=yield navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),e.swRegistration.update().catch(()=>{})}catch(t){throw Gy.create("failed-service-worker-registration",{browserErrorMessage:null==t?void 0:t.message})}})}(e)),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw Gy.create("invalid-sw-registration");e.swRegistration=t}})}(e,null==t?void 0:t.serviceWorkerRegistration),Jy(e)})}function nv(e,t){return r(this,null,function*(){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===My.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(Yy(n)):e.onMessageHandler.next(Yy(n)));const i=n.data;var s;"object"==typeof(s=i)&&s&&Oy in s&&"1"===i["google.c.a.e"]&&(yield function(e,t,n){return r(this,null,function*(){const r=function(e){switch(e){case My.NOTIFICATION_CLICKED:return"notification_open";case My.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);(yield e.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[Oy],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})})}(e,n.messageType,i))})}const rv="@firebase/messaging",iv="0.12.12";function sv(e=Le()){return function(){return r(this,null,function*(){try{yield T()}catch(e){return!1}return"undefined"!=typeof window&&I()&&!("undefined"==typeof navigator||!navigator.cookieEnabled)&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})}().then(e=>{if(!e)throw Gy.create("unsupported-browser")},e=>{throw Gy.create("indexed-db-unsupported")}),Ne(P(e),"messaging").getImmediate()}function ov(e,t){return r(this,null,function*(){return tv(e=P(e),t)})}function av(e,t){return function(e,t){if(!navigator)throw Gy.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=P(e),t)}Ae(new L("messaging",e=>{const t=new ev(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>nv(t,e)),t},"PUBLIC")),Ae(new L("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>tv(t,e)}},"PRIVATE")),Me(rv,iv),Me(rv,iv,"esm2017");export{gm as A,Zn as B,Wn as C,Hn as D,wm as E,bm as F,An as G,Bn as H,Qn as I,qn as J,Kn as K,$n as L,dm as M,zn as N,Fr as O,Dr as P,sv as Q,kr as R,ov as S,av as T,zr as U,Gg as V,Tm as W,ip as a,Jg as b,Zf as c,ep as d,ap as e,pm as f,gi as g,Im as h,Pe as i,hm as j,mm as k,_m as l,cm as m,Jp as n,Wp as o,Yp as p,zp as q,Qg as r,Gn as s,Wg as t,fm as u,$g as v,$p as w,Hg as x,Vn as y,Ar as z};
